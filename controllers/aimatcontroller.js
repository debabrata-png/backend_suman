const { promisify } = require("util");
const jwt = require("jsonwebtoken");
const User = require("./../Models/user");
const Kpi = require("./../Models/kpi");

const AWS = require('aws-sdk');

const projects = require("./../Models/projects");
const publications = require("./../Models/publications");
const patents = require("./../Models/patents");
const teacherfellow = require("./../Models/teacherfellow");
const consultancy = require("./../Models/consultancy");
const phdguide = require("./../Models/phdguide");
const seminar = require("./../Models/seminar");
const book = require("./../Models/book");

const examschedule = require("./../Models/examschedule");
const examroom = require("./../Models/examroom");

const mprograms = require("./../Models/mprograms");
const mcourses = require("./../Models/mcourses");
const mstudents = require("./../Models/mstudents");
const examtimetable = require("./../Models/examtimetable");

const mfaccourses = require("./../Models/mfaccourses");
const mfaccoursesatt = require("./../Models/mfaccoursesatt");

const mattcalc = require("./../Models/mattcalc");

const mcolevels = require("./../Models/mcolevels");

const mcourseslist = require("./../Models/mcourseslist");

const mstudents1 = require("./../Models/mstudents1");

const madmapplys = require("./../Models/madmapplys");
const madmapplya = require("./../Models/madmapplya");

const classenr1 = require("./../Models/classenr1");

const msyllabus = require("./../Models/msyllabus");

const massignments = require("./../Models/massignments");
const manouncements = require("./../Models/manouncements");
const mcourseco = require("./../Models/mcourseco");
const mcalendar = require("./../Models/mcalendar");
const mcoursematerial = require("./../Models/mcoursematerial");

const massignsubmit = require("./../Models/massignsubmit");
const mdiscussion = require("./../Models/mdiscussion");

const quotanew = require("./../Models/quotanew");

const classnew = require("./../Models/classnew");
const attendancenew = require("./../Models/attendancenew");

const scholnew = require("./../Models/scholnew");
const studawardsnew = require("./../Models/studawardsnew");

const slideshow = require("./../Models/slideshow");

const eventsnew1 = require("./../Models/eventsnew1");

const testnew = require("./../Models/testnew");
const testq = require("./../Models/testq");
const testo = require("./../Models/testo");

const testscores = require("./../Models/testscores");

const lmsvideos = require("./../Models/lmsvideos");
const lmsvideosc = require("./../Models/lmsvideosc");

const mvac = require("./../Models/mvac");

const lpublications = require("./../Models/lpublications");
const lpubeditions = require("./../Models/lpubeditions");
const lpubarticles = require("./../Models/lpubarticles");
const lpubreviews = require("./../Models/lpubreviews");

const mplacement=require('./../Models/mplacement');


const massets=require('./../Models/massets');
const massetassign=require('./../Models/massetassign');
const mvendors=require('./../Models/mvendors');
const mvendorbanks=require('./../Models/mvendorbanks');
const mpurchase=require('./../Models/mpurchase');
const mpurchaseitems=require('./../Models/mpurchaseitems');
const mpopayments=require('./../Models/mpopayments');

const mtestnewm=require('./../Models/mtestnewm');
const mtestsessions=require('./../Models/mtestsessions');
const mtestseenrol=require('./../Models/mtestseenrol');
const mtestsections=require('./../Models/mtestsections');
const mtestqnew=require('./../Models/mtestqnew');

const mtestseenrol1=require('./../Models/mtestseenrol1');

const mtestsections1=require('./../Models/mtestsections1');

const mtestscoresnew=require('./../Models/mtestscoresnew');

const mtestscoresnew1=require('./../Models/mtestscoresnew1');

const mguides=require('./../Models/mguides');
const mctalentreg=require('./../Models/mctalentreg');
const mtestqnewcs=require('./../Models/mtestqnewcs');

const onlinepay=require('./../Models/onlinepay');


const mindmaplist=require('./../Models/mindmaplist');
const mindmapnodes=require('./../Models/mindmapnodes');
const mindmapedges=require('./../Models/mindmapedges');


const minewm=require('./../Models/minewm');
const misessions=require('./../Models/misessions');
const miseenrol1=require('./../Models/miseenrol1');
const misections1=require('./../Models/misections1');
const miqnew=require('./../Models/miqnew');
const miscores=require('./../Models/miscores');

const bmou=require('./../Models/bmou');

const btrialb=require('./../Models/btrialb');
const bfacyear=require('./../Models/bfacyear');
const studlist=require('./../Models/studlist');


const nn11=require('./../Models/nn11');
const nn12=require('./../Models/nn12');
const nn14=require('./../Models/nn14');
const nn15=require('./../Models/nn15');
const nn16=require('./../Models/nn16');
const nn17=require('./../Models/nn17');

const nn211a=require('./../Models/nn211a');
const nn211b=require('./../Models/nn211b');
const nn22=require('./../Models/nn22');
const nn23=require('./../Models/nn23');
const nn244=require('./../Models/nn244');
const nn25=require('./../Models/nn25');
const nn26=require('./../Models/nn26');
const nn31=require('./../Models/nn31');
const nn32=require('./../Models/nn32');

const nn33a=require('./../Models/nn33a');
const nn33b=require('./../Models/nn33b');
const nn35=require('./../Models/nn35');
const nn36=require('./../Models/nn36');
const nn46=require('./../Models/nn46');


const nn51=require('./../Models/nn51');
const nn52=require('./../Models/nn52');
const nn53examdays=require('./../Models/nn53examdays');
const nn53passp=require('./../Models/nn53passp');
const nn53obe=require('./../Models/nn53obe');
const nn54=require('./../Models/nn54');
const nn55=require('./../Models/nn55');
const nn56=require('./../Models/nn56');

const nallaccr=require('./../Models/nallaccr');

const nallaccrans=require('./../Models/nallaccrans');

const nn61=require('./../Models/nn61');
const nn62=require('./../Models/nn62');
const nn6clubs=require('./../Models/nn6clubs');


const nn76=require('./../Models/nn76');
const nn781=require('./../Models/nn781');
const nn82=require('./../Models/nn82');
const nn83=require('./../Models/nn83');
const nn84=require('./../Models/nn84');
const nn86=require('./../Models/nn86');
const nn87=require('./../Models/nn87');
const nn96=require('./../Models/nn96');
const nn97=require('./../Models/nn97');
const nn98=require('./../Models/nn98');


const attyear=require('./../Models/attyear');

const ngroup=require('./../Models/ngroup');
const ngrouppages=require('./../Models/ngrouppages');
const ngroupaccr=require('./../Models/ngroupaccr');

const timeslotsn1=require('./../Models/timeslotsn1');
const workloadn1=require('./../Models/workloadn1');


const facwcal=require('./../Models/facwcal');

const examadmit=require('./../Models/examadmit');
const fees=require('./../Models/fees');
const ledgerstud=require('./../Models/ledgerstud');


const exammarksall=require('./../Models/exammarksall');

const jobds=require('./../Models/jobds');
const jobapplicationds=require('./../Models/jobapplicationds');

const lessonplannew=require('./../Models/lessonplannew');

const serbplan=require('./../Models/serbplan');


const macadcal=require('./../Models/macadcal');
const mfeescol=require('./../Models/mfeescol');

const mjournal1=require('./../Models/mjournal1');
const mtrialbalance1=require('./../Models/mtrialbalance1');

const mjournal2=require('./../Models/mjournal2');
const mtrialbalance2=require('./../Models/mtrialbalance2');

const mtradingaccount=require('./../Models/mtradingaccount');
const mplaccount=require('./../Models/mplaccount');
const mbalancesheet=require('./../Models/mbalancesheet');

const studalloc1=require('./../Models/studalloc1');


const Patient=require('./../Models/Patient');
const icu=require('./../Models/icu');
const micu=require('./../Models/micu');
const nicu=require('./../Models/nicu');
const hdu=require('./../Models/hdu');
const ward=require('./../Models/ward');
const emergency=require('./../Models/emergency');
const nemergency=require('./../Models/nemergency');
const padmission=require('./../Models/padmission');
const icubed=require('./../Models/icubed');
const micubed=require('./../Models/micubed');
const nicubed=require('./../Models/nicubed');
const hdubed=require('./../Models/hdubed');
const wardbed=require('./../Models/wardbed');
const erbed=require('./../Models/erbed');
const nerbed=require('./../Models/nerbed');
const padmhistory=require('./../Models/padmhistory');
const pbilling=require('./../Models/pbilling');


const pillness=require('./../Models/pillness');
const psurgery=require('./../Models/psurgery');
const pfamily=require('./../Models/pfamily');
const pallergies=require('./../Models/pallergies');


const pconsent=require('./../Models/pconsent');
const ptreatment=require('./../Models/ptreatment');
const plab=require('./../Models/plab');
const pimaging=require('./../Models/pimaging');
const pdischarge=require('./../Models/pdischarge');


const wcollection=require('./../Models/wcollection');
const wcolschedule=require('./../Models/wcolschedule');
const wdisposal=require('./../Models/wdisposal');
const wspill=require('./../Models/wspill');


const wbin=require('./../Models/wbin');
const wcolschedule1=require('./../Models/wcolschedule1');
const wdisposal1=require('./../Models/wdisposal1');
const wspill1=require('./../Models/wspill1');


const pcounselnew=require('./../Models/pcounselnew');
const pcounselc=require('./../Models/pcounselc');
const pmealplan=require('./../Models/pmealplan');
const pfood=require('./../Models/pfood');

const crmh1=require('./../Models/crmh1');

const tall=require('./../Models/tall');
const tfields=require('./../Models/tfields');

const tbcolumnsall=require('./../Models/tbcolumnsall');
const { log } = require("console");


























const SES_CONFIG = {
    accessKeyId: 'AKIAUAC655EBDHJUEUDZ',
    secretAccessKey: '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',
    region: 'ap-south-1',
};

const AWS_SES = new AWS.SES(SES_CONFIG);




const sendactEmail = (recipientEmail, emaildata, subject) => {
  let params = {
    Source: 'reminder@epaathsala.com',
    Destination: {
      ToAddresses: [
          recipientEmail,
          'team@epaathsala.com'
      ],
    },
    ReplyToAddresses: [],
    Message: {
      Body: {
        Html: {
          Charset: 'UTF-8',
          Data: emaildata,
        },
      },
      Subject: {
        Charset: 'UTF-8',
        Data: subject,
      }
    },
  };
  return AWS_SES.sendEmail(params).promise();
};




exports.getprojectsbyfac = async (req, res) => {
  try {
    const lcat1233 = await projects.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.projectsbydep = async (req, res) => {
  try {
    const lcat1233 = await projects.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.projectsbyprog = async (req, res) => {
  try {
    const lcat1233 = await projects.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.projectsdocs = async (req, res) => {
  try {
    const lcat1233 = await projects.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.projectslinks = async (req, res) => {
  try {
    const lcat1233 = await projects.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.createprojectsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await projects.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      name: req.query.name,
      user: req.query.user,
      project: req.query.project,
      agency: req.query.agency,
      type: req.query.type,
      yop: req.query.yop,
      department: req.query.department,
      funds: req.query.funds,
      colid: req.query.colid,
      level: req.query.level,
      duration: req.query.duration,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.updateprojectsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await projects.findByIdAndUpdate(req.query.id, {
      name: req.query.name,
      user: req.query.user,
      project: req.query.project,
      agency: req.query.agency,
      type: req.query.type,
      yop: req.query.yop,
      department: req.query.department,
      funds: req.query.funds,
      colid: req.query.colid,
      level: req.query.level,
      duration: req.query.duration,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.updateprojectscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await projects.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.deleteprojectsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await projects.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getprojectscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await projects.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getprojectssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await projects.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: "$funds" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getprojectscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await projects.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getprojectssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await projects.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: "$funds" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jun 8 2024

exports.getpublicationsbyfac = async (req, res) => {
  try {
    const lcat1233 = await publications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.publicationsbydep = async (req, res) => {
  try {
    const lcat1233 = await publications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.publicationsbyprog = async (req, res) => {
  try {
    const lcat1233 = await publications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.publicationsdocs = async (req, res) => {
  try {
    const lcat1233 = await publications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.publicationslinks = async (req, res) => {
  try {
    const lcat1233 = await publications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createpublicationsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await publications.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      name: req.query.name,
      user: req.query.user,
      department: req.query.department,
      title: req.query.title,
      journal: req.query.journal,
      yop: req.query.yop,
      colid: req.query.colid,
      issn: req.query.issn,
      articlelink: req.query.articlelink,
      journallink: req.query.journallink,
      hindex: req.query.hindex,
      citation: req.query.citation,
      level: req.query.level,
      citationindex: req.query.citationindex,
      ugclisted: req.query.ugclisted,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //       status:'Failed',
    //        message: err
    //   });
  }
};

exports.updatepublicationsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await publications.findByIdAndUpdate(req.query.id, {
      name: req.query.name,
      user: req.query.user,
      department: req.query.department,
      title: req.query.title,
      journal: req.query.journal,
      yop: req.query.yop,
      colid: req.query.colid,
      issn: req.query.issn,
      articlelink: req.query.articlelink,
      journallink: req.query.journallink,
      hindex: req.query.hindex,
      citation: req.query.citation,
      level: req.query.level,
      citationindex: req.query.citationindex,
      ugclisted: req.query.ugclisted,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatepublicationscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await publications.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletepublicationsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await publications.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getpatentsbyfac = async (req, res) => {
  try {
    const lcat1233 = await patents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.patentsbydep = async (req, res) => {
  try {
    const lcat1233 = await patents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.patentsbyprog = async (req, res) => {
  try {
    const lcat1233 = await patents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.patentsdocs = async (req, res) => {
  try {
    const lcat1233 = await patents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.patentslinks = async (req, res) => {
  try {
    const lcat1233 = await patents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createpatentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await patents.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      title: req.query.title,
      patentnumber: req.query.patentnumber,
      doa: req.query.doa,
      agency: req.query.agency,
      yop: req.query.yop,
      doclink: req.query.doclink,
      patentstatus: req.query.patentstatus,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //       status:'Failed',
    //        message: err
    //   });
  }
};

exports.updatepatentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await patents.findByIdAndUpdate(req.query.id, {
      title: req.query.title,
      patentnumber: req.query.patentnumber,
      doa: req.query.doa,
      agency: req.query.agency,
      yop: req.query.yop,
      doclink: req.query.doclink,
      patentstatus: req.query.patentstatus,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatepatentscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await patents.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletepatentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await patents.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getteacherfellowbyfac = async (req, res) => {
  try {
    const lcat1233 = await teacherfellow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.teacherfellowbydep = async (req, res) => {
  try {
    const lcat1233 = await teacherfellow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.teacherfellowbyprog = async (req, res) => {
  try {
    const lcat1233 = await teacherfellow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.teacherfellowdocs = async (req, res) => {
  try {
    const lcat1233 = await teacherfellow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.teacherfellowlinks = async (req, res) => {
  try {
    const lcat1233 = await teacherfellow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createteacherfellowbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await teacherfellow.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      tname: req.query.tname,
      level: req.query.level,
      award: req.query.award,
      agency: req.query.agency,
      advanced: req.query.advanced,
      duration: req.query.duration,
      amount: req.query.amount,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateteacherfellowbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await teacherfellow.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      tname: req.query.tname,
      level: req.query.level,
      award: req.query.award,
      agency: req.query.agency,
      advanced: req.query.advanced,
      duration: req.query.duration,
      amount: req.query.amount,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateteacherfellowcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await teacherfellow.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteteacherfellowbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await teacherfellow.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getconsultancybyfac = async (req, res) => {
  try {
    const lcat1233 = await consultancy.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.consultancybydep = async (req, res) => {
  try {
    const lcat1233 = await consultancy.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.consultancybyprog = async (req, res) => {
  try {
    const lcat1233 = await consultancy.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.consultancydocs = async (req, res) => {
  try {
    const lcat1233 = await consultancy.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.consultancylinks = async (req, res) => {
  try {
    const lcat1233 = await consultancy.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createconsultancybyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await consultancy.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      consultant: req.query.consultant,
      title: req.query.title,
      agency: req.query.agency,
      year: req.query.year,
      revenue: req.query.revenue,
      trainees: req.query.trainees,
      advisor: req.query.advisor,
      department: req.query.department,
      role: req.query.role,
      contact: req.query.contact,
      duration: req.query.duration,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateconsultancybyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await consultancy.findByIdAndUpdate(req.query.id, {
      consultant: req.query.consultant,
      title: req.query.title,
      agency: req.query.agency,
      year: req.query.year,
      revenue: req.query.revenue,
      trainees: req.query.trainees,
      advisor: req.query.advisor,
      department: req.query.department,
      role: req.query.role,
      contact: req.query.contact,
      duration: req.query.duration,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateconsultancycomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await consultancy.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteconsultancybyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await consultancy.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getphdguidebyfac = async (req, res) => {
  try {
    const lcat1233 = await phdguide.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.phdguidebydep = async (req, res) => {
  try {
    const lcat1233 = await phdguide.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.phdguidebyprog = async (req, res) => {
  try {
    const lcat1233 = await phdguide.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.phdguidedocs = async (req, res) => {
  try {
    const lcat1233 = await phdguide.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.phdguidelinks = async (req, res) => {
  try {
    const lcat1233 = await phdguide.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createphdguidebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await phdguide.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      department: req.query.department,
      researchguide: req.query.researchguide,
      yog: req.query.yog,
      scholar: req.query.scholar,
      title: req.query.title,
      yor: req.query.yor,
      yop: req.query.yop,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatephdguidebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await phdguide.findByIdAndUpdate(req.query.id, {
      department: req.query.department,
      researchguide: req.query.researchguide,
      yog: req.query.yog,
      scholar: req.query.scholar,
      title: req.query.title,
      yor: req.query.yor,
      yop: req.query.yop,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatephdguidecomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await phdguide.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletephdguidebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await phdguide.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getseminarbyfac = async (req, res) => {
  try {
    const lcat1233 = await seminar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.seminarbydep = async (req, res) => {
  try {
    const lcat1233 = await seminar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.seminarbyprog = async (req, res) => {
  try {
    const lcat1233 = await seminar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.seminardocs = async (req, res) => {
  try {
    const lcat1233 = await seminar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.seminarlinks = async (req, res) => {
  try {
    const lcat1233 = await seminar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createseminarbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await seminar.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      title: req.query.title,
      duration: req.query.duration,
      yop: req.query.yop,
      membership: req.query.membership,
      amount: req.query.amount,
      role: req.query.role,
      paper: req.query.paper,
      level: req.query.level,
      type: req.query.type,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateseminarbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await seminar.findByIdAndUpdate(req.query.id, {
      title: req.query.title,
      duration: req.query.duration,
      yop: req.query.yop,
      membership: req.query.membership,
      amount: req.query.amount,
      role: req.query.role,
      paper: req.query.paper,
      level: req.query.level,
      type: req.query.type,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateseminarcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await seminar.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteseminarbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await seminar.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getbookbyfac = async (req, res) => {
  try {
    const lcat1233 = await book.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.bookbydep = async (req, res) => {
  try {
    const lcat1233 = await book.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.bookbyprog = async (req, res) => {
  try {
    const lcat1233 = await book.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.bookdocs = async (req, res) => {
  try {
    const lcat1233 = await book.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.booklinks = async (req, res) => {
  try {
    const lcat1233 = await book.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createbookbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await book.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      booktitle: req.query.booktitle,
      papertitle: req.query.papertitle,
      proceeding: req.query.proceeding,
      yop: req.query.yop,
      issn: req.query.issn,
      publisher: req.query.publisher,
      conferencename: req.query.conferencename,
      level: req.query.level,
      affiliated: req.query.affiliated,
      type: req.query.type,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatebookbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await book.findByIdAndUpdate(req.query.id, {
      booktitle: req.query.booktitle,
      papertitle: req.query.papertitle,
      proceeding: req.query.proceeding,
      yop: req.query.yop,
      issn: req.query.issn,
      publisher: req.query.publisher,
      conferencename: req.query.conferencename,
      level: req.query.level,
      affiliated: req.query.affiliated,
      type: req.query.type,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatebookcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await book.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletebookbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await book.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// jun 8 2024 graph api

exports.getpublicationscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await publications.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getpublicationssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await publications.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$ugclisted",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getpublicationscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await publications.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getpublicationssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await publications.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$ugclisted",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getpatentscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await patents.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getpatentssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await patents.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$patentstatus",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getpatentscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await patents.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getpatentssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await patents.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$patentstatus",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getteacherfellowcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await teacherfellow.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getteacherfellowsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await teacherfellow.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: "$amount" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getteacherfellowcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await teacherfellow.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getteacherfellowsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await teacherfellow.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: "$amount" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getconsultancycount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await consultancy.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getconsultancysecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await consultancy.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: "$revenue" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getconsultancycountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await consultancy.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getconsultancysecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await consultancy.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: "$revenue" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getphdguidecount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await phdguide.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yor",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getphdguidesecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await phdguide.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getphdguidecountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await phdguide.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yor",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getphdguidesecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await phdguide.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getseminarcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await seminar.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getseminarsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await seminar.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: "$amount" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getseminarcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await seminar.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getseminarsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await seminar.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: "$amount" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getbookcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await book.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getbooksecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await book.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$level",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getbookcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await book.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$yop",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getbooksecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await book.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$level",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jun 9 2024

exports.getexamschedulebyfac = async (req, res) => {
  try {
    const lcat1233 = await examschedule.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examschedulebydep = async (req, res) => {
  try {
    const lcat1233 = await examschedule.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examschedulebyprog = async (req, res) => {
  try {
    const lcat1233 = await examschedule.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examscheduledocs = async (req, res) => {
  try {
    const lcat1233 = await examschedule.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examschedulelinks = async (req, res) => {
  try {
    const lcat1233 = await examschedule.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createexamschedulebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await examschedule.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      exam: req.query.exam,
      examcode: req.query.examcode,
      fromdate: req.query.fromdate,
      todate: req.query.todate,
      semester: req.query.semester,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateexamschedulebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await examschedule.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      exam: req.query.exam,
      examcode: req.query.examcode,
      fromdate: req.query.fromdate,
      todate: req.query.todate,
      semester: req.query.semester,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateexamschedulecomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await examschedule.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteexamschedulebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await examschedule.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getexamroombyfac = async (req, res) => {
  try {
    const lcat1233 = await examroom.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examroombydep = async (req, res) => {
  try {
    const lcat1233 = await examroom.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examroombyprog = async (req, res) => {
  try {
    const lcat1233 = await examroom.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examroomdocs = async (req, res) => {
  try {
    const lcat1233 = await examroom.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examroomlinks = async (req, res) => {
  try {
    const lcat1233 = await examroom.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createexamroombyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await examroom.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      examcode: req.query.examcode,
      seatno: req.query.seatno,
      roomno: req.query.roomno,
      roomseatno: req.query.roomseatno,
      programcode: req.query.programcode,
      coursecode: req.query.coursecode,
      examdate: req.query.examdate,
      student: req.query.student,
      regno: req.query.regno,
      photo: req.query.photo,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateexamroombyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await examroom.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      examcode: req.query.examcode,
      seatno: req.query.seatno,
      roomno: req.query.roomno,
      roomseatno: req.query.roomseatno,
      programcode: req.query.programcode,
      coursecode: req.query.coursecode,
      examdate: req.query.examdate,
      student: req.query.student,
      regno: req.query.regno,
      photo: req.query.photo,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateexamroomcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await examroom.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteexamroombyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await examroom.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getexamschedulecount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examschedule.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamschedulesecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examschedule.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$semester",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamschedulecountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examschedule.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamschedulesecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examschedule.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$semester",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamroomcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examroom.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamroomsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examroom.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$programcode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamroomcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examroom.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamroomsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examroom.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$programcode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jun 16 2024

exports.getmprogramsbyfac = async (req, res) => {
  try {
    const lcat1233 = await mprograms.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getmprogramsbyyear = async (req, res) => {
  try {
    const lcat1233 = await mprograms.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          year: req.query.year,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mprogramsbydep = async (req, res) => {
  try {
    const lcat1233 = await mprograms.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mprogramsbyprog = async (req, res) => {
  try {
    const lcat1233 = await mprograms.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mprogramsdocs = async (req, res) => {
  try {
    const lcat1233 = await mprograms.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mprogramslinks = async (req, res) => {
  try {
    const lcat1233 = await mprograms.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmprogramsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mprograms.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemprogramsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mprograms.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemprogramscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mprograms.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemprogramsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mprograms.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmcoursesbyfac = async (req, res) => {
  try {
    const lcat1233 = await mcourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getmcoursesbyyear = async (req, res) => {
  try {
    const lcat1233 = await mcourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          year: req.query.year,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursesbydep = async (req, res) => {
  try {
    const lcat1233 = await mcourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursesbyprog = async (req, res) => {
  try {
    const lcat1233 = await mcourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursesdocs = async (req, res) => {
  try {
    const lcat1233 = await mcourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcourseslinks = async (req, res) => {
  try {
    const lcat1233 = await mcourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmcoursesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mcourses.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      type: req.query.type,
      credit: req.query.credit,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemcoursesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mcourses.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      type: req.query.type,
      credit: req.query.credit,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemcoursescomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mcourses.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemcoursesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mcourses.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmstudentsbyfac = async (req, res) => {
  try {
    const lcat1233 = await mstudents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudentsbydep = async (req, res) => {
  try {
    const lcat1233 = await mstudents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudentsbyprog = async (req, res) => {
  try {
    const lcat1233 = await mstudents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudentsdocs = async (req, res) => {
  try {
    const lcat1233 = await mstudents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudentslinks = async (req, res) => {
  try {
    const lcat1233 = await mstudents.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmstudentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mstudents.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      student: req.query.student,
      regno: req.query.regno,
      rollno: req.query.rollno,
      program: req.query.program,
      programcode: req.query.programcode,
      batch: req.query.batch,
      year: req.query.year,
      gender: req.query.gender,
      category: req.query.category,
      pwd: req.query.pwd,
      minority: req.query.minority,
      username: req.query.username,
      password: req.query.password,
      enabled: req.query.enabled,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemstudentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mstudents.findByIdAndUpdate(req.query.id, {
      student: req.query.student,
      regno: req.query.regno,
      rollno: req.query.rollno,
      program: req.query.program,
      programcode: req.query.programcode,
      batch: req.query.batch,
      year: req.query.year,
      gender: req.query.gender,
      category: req.query.category,
      pwd: req.query.pwd,
      minority: req.query.minority,
      username: req.query.username,
      password: req.query.password,
      enabled: req.query.enabled,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemstudentscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mstudents.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemstudentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mstudents.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getexamtimetablebyfac = async (req, res) => {
  try {
    const lcat1233 = await examtimetable.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examtimetablebydep = async (req, res) => {
  try {
    const lcat1233 = await examtimetable.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examtimetablebyprog = async (req, res) => {
  try {
    const lcat1233 = await examtimetable.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examtimetabledocs = async (req, res) => {
  try {
    const lcat1233 = await examtimetable.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.examtimetablelinks = async (req, res) => {
  try {
    const lcat1233 = await examtimetable.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createexamtimetablebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await examtimetable.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      examcode: req.query.examcode,
      examdate: req.query.examdate,
      examslot: req.query.examslot,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateexamtimetablebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await examtimetable.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      examcode: req.query.examcode,
      examdate: req.query.examdate,
      examslot: req.query.examslot,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateexamtimetablecomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await examtimetable.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteexamtimetablebyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await examtimetable.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// jun 16 graph

exports.getmprogramscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mprograms.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmprogramssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mprograms.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmprogramscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mprograms.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmprogramssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mprograms.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursescount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourses.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursessecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourses.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursescountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourses.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursessecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourses.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmstudentscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmstudentssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$category",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmstudentscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmstudentssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$category",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamtimetablecount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examtimetable.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamtimetablesecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examtimetable.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamtimetablecountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examtimetable.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getexamtimetablesecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await examtimetable.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// June 19 2024

exports.getmfaccoursesbyfac = async (req, res) => {
  try {
    const lcat1233 = await mfaccourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccoursesbydep = async (req, res) => {
  try {
    const lcat1233 = await mfaccourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccoursesbyprog = async (req, res) => {
  try {
    const lcat1233 = await mfaccourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccoursesdocs = async (req, res) => {
  try {
    const lcat1233 = await mfaccourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccourseslinks = async (req, res) => {
  try {
    const lcat1233 = await mfaccourses.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmfaccoursesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mfaccourses.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemfaccoursesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mfaccourses.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemfaccoursescomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mfaccourses.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemfaccoursesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mfaccourses.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmfaccoursesattbyfac = async (req, res) => {
  try {
    const lcat1233 = await mfaccoursesatt.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getmfaccoursesattbyfac1 = async (req, res) => {
  try {
    const lcat1233 = await mfaccoursesatt.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursename: req.query.coursename,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccoursesattbydep = async (req, res) => {
  try {
    const lcat1233 = await mfaccoursesatt.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccoursesattbyprog = async (req, res) => {
  try {
    const lcat1233 = await mfaccoursesatt.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccoursesattdocs = async (req, res) => {
  try {
    const lcat1233 = await mfaccoursesatt.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mfaccoursesattlinks = async (req, res) => {
  try {
    const lcat1233 = await mfaccoursesatt.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmfaccoursesattbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mfaccoursesatt.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      co: req.query.co,
      component: req.query.component,
      student: req.query.student,
      regno: req.query.regno,
      marks: req.query.marks,
      weightage: req.query.weightage,
      totalmarks: req.query.totalmarks,
      percentage: req.query.percentage,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemfaccoursesattbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mfaccoursesatt.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      co: req.query.co,
      component: req.query.component,
      student: req.query.student,
      regno: req.query.regno,
      marks: req.query.marks,
      weightage: req.query.weightage,
      totalmarks: req.query.totalmarks,
      percentage: req.query.percentage,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemfaccoursesattcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mfaccoursesatt.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemfaccoursesattbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mfaccoursesatt.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// june 19 2024 graph

exports.getmfaccoursescount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mfaccourses.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmfaccoursessecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mfaccourses.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmfaccoursescountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mfaccourses.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmfaccoursessecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mfaccourses.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmfaccoursesattcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mfaccoursesatt.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmfaccoursesattsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mfaccoursesatt.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$co",
          total_attendance: { $avg: "$percentage" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmfaccoursesattcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mfaccoursesatt.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursename: coursename,
          coursecode: coursecode,
        },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmfaccoursesattsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;
    const lcat1233 = await mfaccoursesatt.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursename: coursename,
          coursecode: coursecode,
        },
      },
      {
        $group: {
          _id: "$component",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// Jun 19n 2024 1

exports.getmattcalcbyfac = async (req, res) => {
  try {
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;

    const lcat1233 = await mattcalc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursename: req.query.coursename,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mattcalcbydep = async (req, res) => {
  try {
    const lcat1233 = await mattcalc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mattcalcbyprog = async (req, res) => {
  try {
    const lcat1233 = await mattcalc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mattcalcdocs = async (req, res) => {
  try {
    const lcat1233 = await mattcalc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mattcalclinks = async (req, res) => {
  try {
    const lcat1233 = await mattcalc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmattcalcbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mattcalc.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      faculty: req.query.faculty,
      co: req.query.co,
      component: req.query.component,
      marksp: req.query.marksp,
      weightage: req.query.weightage,
      percentage: req.query.percentage,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemattcalcbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mattcalc.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      faculty: req.query.faculty,
      co: req.query.co,
      component: req.query.component,
      marksp: req.query.marksp,
      weightage: req.query.weightage,
      percentage: req.query.percentage,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemattcalccomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mattcalc.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemattcalcbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mattcalc.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmattcalccount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mattcalc.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmattcalcsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mattcalc.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$co",
          total_attendance: { $avg: "$percentage" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmattcalccountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;
    const lcat1233 = await mattcalc.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursename: coursename,
          coursecode: coursecode,
        },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmattcalcsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;

    const lcat1233 = await mattcalc.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursename: coursename,
          coursecode: coursecode,
        },
      },
      {
        $group: {
          _id: "$co",
          total_attendance: { $sum: "$percentage" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.addcoattainmentv = async (req, res) => {
  try {
    const colid1 = parseInt(req.query.colid);
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;
    var cbcscount = 0;
    const d1 = await mattcalc.deleteMany({
      colid: req.query.colid,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      user: req.query.user,
    });
    const lcat1233 = await mfaccoursesatt.aggregate([
      {
        $match: {
          colid: colid1,
          coursename: coursename,
          coursecode: coursecode,
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            co: "$co",
            component: "$component",
            year: "$year",
          },
          total_attendance: { $avg: "$percentage" },
        },
      },
    ]);
    lcat1233.forEach(async function (data) {
      //console.log(data.link);
      //cbcscount=data.total_attendance;
      var percentage = parseFloat(data.total_attendance) * 0.3;
      const pub1 = await mattcalc.create({
        name: req.query.name,
        colid: req.query.colid,
        user: req.query.user,

        year: data._id.year,
        coursename: req.query.coursename,
        coursecode: req.query.coursecode,
        faculty: req.query.user,
        co: data._id.co,
        component: data._id.component,
        marksp: data.total_attendance,
        weightage: 0.3,
        percentage: percentage,
        status1: "Submitted",
        comments: "NA",
      });
    });
    // const lcat1=await Kpi.findOneAndUpdate( {metric: '1.2.2', colid: colid1, type: 'University'},{
    // currentvalue: cbcscount
    // });
    // const lcat2=await Kpi.findOneAndUpdate( {metric: '1.2.1', colid: colid1, type: 'Affiliated'},{
    //     currentvalue: cbcscount
    // });
    // const lcat3=await Kpi.findOneAndUpdate( {metric: '1.2.2', colid: colid1, type: 'Autonomous'},{
    //     currentvalue: cbcscount
    // });

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jun 20 2024

exports.getmcolevelsbyfac = async (req, res) => {
  try {
    const lcat1233 = await mcolevels.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursename: req.query.coursename,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcolevelsbydep = async (req, res) => {
  try {
    const lcat1233 = await mcolevels.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcolevelsbyprog = async (req, res) => {
  try {
    const lcat1233 = await mcolevels.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcolevelsdocs = async (req, res) => {
  try {
    const lcat1233 = await mcolevels.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcolevelslinks = async (req, res) => {
  try {
    const lcat1233 = await mcolevels.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmcolevelsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mcolevels.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      co: req.query.co,
      level: req.query.level,
      minvalue: req.query.minvalue,
      maxvalue: req.query.maxvalue,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemcolevelsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mcolevels.findByIdAndUpdate(req.query.id, {
      coursename: req.query.coursename,
      coursecode: req.query.coursecode,
      co: req.query.co,
      level: req.query.level,
      minvalue: req.query.minvalue,
      maxvalue: req.query.maxvalue,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemcolevelscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mcolevels.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemcolevelsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mcolevels.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmcolevelscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcolevels.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$level",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcolevelssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcolevels.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$co",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcolevelscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;
    const lcat1233 = await mcolevels.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursename: coursename,
          coursecode: coursecode,
        },
      },
      {
        $group: {
          _id: "$level",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcolevelssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const coursecode = req.query.coursecode;
    const coursename = req.query.coursename;
    const lcat1233 = await mcolevels.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursename: coursename,
          coursecode: coursecode,
        },
      },
      {
        $group: {
          _id: "$co",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// Jun 23 2024

exports.getmcourseslistbyfac = async (req, res) => {
  try {
    const lcat1233 = await mcourseslist.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcourseslistbydep = async (req, res) => {
  try {
    const lcat1233 = await mcourseslist.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcourseslistbyprog = async (req, res) => {
  try {
    const lcat1233 = await mcourseslist.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcourseslistdocs = async (req, res) => {
  try {
    const lcat1233 = await mcourseslist.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcourseslistlinks = async (req, res) => {
  try {
    const lcat1233 = await mcourseslist.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmcourseslistbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mcourseslist.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      type: req.query.type,
      semester: req.query.semester,
      credit: req.query.credit,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemcourseslistbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mcourseslist.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      type: req.query.type,
      semester: req.query.semester,
      credit: req.query.credit,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemcourseslistcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mcourseslist.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemcourseslistbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mcourseslist.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// jun 23 2024 graph

exports.getmcourseslistcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseslist.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcourseslistsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseslist.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcourseslistcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseslist.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcourseslistsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseslist.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jun 28 2024

exports.getmstudents1byfac = async (req, res) => {
  try {
    const lcat1233 = await mstudents1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudents1bydep = async (req, res) => {
  try {
    const lcat1233 = await mstudents1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudents1byprog = async (req, res) => {
  try {
    const lcat1233 = await mstudents1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudents1docs = async (req, res) => {
  try {
    const lcat1233 = await mstudents1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mstudents1links = async (req, res) => {
  try {
    const lcat1233 = await mstudents1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmstudents1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mstudents1.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      student: req.query.student,
      regno: req.query.regno,
      rollno: req.query.rollno,
      program: req.query.program,
      programcode: req.query.programcode,
      batch: req.query.batch,
      year: req.query.year,
      gender: req.query.gender,
      category: req.query.category,
      pwd: req.query.pwd,
      minority: req.query.minority,
      currentyear: req.query.currentyear,
      currentsem: req.query.currentsem,
      username: req.query.username,
      password: req.query.password,
      enabled: req.query.enabled,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemstudents1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mstudents1.findByIdAndUpdate(req.query.id, {
      student: req.query.student,
      regno: req.query.regno,
      rollno: req.query.rollno,
      program: req.query.program,
      programcode: req.query.programcode,
      batch: req.query.batch,
      year: req.query.year,
      gender: req.query.gender,
      category: req.query.category,
      pwd: req.query.pwd,
      minority: req.query.minority,
      currentyear: req.query.currentyear,
      currentsem: req.query.currentsem,
      username: req.query.username,
      password: req.query.password,
      enabled: req.query.enabled,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemstudents1comments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mstudents1.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemstudents1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mstudents1.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// jun 28 2024 graph

exports.getmstudents1count = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents1.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmstudents1second = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents1.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$category",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmstudents1countbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents1.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmstudents1secondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mstudents1.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$category",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jul 4 2024

// jul 6 2024

exports.getclassenr1byfac = async (req, res) => {
  try {
    const lcat1233 = await classenr1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classenr1bydep = async (req, res) => {
  try {
    const lcat1233 = await classenr1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classenr1byprog = async (req, res) => {
  try {
    const lcat1233 = await classenr1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classenr1docs = async (req, res) => {
  try {
    const lcat1233 = await classenr1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classenr1links = async (req, res) => {
  try {
    const lcat1233 = await classenr1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createclassenr1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await classenr1.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      student: req.query.student,
      regno: req.query.regno,
      learning: req.query.learning,
      gender: req.query.gender,
      classgroup: req.query.classgroup,
      coursetype: req.query.coursetype,
      semester: req.query.semester,
      active: req.query.active,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateclassenr1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await classenr1.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      student: req.query.student,
      regno: req.query.regno,
      learning: req.query.learning,
      gender: req.query.gender,
      classgroup: req.query.classgroup,
      coursetype: req.query.coursetype,
      semester: req.query.semester,
      active: req.query.active,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateclassenr1comments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await classenr1.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteclassenr1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await classenr1.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// jul 6 graph

exports.getclassenr1count = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classenr1.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$gender",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getclassenr1second = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classenr1.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$learning",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getclassenr1countbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classenr1.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$gender",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getclassenr1secondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classenr1.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$learning",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jul 6 stud

exports.getclassenr1studbyfac = async (req, res) => {
  try {
    const lcat1233 = await classenr1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          regno: req.query.regno,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

// jul 6 graph stud

exports.getclassenr1countbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classenr1.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$coursetype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getclassenr1secondbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classenr1.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$semester",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jul 7 2024

exports.getmsyllabusbyfac = async (req, res) => {
  try {
    const lcat1233 = await msyllabus.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          coursecode: req.query.coursecode,
          year: req.query.year,
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getmsyllabusbycoursecode = async (req, res) => {
  try {
    const lcat1233 = await msyllabus.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.msyllabusbydep = async (req, res) => {
  try {
    const lcat1233 = await msyllabus.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.msyllabusbyprog = async (req, res) => {
  try {
    const lcat1233 = await msyllabus.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.msyllabusdocs = async (req, res) => {
  try {
    const lcat1233 = await msyllabus.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.msyllabuslinks = async (req, res) => {
  try {
    const lcat1233 = await msyllabus.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmsyllabusbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await msyllabus.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      module: req.query.module,
      description: req.query.description,
      credits: req.query.credits,
      courselink: req.query.courselink,
      type: req.query.type,
      completed: req.query.completed,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemsyllabusbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await msyllabus.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      module: req.query.module,
      description: req.query.description,
      credits: req.query.credits,
      courselink: req.query.courselink,
      type: req.query.type,
      completed: req.query.completed,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemsyllabuscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await msyllabus.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemsyllabusbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await msyllabus.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// jul 7 graph

exports.getmsyllabuscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await msyllabus.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$completed",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmsyllabussecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await msyllabus.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmsyllabuscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await msyllabus.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$completed",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmsyllabussecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await msyllabus.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmsyllabuscountbycoursecode = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await msyllabus.aggregate([
      {
        $match: {
          colid: colid1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$completed",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmsyllabussecondbycoursecode = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await msyllabus.aggregate([
      {
        $match: {
          colid: colid1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jul 8 2024

exports.getmassignmentsbyfac = async (req, res) => {
  try {
    const lcat1233 = await massignments.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignmentsbydep = async (req, res) => {
  try {
    const lcat1233 = await massignments.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignmentsbyprog = async (req, res) => {
  try {
    const lcat1233 = await massignments.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignmentsdocs = async (req, res) => {
  try {
    const lcat1233 = await massignments.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignmentslinks = async (req, res) => {
  try {
    const lcat1233 = await massignments.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmassignmentsbyfac = async (req, res) => {
  const pub1 = await massignments.create({
    name: req.query.name,
    colid: req.query.colid,
    user: req.query.user,
    year: req.query.year,
    course: req.query.course,
    coursecode: req.query.coursecode,
    assignment: req.query.assignment,
    description: req.query.description,
    duedate: req.query.duedate,
    type: req.query.type,
    methodology: req.query.methodology,
    learning: req.query.learning,
    doclink: req.query.doclink,
    status1: "Submitted",
    comments: "NA",
  });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
    status: "Success",
  });

  //     try{
  //         const token=req.query.token;
  //         //console.log(token);
  //         let jwtuser='';
  //         let jwtcolid='';
  //         try {
  //             const verified = jwt.verify(
  //                 token,
  //                 process.env.JWT_SECRET,
  //                 (err123, verified) => {
  //                   if (err123) {
  //                     return res.status(401).json({
  //                         status: 'Unauthorized',
  //                         error: err123
  //                     });
  //                   }
  //                   jwtuser=verified.user;
  //                   jwtcolid=verified.colid;
  //                   return verified;
  //                 }
  //               );
  //         } catch(err1234) {
  //             //console.log(err1234);
  //         }

  //         const pub1= await massignments.create({
  //             name: req.query.name,
  //             colid: req.query.colid,
  //             user: req.query.user,
  //             year:req.query.year,
  // course:req.query.course,
  // coursecode:req.query.coursecode,
  // assignment:req.query.assignment,
  // description:req.query.description,
  // duedate:req.query.duedate,
  // type:req.query.type,
  // methodology:req.query.methodology,
  // learning:req.query.learning,
  // doclink:req.query.doclink,
  // status1: 'Submitted',
  //             comments: 'NA'
  //         });

  //     //res.status(200).send('Hello world for all the tours through db new router');
  //     return res.status(200).json({
  //         status:'Success'
  //     });

  // } catch(err) {
  //     res.status(400).json({
  //         status:'Failed',
  //         message: err
  //     });

  // }
};

exports.updatemassignmentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await massignments.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      assignment: req.query.assignment,
      description: req.query.description,
      duedate: req.query.duedate,
      type: req.query.type,
      methodology: req.query.methodology,
      learning: req.query.learning,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemassignmentscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await massignments.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemassignmentsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await massignments.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmanouncementsbyfac = async (req, res) => {
  try {
    const lcat1233 = await manouncements.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.manouncementsbydep = async (req, res) => {
  try {
    const lcat1233 = await manouncements.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.manouncementsbyprog = async (req, res) => {
  try {
    const lcat1233 = await manouncements.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.manouncementsdocs = async (req, res) => {
  try {
    const lcat1233 = await manouncements.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.manouncementslinks = async (req, res) => {
  try {
    const lcat1233 = await manouncements.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmanouncementsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await manouncements.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      announcement: req.query.announcement,
      submitdate: req.query.submitdate,
      type: req.query.type,
      target: req.query.target,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemanouncementsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await manouncements.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      announcement: req.query.announcement,
      submitdate: req.query.submitdate,
      type: req.query.type,
      target: req.query.target,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemanouncementscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await manouncements.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemanouncementsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await manouncements.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmcoursecobyfac = async (req, res) => {
  try {
    const lcat1233 = await mcourseco.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursecobydep = async (req, res) => {
  try {
    const lcat1233 = await mcourseco.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursecobyprog = async (req, res) => {
  try {
    const lcat1233 = await mcourseco.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursecodocs = async (req, res) => {
  try {
    const lcat1233 = await mcourseco.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursecolinks = async (req, res) => {
  try {
    const lcat1233 = await mcourseco.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmcoursecobyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mcourseco.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      cocode: req.query.cocode,
      co: req.query.co,
      type: req.query.type,
      targetlevel: req.query.targetlevel,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemcoursecobyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mcourseco.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      cocode: req.query.cocode,
      co: req.query.co,
      type: req.query.type,
      targetlevel: req.query.targetlevel,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemcoursecocomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mcourseco.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemcoursecobyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mcourseco.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmcalendarbyfac = async (req, res) => {
  try {
    const lcat1233 = await mcalendar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcalendarbydep = async (req, res) => {
  try {
    const lcat1233 = await mcalendar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcalendarbyprog = async (req, res) => {
  try {
    const lcat1233 = await mcalendar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcalendardocs = async (req, res) => {
  try {
    const lcat1233 = await mcalendar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcalendarlinks = async (req, res) => {
  try {
    const lcat1233 = await mcalendar.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmcalendarbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mcalendar.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      title: req.query.title,
      eventdate: req.query.eventdate,
      type: req.query.type,
      location: req.query.location,
      duration: req.query.duration,
      monthofyear: req.query.monthofyear,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemcalendarbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mcalendar.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      title: req.query.title,
      eventdate: req.query.eventdate,
      type: req.query.type,
      location: req.query.location,
      duration: req.query.duration,
      monthofyear: req.query.monthofyear,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemcalendarcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mcalendar.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemcalendarbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mcalendar.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmcoursematerialbyfac = async (req, res) => {
  try {
    const lcat1233 = await mcoursematerial.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursematerialbydep = async (req, res) => {
  try {
    const lcat1233 = await mcoursematerial.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursematerialbyprog = async (req, res) => {
  try {
    const lcat1233 = await mcoursematerial.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursematerialdocs = async (req, res) => {
  try {
    const lcat1233 = await mcoursematerial.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mcoursemateriallinks = async (req, res) => {
  try {
    const lcat1233 = await mcoursematerial.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmcoursematerialbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mcoursematerial.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      slideno: req.query.slideno,
      title: req.query.title,
      description: req.query.description,
      imagelink: req.query.imagelink,
      voicetext: req.query.voicetext,
      doclink: req.query.doclink,
      type: req.query.type,
      mode: req.query.mode,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemcoursematerialbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mcoursematerial.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      slideno: req.query.slideno,
      title: req.query.title,
      description: req.query.description,
      imagelink: req.query.imagelink,
      voicetext: req.query.voicetext,
      doclink: req.query.doclink,
      type: req.query.type,
      mode: req.query.mode,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemcoursematerialcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mcoursematerial.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemcoursematerialbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mcoursematerial.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// jul 8 2024 graph

exports.getmassignmentscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await massignments.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$learning",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmassignmentssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await massignments.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmassignmentscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await massignments.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
        },
      },
      {
        $group: {
          _id: "$learning",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmassignmentssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const coursecode = req.query.coursecode;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await massignments.aggregate([
      {
        $match: { colid: colid1, user: user1, coursecode: coursecode },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmanouncementscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await manouncements.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$target",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmanouncementssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await manouncements.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmanouncementscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await manouncements.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$target",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmanouncementssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await manouncements.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursecocount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseco.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$targetlevel",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursecosecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseco.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursecocountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseco.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
        },
      },
      {
        $group: {
          _id: "$targetlevel",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursecosecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcourseco.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
        },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcalendarcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcalendar.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$monthofyear",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcalendarsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcalendar.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcalendarcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcalendar.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$monthofyear",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcalendarsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcalendar.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursematerialcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcoursematerial.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$mode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursematerialsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcoursematerial.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursematerialcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcoursematerial.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
        },
      },
      {
        $group: {
          _id: "$mode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmcoursematerialsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mcoursematerial.aggregate([
      {
        $match: {
          colid: colid1,
          user: user1,
          coursecode: req.query.coursecode,
        },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// jul 20 2024

exports.getmassignsubmitbyfac = async (req, res) => {
  try {
    const lcat1233 = await massignsubmit.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          assignmentid: req.query.assignmentid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getmassignsubmitbyass = async (req, res) => {
  try {
    const lcat1233 = await massignsubmit.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          assignmentid: req.query.assignmentid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignsubmitbydep = async (req, res) => {
  try {
    const lcat1233 = await massignsubmit.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignsubmitbyprog = async (req, res) => {
  try {
    const lcat1233 = await massignsubmit.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignsubmitdocs = async (req, res) => {
  try {
    const lcat1233 = await massignsubmit.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.massignsubmitlinks = async (req, res) => {
  try {
    const lcat1233 = await massignsubmit.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmassignsubmitbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await massignsubmit.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      assignment: req.query.assignment,
      assignmentid: req.query.assignmentid,
      student: req.query.student,
      regno: req.query.regno,
      description: req.query.description,
      submitdate: req.query.submitdate,
      doclink: req.query.doclink,
      ascomments: req.query.ascomments,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemassignsubmitbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await massignsubmit.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      assignment: req.query.assignment,
      assignmentid: req.query.assignmentid,
      student: req.query.student,
      regno: req.query.regno,
      description: req.query.description,
      submitdate: req.query.submitdate,
      doclink: req.query.doclink,
      ascomments: req.query.ascomments,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemassignsubmitcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await massignsubmit.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemassignsubmitbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await massignsubmit.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getmdiscussionbyfac = async (req, res) => {
  try {
    const lcat1233 = await mdiscussion.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getmdiscussionbycode = async (req, res) => {
  try {
    const lcat1233 = await mdiscussion.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mdiscussionbydep = async (req, res) => {
  try {
    const lcat1233 = await mdiscussion.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mdiscussionbyprog = async (req, res) => {
  try {
    const lcat1233 = await mdiscussion.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mdiscussiondocs = async (req, res) => {
  try {
    const lcat1233 = await mdiscussion.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mdiscussionlinks = async (req, res) => {
  try {
    const lcat1233 = await mdiscussion.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmdiscussionbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mdiscussion.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      title: req.query.title,
      submitdate: req.query.submitdate,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemdiscussionbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mdiscussion.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      title: req.query.title,
      submitdate: req.query.submitdate,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemdiscussioncomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mdiscussion.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemdiscussionbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mdiscussion.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// aug 2 2024

exports.getquotanewbyfac = async (req, res) => {
  try {
    const lcat1233 = await quotanew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.quotanewbydep = async (req, res) => {
  try {
    const lcat1233 = await quotanew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.quotanewbyprog = async (req, res) => {
  try {
    const lcat1233 = await quotanew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.quotanewdocs = async (req, res) => {
  try {
    const lcat1233 = await quotanew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.quotanewlinks = async (req, res) => {
  try {
    const lcat1233 = await quotanew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createquotanewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await quotanew.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      type: req.query.type,
      subscription: req.query.subscription,
      limit: req.query.limit,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatequotanewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await quotanew.findByIdAndUpdate(req.query.id, {
      type: req.query.type,
      subscription: req.query.subscription,
      limit: req.query.limit,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatequotanewcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await quotanew.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletequotanewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await quotanew.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// aug 2 2024 graph

exports.getquotanewcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await quotanew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$subscription",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getquotanewsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await quotanew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getquotanewcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await quotanew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$subscription",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getquotanewsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await quotanew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 4 2024

exports.getclassnewbyfac = async (req, res) => {
  try {
    const lcat1233 = await classnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classnewbydep = async (req, res) => {
  try {
    const lcat1233 = await classnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classnewbyprog = async (req, res) => {
  try {
    const lcat1233 = await classnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classnewdocs = async (req, res) => {
  try {
    const lcat1233 = await classnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.classnewlinks = async (req, res) => {
  try {
    const lcat1233 = await classnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createclassnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await classnew.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      semester: req.query.semester,
      section: req.query.section,
      classdate: req.query.classdate,
      classtime: req.query.classtime,
      topic: req.query.topic,
      module: req.query.module,
      link: req.query.link,
      classtype: req.query.classtype,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateclassnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await classnew.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      program: req.query.program,
      programcode: req.query.programcode,
      course: req.query.course,
      coursecode: req.query.coursecode,
      semester: req.query.semester,
      section: req.query.section,
      classdate: req.query.classdate,
      classtime: req.query.classtime,
      topic: req.query.topic,
      module: req.query.module,
      link: req.query.link,
      classtype: req.query.classtype,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateclassnewcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await classnew.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteclassnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await classnew.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getattendancenewbyfac = async (req, res) => {
  try {
    const lcat1233 = await attendancenew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          classid: req.query.classid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.attendancenewbydep = async (req, res) => {
  try {
    const lcat1233 = await attendancenew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.attendancenewbyprog = async (req, res) => {
  try {
    const lcat1233 = await attendancenew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.attendancenewdocs = async (req, res) => {
  try {
    const lcat1233 = await attendancenew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.attendancenewlinks = async (req, res) => {
  try {
    const lcat1233 = await attendancenew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createattendancenewbyfac2 = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await attendancenew.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      classid: req.query.classid,
      programcode: req.query.programcode,
      program: req.query.program,
      course: req.query.course,
      coursecode: req.query.coursecode,
      student: req.query.student,
      regno: req.query.regno,
      att: req.query.att,
      classdate: req.query.classdate,
      semester: req.query.semester,
      section: req.query.section,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.createattendancenewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    //       const pub1= await attendancenew.create({
    //           name: req.query.name,
    //           colid: req.query.colid,
    //           user: req.query.user,
    //           year:req.query.year,
    // classid:req.query.classid,
    // programcode:req.query.programcode,
    // program:req.query.program,
    // course:req.query.course,
    // coursecode:req.query.coursecode,
    // student:req.query.student,
    // regno:req.query.regno,
    // att:req.query.att,
    // classdate:req.query.classdate,
    // semester:req.query.semester,
    // section:req.query.section,
    // status1: 'Submitted',
    //           comments: 'NA'
    //       });

    const pat1 = await attendancenew.findOneAndUpdate(
      {
        classid: req.query.classid,
        regno: req.query.regno,
        student: req.query.student,
      },
      {
        name: req.query.name,
        colid: req.query.colid,
        user: req.query.user,
        year: req.query.year,
        programcode: req.query.programcode,
        program: req.query.program,
        course: req.query.course,
        coursecode: req.query.coursecode,
        att: req.query.att,
        classdate: req.query.classdate,
        semester: req.query.semester,
        section: req.query.section,
        status1: "Submitted",
        comments: "NA",
      },
      {
        new: true,
        upsert: true,
      }
    );

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.updateattendancenewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await attendancenew.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      classid: req.query.classid,
      programcode: req.query.programcode,
      program: req.query.program,
      course: req.query.course,
      coursecode: req.query.coursecode,
      student: req.query.student,
      regno: req.query.regno,
      att: req.query.att,
      classdate: req.query.classdate,
      semester: req.query.semester,
      section: req.query.section,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateattendancenewcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await attendancenew.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteattendancenewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await attendancenew.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// aug 4 2024 graph

exports.getclassnewcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$semester",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getclassnewsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$coursecode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getclassnewcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$semester",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getclassnewsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await classnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$coursecode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getattendancenewcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$semester",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getattendancenewsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$coursecode",
          total_attendance: { $avg: "$att" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getattendancenewcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$semester",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getattendancenewsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$coursecode",
          total_attendance: { $avg: "$att" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 9 2024

exports.getattsummarybyccode = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: {
          colid: colid1,
          year: req.query.year,
          coursecode: req.query.coursecode,
          classdate: {
            $gte: date1,
            $lte: date2,
          },
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            coursecode: "$coursecode",
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $avg: "$att" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getattbypcodesem = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: {
          colid: colid1,
          year: req.query.year,
          semester: req.query.semester,
          programcode: req.query.programcode,
          classdate: {
            $gte: date1,
            $lte: date2,
          },
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            coursecode: "$coursecode",
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $avg: "$att" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

// aug 10 2024

exports.getclassnewbyfacdate = async (req, res) => {
  try {
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);

    const lcat1233 = await classnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          classdate: {
            $gte: date1,
            $lte: date2,
          },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getclassnewbypyss = async (req, res) => {
  try {
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);

    const lcat1233 = await classnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
          year: req.query.year,
          semester: req.query.semester,
          section: req.query.section,
          classdate: {
            $gte: date1,
            $lte: date2,
          },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

// aug 12 2024

exports.getscholnewbyfac = async (req, res) => {
  try {
    const lcat1233 = await scholnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.scholnewbydep = async (req, res) => {
  try {
    const lcat1233 = await scholnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.scholnewbyprog = async (req, res) => {
  try {
    const lcat1233 = await scholnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.scholnewdocs = async (req, res) => {
  try {
    const lcat1233 = await scholnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.scholnewlinks = async (req, res) => {
  try {
    const lcat1233 = await scholnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createscholnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await scholnew.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      scholarship: req.query.scholarship,
      type: req.query.type,
      student: req.query.student,
      regno: req.query.regno,
      amount: req.query.amount,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatescholnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await scholnew.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      scholarship: req.query.scholarship,
      type: req.query.type,
      student: req.query.student,
      regno: req.query.regno,
      amount: req.query.amount,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatescholnewcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await scholnew.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletescholnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await scholnew.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getstudawardsnewbyfac = async (req, res) => {
  try {
    const lcat1233 = await studawardsnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.studawardsnewbydep = async (req, res) => {
  try {
    const lcat1233 = await studawardsnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.studawardsnewbyprog = async (req, res) => {
  try {
    const lcat1233 = await studawardsnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.studawardsnewdocs = async (req, res) => {
  try {
    const lcat1233 = await studawardsnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.studawardsnewlinks = async (req, res) => {
  try {
    const lcat1233 = await studawardsnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createstudawardsnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await studawardsnew.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      event: req.query.event,
      type: req.query.type,
      student: req.query.student,
      regno: req.query.regno,
      award: req.query.award,
      amount: req.query.amount,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatestudawardsnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await studawardsnew.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      event: req.query.event,
      type: req.query.type,
      student: req.query.student,
      regno: req.query.regno,
      award: req.query.award,
      amount: req.query.amount,
      doclink: req.query.doclink,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatestudawardsnewcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await studawardsnew.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletestudawardsnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await studawardsnew.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// aug 12 2024 graph

exports.getscholnewcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await scholnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: "$amount" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getscholnewsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await scholnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getscholnewcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await scholnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: "$amount" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getscholnewsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await scholnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getstudawardsnewcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await studawardsnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getstudawardsnewsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await studawardsnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getstudawardsnewcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await studawardsnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getstudawardsnewsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await studawardsnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 12 2024 stud

exports.getscholnewstudbyfac = async (req, res) => {
  try {
    const lcat1233 = await scholnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          regno: req.query.regno,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getstudawardsnewstudbyfac = async (req, res) => {
  try {
    const lcat1233 = await studawardsnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          regno: req.query.regno,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

// aug 12 2024 stud graph

exports.getscholnewcountbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await scholnew.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: "$amount" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getscholnewsecondbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await scholnew.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getstudawardsnewcountbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await studawardsnew.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getstudawardsnewsecondbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await studawardsnew.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 12 2024

exports.getslideshowbymoduleid = async (req, res) => {
  try {
    const lcat1233 = await slideshow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          moduleid: req.query.moduleid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getslideshowbyfac = async (req, res) => {
  try {
    const lcat1233 = await slideshow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          moduleid: req.query.moduleid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.slideshowbydep = async (req, res) => {
  try {
    const lcat1233 = await slideshow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.slideshowbyprog = async (req, res) => {
  try {
    const lcat1233 = await slideshow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.slideshowdocs = async (req, res) => {
  try {
    const lcat1233 = await slideshow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.slideshowlinks = async (req, res) => {
  try {
    const lcat1233 = await slideshow.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createslideshowbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await slideshow.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      moduleid: req.query.moduleid,
      description: req.query.description,
      imagelink: req.query.imagelink,
      type: req.query.type,
      slideno: req.query.slideno,
      ctype: req.query.ctype,
      duration: req.query.duration,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateslideshowbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await slideshow.findByIdAndUpdate(req.query.id, {
      moduleid: req.query.moduleid,
      description: req.query.description,
      imagelink: req.query.imagelink,
      type: req.query.type,
      slideno: req.query.slideno,
      ctype: req.query.ctype,
      duration: req.query.duration,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateslideshowcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await slideshow.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteslideshowbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await slideshow.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// graph

exports.getslideshowcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await slideshow.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$ctype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getslideshowsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await slideshow.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getslideshowcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await slideshow.aggregate([
      {
        $match: { colid: colid1, user: user1, moduleid: req.query.moduleid },
      },
      {
        $group: {
          _id: "$ctype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getslideshowsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await slideshow.aggregate([
      {
        $match: { colid: colid1, user: user1, moduleid: req.query.moduleid },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 16 2024

exports.geteventsnew1byfac = async (req, res) => {
  try {
    const lcat1233 = await eventsnew1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.eventsnew1bydep = async (req, res) => {
  try {
    const lcat1233 = await eventsnew1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.eventsnew1byprog = async (req, res) => {
  try {
    const lcat1233 = await eventsnew1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.eventsnew1docs = async (req, res) => {
  try {
    const lcat1233 = await eventsnew1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.eventsnew1links = async (req, res) => {
  try {
    const lcat1233 = await eventsnew1.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createeventsnew1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await eventsnew1.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      event: req.query.event,
      department: req.query.department,
      startdate: req.query.startdate,
      description: req.query.description,
      brochurelink: req.query.brochurelink,
      reportlink: req.query.reportlink,
      coordinator: req.query.coordinator,
      type: req.query.type,
      level: req.query.level,
      collab: req.query.collab,
      moulink: req.query.moulink,
      participants: req.query.participants,
      duration: req.query.duration,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updateeventsnew1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await eventsnew1.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      event: req.query.event,
      department: req.query.department,
      startdate: req.query.startdate,
      description: req.query.description,
      brochurelink: req.query.brochurelink,
      reportlink: req.query.reportlink,
      coordinator: req.query.coordinator,
      type: req.query.type,
      level: req.query.level,
      collab: req.query.collab,
      moulink: req.query.moulink,
      participants: req.query.participants,
      duration: req.query.duration,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updateeventsnew1comments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await eventsnew1.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deleteeventsnew1byfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await eventsnew1.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.geteventsnew1count = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await eventsnew1.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.geteventsnew1second = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await eventsnew1.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.geteventsnew1countbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await eventsnew1.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.geteventsnew1secondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await eventsnew1.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 18 2024

exports.gettestnewbyfac = async (req, res) => {
  try {
    const lcat1233 = await testnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.gettestnewbyccode = async (req, res) => {
  try {
    const lcat1233 = await testnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          coursecode: req.query.coursecode,
          year: req.query.year,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testnewbydep = async (req, res) => {
  try {
    const lcat1233 = await testnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testnewbyprog = async (req, res) => {
  try {
    const lcat1233 = await testnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testnewdocs = async (req, res) => {
  try {
    const lcat1233 = await testnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testnewlinks = async (req, res) => {
  try {
    const lcat1233 = await testnew.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createtestnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await testnew.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      coursecode: req.query.coursecode,
      title: req.query.title,
      description: req.query.description,
      starttime: req.query.starttime,
      endtime: req.query.endtime,
      duration: req.query.duration,
      weightage: req.query.weightage,
      type: req.query.type,
      level: req.query.level,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatetestnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await testnew.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      coursecode: req.query.coursecode,
      title: req.query.title,
      description: req.query.description,
      starttime: req.query.starttime,
      endtime: req.query.endtime,
      duration: req.query.duration,
      weightage: req.query.weightage,
      type: req.query.type,
      level: req.query.level,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatetestnewcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await testnew.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletetestnewbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await testnew.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.gettestqbyfac = async (req, res) => {
  try {
    const lcat1233 = await testq.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          testid: req.query.testid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testqbydep = async (req, res) => {
  try {
    const lcat1233 = await testq.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testqbyprog = async (req, res) => {
  try {
    const lcat1233 = await testq.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testqdocs = async (req, res) => {
  try {
    const lcat1233 = await testq.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testqlinks = async (req, res) => {
  try {
    const lcat1233 = await testq.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createtestqbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await testq.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      testid: req.query.testid,
      question: req.query.question,
      type: req.query.type,
      imagelink: req.query.imagelink,
      videolink: req.query.videolink,
      doclink: req.query.doclink,
      co: req.query.co,
      po: req.query.po,
      module: req.query.module,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatetestqbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await testq.findByIdAndUpdate(req.query.id, {
      testid: req.query.testid,
      question: req.query.question,
      type: req.query.type,
      imagelink: req.query.imagelink,
      videolink: req.query.videolink,
      doclink: req.query.doclink,
      co: req.query.co,
      po: req.query.po,
      module: req.query.module,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatetestqcomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await testq.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletetestqbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await testq.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.gettestobyfac = async (req, res) => {
  try {
    const lcat1233 = await testo.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          questionid: req.query.questionid,
          testid: req.query.testid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testobydep = async (req, res) => {
  try {
    const lcat1233 = await testo.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testobyprog = async (req, res) => {
  try {
    const lcat1233 = await testo.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testodocs = async (req, res) => {
  try {
    const lcat1233 = await testo.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testolinks = async (req, res) => {
  try {
    const lcat1233 = await testo.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createtestobyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await testo.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      testid: req.query.testid,
      questionid: req.query.questionid,
      option: req.query.option,
      score: req.query.score,
      imagelink: req.query.imagelink,
      videolink: req.query.videolink,
      doclink: req.query.doclink,
      type: req.query.type,
      difficulty: req.query.difficulty,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatetestobyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await testo.findByIdAndUpdate(req.query.id, {
      testid: req.query.testid,
      questionid: req.query.questionid,
      option: req.query.option,
      score: req.query.score,
      imagelink: req.query.imagelink,
      videolink: req.query.videolink,
      doclink: req.query.doclink,
      type: req.query.type,
      difficulty: req.query.difficulty,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatetestocomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await testo.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletetestobyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await testo.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// graph

exports.gettestnewcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$level",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestnewsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testnew.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestnewcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$level",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestnewcountbyccode = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testnew.aggregate([
      {
        $match: { colid: colid1, coursecode: req.query.coursecode },
      },
      {
        $group: {
          _id: "$level",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestnewsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testnew.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestnewsecondbyccode = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testnew.aggregate([
      {
        $match: { colid: colid1, coursecode: req.query.coursecode },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestqcount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testq.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$module",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestqsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testq.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$co",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestqcountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testq.aggregate([
      {
        $match: { colid: colid1, user: user1, testid: req.query.testid },
      },
      {
        $group: {
          _id: "$module",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestqsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testq.aggregate([
      {
        $match: { colid: colid1, user: user1, testid: req.query.testid },
      },
      {
        $group: {
          _id: "$co",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestocount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testo.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$difficulty",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestosecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testo.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestocountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testo.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$difficulty",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestosecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testo.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 21 2024

exports.gettestscoresbyfac = async (req, res) => {
  try {
    const lcat1233 = await testscores.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testscoresbydep = async (req, res) => {
  try {
    const lcat1233 = await testscores.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testscoresbyprog = async (req, res) => {
  try {
    const lcat1233 = await testscores.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testscoresdocs = async (req, res) => {
  try {
    const lcat1233 = await testscores.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.testscoreslinks = async (req, res) => {
  try {
    const lcat1233 = await testscores.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createtestscoresbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    //         const pub1= await testscores.create({
    //             name: req.query.name,
    //             colid: req.query.colid,
    //             user: req.query.user,
    //             year:req.query.year,
    // coursecode:req.query.coursecode,
    // module:req.query.module,
    // difficulty:req.query.difficulty,
    // testid:req.query.testid,
    // student:req.query.student,
    // regno:req.query.regno,
    // questionid:req.query.questionid,
    // question:req.query.question,
    // option:req.query.option,
    // score:req.query.score,
    // status1: 'Submitted',
    //             comments: 'NA'
    //         });

    const pat1 = await testscores.findOneAndUpdate(
      {
        testid: req.query.testid,
        questionid: req.query.questionid,
        regno: req.query.regno,
        student: req.query.student,
      },
      {
        name: req.query.name,
        colid: req.query.colid,
        user: req.query.user,
        year: req.query.year,
        coursecode: req.query.coursecode,
        module: req.query.module,
        difficulty: req.query.difficulty,
        question: req.query.question,
        option: req.query.option,
        score: req.query.score,
        status1: "Submitted",
        comments: "NA",
      },
      {
        new: true,
        upsert: true,
      }
    );

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatetestscoresbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await testscores.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      coursecode: req.query.coursecode,
      module: req.query.module,
      difficulty: req.query.difficulty,
      testid: req.query.testid,
      student: req.query.student,
      regno: req.query.regno,
      questionid: req.query.questionid,
      question: req.query.question,
      option: req.query.option,
      score: req.query.score,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatetestscorescomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await testscores.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletetestscoresbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await testscores.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.gettestscoresstudbyfac = async (req, res) => {
  try {
    const lcat1233 = await testscores.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          regno: req.query.regno,
          testid: req.query.testid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.gettestscoresummary = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testscores.aggregate([
      {
        $match: {
          colid: colid1,
          testid: req.query.testid,
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $sum: "$score" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

// graph

exports.gettestscorescount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testscores.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$module",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestscoressecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testscores.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$question",
          total_attendance: { $avg: "$score" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestscorescountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testscores.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$module",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestscoressecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testscores.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$question",
          total_attendance: { $avg: "$score" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestscorescountbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testscores.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$module",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.gettestscoressecondbystud = async (req, res) => {
  try {
    const regno = req.query.regno;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await testscores.aggregate([
      {
        $match: { colid: colid1, regno: regno },
      },
      {
        $group: {
          _id: "$difficulty",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// ag 30 test

exports.createtestscoresbyfac2 = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await testscores.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      coursecode: req.query.coursecode,
      module: req.query.module,
      difficulty: req.query.difficulty,
      testid: req.query.testid,
      student: req.query.student,
      regno: req.query.regno,
      questionid: req.query.questionid,
      question: req.query.question,
      option: req.query.option,
      score: req.query.score,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// sep 7 2024

exports.getlmsvideosbyfac = async (req, res) => {
  try {
    const lcat1233 = await lmsvideos.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getlmsvideosbycoursecode = async (req, res) => {
  try {
    const lcat1233 = await lmsvideos.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          coursecode: req.query.coursecode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideosbydep = async (req, res) => {
  try {
    const lcat1233 = await lmsvideos.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideosbyprog = async (req, res) => {
  try {
    const lcat1233 = await lmsvideos.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideosdocs = async (req, res) => {
  try {
    const lcat1233 = await lmsvideos.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideoslinks = async (req, res) => {
  try {
    const lcat1233 = await lmsvideos.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createlmsvideosbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await lmsvideos.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      coursecode: req.query.coursecode,
      title: req.query.title,
      description: req.query.description,
      module: req.query.module,
      type: req.query.type,
      target: req.query.target,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });
  }
};

exports.updatelmsvideosbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await lmsvideos.findByIdAndUpdate(req.query.id, {
      coursecode: req.query.coursecode,
      title: req.query.title,
      description: req.query.description,
      module: req.query.module,
      type: req.query.type,
      target: req.query.target,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatelmsvideoscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await lmsvideos.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletelmsvideosbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await lmsvideos.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getlmsvideoscbyfac = async (req, res) => {
  try {
    const lcat1233 = await lmsvideosc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          videoid: req.query.videoid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getlmsvideoscsbyfac = async (req, res) => {
  try {
    const lcat1233 = await lmsvideosc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          videoid: req.query.videoid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideoscbydep = async (req, res) => {
  try {
    const lcat1233 = await lmsvideosc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideoscbyprog = async (req, res) => {
  try {
    const lcat1233 = await lmsvideosc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideoscdocs = async (req, res) => {
  try {
    const lcat1233 = await lmsvideosc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lmsvideosclinks = async (req, res) => {
  try {
    const lcat1233 = await lmsvideosc.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createlmsvideoscbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await lmsvideosc.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      videoid: req.query.videoid,
      coursecode: req.query.coursecode,
      video: req.query.video,
      title: req.query.title,
      image: req.query.image,
      voicetext: req.query.voicetext,
      duration: req.query.duration,
      type: req.query.type,
      language: req.query.language,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatelmsvideoscbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await lmsvideosc.findByIdAndUpdate(req.query.id, {
      videoid: req.query.videoid,
      coursecode: req.query.coursecode,
      video: req.query.video,
      title: req.query.title,
      image: req.query.image,
      voicetext: req.query.voicetext,
      duration: req.query.duration,
      type: req.query.type,
      language: req.query.language,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatelmsvideosccomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await lmsvideosc.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletelmsvideoscbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await lmsvideosc.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// sep 7 graph

exports.getlmsvideoscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideos.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$target",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlmsvideossecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideos.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlmsvideoscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideos.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$target",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlmsvideossecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideos.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlmsvideosccount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideosc.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$language",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlmsvideoscsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideosc.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlmsvideosccountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideosc.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$language",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlmsvideoscsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lmsvideosc.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// sep 12 2024

exports.createuserbyfac = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";

    var someDate = new Date();

    
    
    var numberOfDaysToAdd = 6;
    var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
    var dt2=new Date(result);

    const pub1 = await User.create({
      name: req.query.name,
      colid: 111356,
      user: req.query.email,
      email: req.query.email,
      phone: req.query.phone,
      password: req.query.password,
      role: "Faculty",
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: "NA",
      department: req.query.department,
      category: "NA",
      status: 0,
      lastlogin: someDate,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.createuserbyrole1 = async (req, res) => {
  try {
    console.log("API Called")
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";

    var someDate = new Date();

    const pub2 = await User.find().sort({colid:-1}).limit(1);

    var colid1=0;

    pub2.forEach(async function(data){
      colid1=data.colid + 1;

    });
    //console.log(colid1);
    
    
    var numberOfDaysToAdd = 6;
    var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
    var dt2=new Date(result);

    const pub1 = await User.create({
      name: req.query.name,
      colid: colid1,
      user: req.query.email,
      email: req.query.email,
      phone: req.query.phone,
      password: req.query.password,
      role: req.query.role,
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: "NA",
      department: req.query.department,
      category: "NA",
      status: 0,
      lastlogin: someDate,
      status1: "Submitted",
      comments: "NA",
    });

     if(!pub1) {
      console.log("User not created");
      return res.status(400).json({
        status: "Failed",
        message: "User not created successfully",
      });
     }

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.createquotanewbyfac1 = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";

    const pub1 = await quotanew.create({
      name: req.query.name,
      colid: 111356,
      user: req.query.user,
      type: req.query.type,
      subscription: req.query.subscription,
      limit: req.query.limit,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// sep 13 2024

exports.getmvacbyfac = async (req, res) => {
  try {
    const lcat1233 = await mvac.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mvacbydep = async (req, res) => {
  try {
    const lcat1233 = await mvac.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mvacbyprog = async (req, res) => {
  try {
    const lcat1233 = await mvac.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mvacdocs = async (req, res) => {
  try {
    const lcat1233 = await mvac.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.mvaclinks = async (req, res) => {
  try {
    const lcat1233 = await mvac.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createmvacbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await mvac.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      startdate: req.query.startdate,
      enddate: req.query.enddate,
      duration: req.query.duration,
      studenroll: req.query.studenroll,
      studcomplete: req.query.studcomplete,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatemvacbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await mvac.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      course: req.query.course,
      coursecode: req.query.coursecode,
      startdate: req.query.startdate,
      enddate: req.query.enddate,
      duration: req.query.duration,
      studenroll: req.query.studenroll,
      studcomplete: req.query.studcomplete,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatemvaccomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await mvac.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletemvacbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await mvac.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

// graph

exports.getmvaccount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mvac.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmvacsecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mvac.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmvaccountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mvac.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$year",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getmvacsecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mvac.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// sep 19 2024

exports.updatepasswordbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await User.findOneAndUpdate(
      { email: req.query.user },
      {
        password: req.query.password,
      }
    );
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

// sep 19 2024

exports.getlpublicationsbyfac = async (req, res) => {
  try {
    const lcat1233 = await lpublications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          user: req.query.user,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.getlpublicationspublic = async (req, res) => {
  try {
    const lcat1233 = await lpublications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          type: "Public",
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpublicationsbydep = async (req, res) => {
  try {
    const lcat1233 = await lpublications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpublicationsbyprog = async (req, res) => {
  try {
    const lcat1233 = await lpublications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpublicationsdocs = async (req, res) => {
  try {
    const lcat1233 = await lpublications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpublicationslinks = async (req, res) => {
  try {
    const lcat1233 = await lpublications.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createlpublicationsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await lpublications.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      institution: req.query.institution,
      publication: req.query.publication,
      issn: req.query.issn,
      editor: req.query.editor,
      frequency: req.query.frequency,
      publisher: req.query.publisher,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatelpublicationsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await lpublications.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      institution: req.query.institution,
      publication: req.query.publication,
      issn: req.query.issn,
      editor: req.query.editor,
      frequency: req.query.frequency,
      publisher: req.query.publisher,
      type: req.query.type,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatelpublicationscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await lpublications.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletelpublicationsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await lpublications.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getlpubeditionsbyfac = async (req, res) => {
  try {
    const lcat1233 = await lpubeditions.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          pubid: req.query.pubid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubeditionsbydep = async (req, res) => {
  try {
    const lcat1233 = await lpubeditions.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubeditionsbyprog = async (req, res) => {
  try {
    const lcat1233 = await lpubeditions.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubeditionsdocs = async (req, res) => {
  try {
    const lcat1233 = await lpubeditions.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubeditionslinks = async (req, res) => {
  try {
    const lcat1233 = await lpubeditions.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createlpubeditionsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await lpubeditions.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      year: req.query.year,
      pubid: req.query.pubid,
      publication: req.query.publication,
      edition: req.query.edition,
      pubmonth: req.query.pubmonth,
      pubstatus: req.query.pubstatus,
      mode: req.query.mode,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatelpubeditionsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await lpubeditions.findByIdAndUpdate(req.query.id, {
      year: req.query.year,
      pubid: req.query.pubid,
      publication: req.query.publication,
      edition: req.query.edition,
      pubmonth: req.query.pubmonth,
      pubstatus: req.query.pubstatus,
      mode: req.query.mode,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatelpubeditionscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await lpubeditions.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletelpubeditionsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await lpubeditions.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getlpubarticlesbyfac = async (req, res) => {
  try {
    const lcat1233 = await lpubarticles.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          editionid: req.query.editionid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubarticlesbydep = async (req, res) => {
  try {
    const lcat1233 = await lpubarticles.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubarticlesbyprog = async (req, res) => {
  try {
    const lcat1233 = await lpubarticles.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubarticlesdocs = async (req, res) => {
  try {
    const lcat1233 = await lpubarticles.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubarticleslinks = async (req, res) => {
  try {
    const lcat1233 = await lpubarticles.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createlpubarticlesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await lpubarticles.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      editionid: req.query.editionid,
      author: req.query.author,
      institution: req.query.institution,
      article: req.query.article,
      description: req.query.description,
      abstractlink: req.query.abstractlink,
      articlelink: req.query.articlelink,
      pubstatus: req.query.pubstatus,
      authortype: req.query.authortype,
      submitdate: req.query.submitdate,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatelpubarticlesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await lpubarticles.findByIdAndUpdate(req.query.id, {
      editionid: req.query.editionid,
      author: req.query.author,
      institution: req.query.institution,
      article: req.query.article,
      description: req.query.description,
      abstractlink: req.query.abstractlink,
      articlelink: req.query.articlelink,
      pubstatus: req.query.pubstatus,
      authortype: req.query.authortype,
      submitdate: req.query.submitdate,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatelpubarticlescomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await lpubarticles.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletelpubarticlesbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await lpubarticles.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getlpubreviewsbyfac = async (req, res) => {
  try {
    const lcat1233 = await lpubreviews.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          articleid: req.query.articleid,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubreviewsbydep = async (req, res) => {
  try {
    const lcat1233 = await lpubreviews.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          department: req.query.department,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubreviewsbyprog = async (req, res) => {
  try {
    const lcat1233 = await lpubreviews.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          programcode: req.query.programcode,
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubreviewsdocs = async (req, res) => {
  try {
    const lcat1233 = await lpubreviews.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.lpubreviewslinks = async (req, res) => {
  try {
    const lcat1233 = await lpubreviews.aggregate([
      { $addFields: { userId: { $toString: "$_id" } } },
      {
        $lookup: {
          from: "supportingdocs",
          localField: "userId",
          foreignField: "field1",
          as: "seminars",
        },
      },
      {
        $lookup: {
          from: "accrcomments",
          localField: "userId",
          foreignField: "field1",
          as: "allcomments",
        },
      },
      {
        $match: {
          colid: parseInt(req.query.colid),
          status1: { $ne: req.query.status1 },
        },
      },
    ]);

    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

exports.createlpubreviewsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const pub1 = await lpubreviews.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.user,
      articleid: req.query.articleid,
      peer: req.query.peer,
      designation: req.query.designation,
      rcomments: req.query.rcomments,
      submitdate: req.query.submitdate,
      peertye: req.query.peertye,
      commenttype: req.query.commenttype,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    // res.status(400).json({
    //    status:'Failed',
    //  message: err
    // });
  }
};

exports.updatelpubreviewsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const lcat1 = await lpubreviews.findByIdAndUpdate(req.query.id, {
      articleid: req.query.articleid,
      peer: req.query.peer,
      designation: req.query.designation,
      rcomments: req.query.rcomments,
      submitdate: req.query.submitdate,
      peertye: req.query.peertye,
      commenttype: req.query.commenttype,
      status1: "Submitted",
      comments: "NA",
    });
    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.updatelpubreviewscomments = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }
    const lcat1 = await lpubreviews.findByIdAndUpdate(req.query.id, {
      status1: req.query.status1,
      comments: req.query.comments,
    });

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.deletelpubreviewsbyfac = async (req, res) => {
  try {
    const token = req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    try {
      const verified = jwt.verify(
        token,
        process.env.JWT_SECRET,
        (err123, verified) => {
          if (err123) {
            return res.status(401).json({
              status: "Unauthorized",
              error: err123,
            });
          }
          jwtuser = verified.user;
          jwtcolid = verified.colid;
          return verified;
        }
      );
    } catch (err1234) {
      //console.log(err1234);
    }

    const user1 = req.query.user;
    await lpubreviews.findByIdAndDelete(req.query.id);

    return res.status(200).json({
      status: "Success",
    });
  } catch (err) {
    /* res.status(400).json({
            status:'Failed',
            message: err
        }); */
  }
};

exports.getlpublicationscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpublications.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpublicationssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpublications.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$frequency",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpublicationscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpublications.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$type",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpublicationssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpublications.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$frequency",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubeditionscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubeditions.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$mode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubeditionssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubeditions.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$pubstatus",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubeditionscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubeditions.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$mode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubeditionssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubeditions.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$pubstatus",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubarticlescount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubarticles.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$authortype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubarticlessecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubarticles.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$pubstatus",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubarticlescountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubarticles.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$authortype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubarticlessecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubarticles.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$pubstatus",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// exports.getlpubeditionscount= async (req,res) => {
//   try{
//   //const user1=req.query.user;
//   const colid1=parseInt(req.query.colid);
//   const lcat1233= await lpubeditions.aggregate([
//   {
//   $match: {colid: colid1 }
//   },
//   {
//   $group: {
//   _id:'$peertype',
//   total_attendance: {$sum : 1}
//   }
//   }
//   ]);
//   //console.log(lcat1233);
//   return res.status(200).json({
//   status:'Success',
//   data: {
//   classes : lcat1233
//   }
//   });
//   } catch(err) {
//   res.status(400).json({
//   status:'Failed',
//   message: err
//   });

//   }
//   };

//   exports.getlpubeditionssecond= async (req,res) => {
//     try{
//     //const user1=req.query.user;
//     const colid1=parseInt(req.query.colid);
//     const lcat1233= await lpubeditions.aggregate([
//     {
//     $match: {colid: colid1 }
//     },
//     {
//     $group: {
//     _id:'$commenttype',
//     total_attendance: {$sum : 1}
//     }
//     }
//     ]);
//     //console.log(lcat1233);
//     return res.status(200).json({
//     status:'Success',
//     data: {
//     classes : lcat1233
//     }
//     });
//     } catch(err) {
//     res.status(400).json({
//     status:'Failed',
//     message: err
//     });

//     }
//     };

// exports.getlpubeditionscountbyfac= async (req,res) => {
//   try{
//   const user1=req.query.user;
//   const colid1=parseInt(req.query.colid);
//   const lcat1233= await lpubeditions.aggregate([
//   {
//   $match: {colid: colid1, user: user1 }
//   },
//   {
//   $group: {
//   _id:'$peertype',
//   total_attendance: {$sum : 1}
//   }
//   }
//   ]);
//   //console.log(lcat1233);
//   return res.status(200).json({
//   status:'Success',
//   data: {
//   classes : lcat1233
//   }
//   });
//   } catch(err) {
//   res.status(400).json({
//   status:'Failed',
//   message: err
//   });

//   }
//   };

//   exports.getlpubeditionssecondbyfac= async (req,res) => {
//     try{
//     const user1=req.query.user;
//     const colid1=parseInt(req.query.colid);
//     const lcat1233= await lpubeditions.aggregate([
//     {
//     $match: {colid: colid1, user: user1 }
//     },
//     {
//     $group: {
//     _id:'$commenttype',
//     total_attendance: {$sum : 1}
//     }
//     }
//     ]);
//     //console.log(lcat1233);
//     return res.status(200).json({
//     status:'Success',
//     data: {
//     classes : lcat1233
//     }
//     });
//     } catch(err) {
//     res.status(400).json({
//     status:'Failed',
//     message: err
//     });

//     }
//     };

exports.getlpubreviewscount = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubreviews.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$peertype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubreviewssecond = async (req, res) => {
  try {
    //const user1=req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubreviews.aggregate([
      {
        $match: { colid: colid1 },
      },
      {
        $group: {
          _id: "$commenttype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubreviewscountbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubreviews.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$peertype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getlpubreviewssecondbyfac = async (req, res) => {
  try {
    const user1 = req.query.user;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await lpubreviews.aggregate([
      {
        $match: { colid: colid1, user: user1 },
      },
      {
        $group: {
          _id: "$commenttype",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};


// sep 30 2024


exports.getmplacementbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mplacement
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mplacementdocs= async (req,res) => {
  try{
      
      const lcat1233= await mplacement
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mplacementlinks= async (req,res) => {
try{
    
    const lcat1233= await mplacement
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmplacementbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mplacement.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
student:req.query.student,
regno:req.query.regno,
phone:req.query.phone,
email:req.query.email,
program:req.query.program,
programcode:req.query.programcode,
employer:req.query.employer,
empaddress:req.query.empaddress,
empcontact:req.query.empcontact,
salary:req.query.salary,
type:req.query.type,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemplacementbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mplacement.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
student:req.query.student,
regno:req.query.regno,
phone:req.query.phone,
email:req.query.email,
program:req.query.program,
programcode:req.query.programcode,
employer:req.query.employer,
empaddress:req.query.empaddress,
empcontact:req.query.empcontact,
salary:req.query.salary,
type:req.query.type,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemplacementcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mplacement.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemplacementbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mplacement.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmplacementcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mplacement.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmplacementsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mplacement.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmplacementcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mplacement.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmplacementsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mplacement.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  


// sep 30 2024 1


exports.getmassetsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await massets
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.massetsdocs= async (req,res) => {
  try{
      
      const lcat1233= await massets
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.massetslinks= async (req,res) => {
try{
    
    const lcat1233= await massets
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmassetsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await massets.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
assettype:req.query.assettype,
asset:req.query.asset,
category:req.query.category,
purchasedate:req.query.purchasedate,
vendorid:req.query.vendorid,
poid:req.query.poid,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemassetsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await massets.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
assettype:req.query.assettype,
asset:req.query.asset,
category:req.query.category,
purchasedate:req.query.purchasedate,
vendorid:req.query.vendorid,
poid:req.query.poid,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemassetscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await massets.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemassetsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await massets.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmassetassignbyfac= async (req,res) => {
  try{
      
      const lcat1233= await massetassign
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.massetassigndocs= async (req,res) => {
  try{
      
      const lcat1233= await massetassign
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.massetassignlinks= async (req,res) => {
try{
    
    const lcat1233= await massetassign
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmassetassignbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await massetassign.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
assetid:req.query.assetid,
asset:req.query.asset,
username:req.query.username,
assigndate:req.query.assigndate,
returndate:req.query.returndate,
assetstatus:req.query.assetstatus,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemassetassignbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await massetassign.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
assetid:req.query.assetid,
asset:req.query.asset,
username:req.query.username,
assigndate:req.query.assigndate,
returndate:req.query.returndate,
assetstatus:req.query.assetstatus,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemassetassigncomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await massetassign.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemassetassignbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await massetassign.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmvendorsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mvendors
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mvendorsdocs= async (req,res) => {
  try{
      
      const lcat1233= await mvendors
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mvendorslinks= async (req,res) => {
try{
    
    const lcat1233= await mvendors
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmvendorsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mvendors.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          vendor:req.query.vendor,
address:req.query.address,
pan:req.query.pan,
gst:req.query.gst,
state:req.query.state,
type:req.query.type,
apprstatus:req.query.apprstatus,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemvendorsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mvendors.findByIdAndUpdate( req.query.id,{
          
          
          vendor:req.query.vendor,
address:req.query.address,
pan:req.query.pan,
gst:req.query.gst,
state:req.query.state,
type:req.query.type,
apprstatus:req.query.apprstatus,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemvendorscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mvendors.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemvendorsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mvendors.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmvendorbanksbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mvendorbanks
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mvendorbanksdocs= async (req,res) => {
  try{
      
      const lcat1233= await mvendorbanks
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mvendorbankslinks= async (req,res) => {
try{
    
    const lcat1233= await mvendorbanks
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmvendorbanksbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mvendorbanks.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          vendorid:req.query.vendorid,
vendor:req.query.vendor,
bank:req.query.bank,
account:req.query.account,
accno:req.query.accno,
ifsc:req.query.ifsc,
branch:req.query.branch,
acctype:req.query.acctype,
banktype:req.query.banktype,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemvendorbanksbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mvendorbanks.findByIdAndUpdate( req.query.id,{
          
          
          vendorid:req.query.vendorid,
vendor:req.query.vendor,
bank:req.query.bank,
account:req.query.account,
accno:req.query.accno,
ifsc:req.query.ifsc,
branch:req.query.branch,
acctype:req.query.acctype,
banktype:req.query.banktype,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemvendorbankscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mvendorbanks.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemvendorbanksbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mvendorbanks.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmpurchasebyfac= async (req,res) => {
  try{
      
      const lcat1233= await mpurchase
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mpurchasedocs= async (req,res) => {
  try{
      
      const lcat1233= await mpurchase
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mpurchaselinks= async (req,res) => {
try{
    
    const lcat1233= await mpurchase
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.creatempurchasebyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mpurchase.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
ponumber:req.query.ponumber,
podate:req.query.podate,
description:req.query.description,
vendorid:req.query.vendorid,
vendor:req.query.vendor,
amount:req.query.amount,
gst:req.query.gst,
terms:req.query.terms,
potype:req.query.potype,
approval:req.query.approval,
approvaluser:req.query.approvaluser,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatempurchasebyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mpurchase.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
ponumber:req.query.ponumber,
podate:req.query.podate,
description:req.query.description,
vendorid:req.query.vendorid,
vendor:req.query.vendor,
amount:req.query.amount,
gst:req.query.gst,
terms:req.query.terms,
potype:req.query.potype,
approval:req.query.approval,
approvaluser:req.query.approvaluser,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatempurchasecomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mpurchase.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletempurchasebyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mpurchase.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmpurchaseitemsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mpurchaseitems
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mpurchaseitemsdocs= async (req,res) => {
  try{
      
      const lcat1233= await mpurchaseitems
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mpurchaseitemslinks= async (req,res) => {
try{
    
    const lcat1233= await mpurchaseitems
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.creatempurchaseitemsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mpurchaseitems.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          poid:req.query.poid,
item:req.query.item,
description:req.query.description,
amount:req.query.amount,
gst:req.query.gst,
purchasetype:req.query.purchasetype,
category:req.query.category,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatempurchaseitemsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mpurchaseitems.findByIdAndUpdate( req.query.id,{
          
          
          poid:req.query.poid,
item:req.query.item,
description:req.query.description,
amount:req.query.amount,
gst:req.query.gst,
purchasetype:req.query.purchasetype,
category:req.query.category,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatempurchaseitemscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mpurchaseitems.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletempurchaseitemsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mpurchaseitems.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmpopaymentsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mpopayments
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mpopaymentsdocs= async (req,res) => {
  try{
      
      const lcat1233= await mpopayments
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mpopaymentslinks= async (req,res) => {
try{
    
    const lcat1233= await mpopayments
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.creatempopaymentsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mpopayments.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
poid:req.query.poid,
invoiceid:req.query.invoiceid,
frombank:req.query.frombank,
amount:req.query.amount,
invoicedate:req.query.invoicedate,
paydate:req.query.paydate,
fromaccount:req.query.fromaccount,
fromifsc:req.query.fromifsc,
refno:req.query.refno,
tobank:req.query.tobank,
toaccount:req.query.toaccount,
toifsc:req.query.toifsc,
paytype:req.query.paytype,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatempopaymentsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mpopayments.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
poid:req.query.poid,
invoiceid:req.query.invoiceid,
frombank:req.query.frombank,
amount:req.query.amount,
invoicedate:req.query.invoicedate,
paydate:req.query.paydate,
fromaccount:req.query.fromaccount,
fromifsc:req.query.fromifsc,
refno:req.query.refno,
tobank:req.query.tobank,
toaccount:req.query.toaccount,
toifsc:req.query.toifsc,
paytype:req.query.paytype,
doclink:req.query.doclink,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatempopaymentscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mpopayments.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletempopaymentsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mpopayments.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmassetscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await massets.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmassetssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await massets.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$category', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmassetscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await massets.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmassetssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await massets.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$category', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmassetassigncount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await massetassign.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmassetassignsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await massetassign.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$assetstatus', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmassetassigncountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await massetassign.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmassetassignsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await massetassign.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$assetstatus', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmvendorscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mvendors.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$apprstatus', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmvendorssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mvendors.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmvendorscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mvendors.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$apprstatus', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmvendorssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mvendors.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmvendorbankscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mvendorbanks.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$acctype', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmvendorbankssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mvendorbanks.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$banktype', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmvendorbankscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mvendorbanks.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmvendorbankssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mvendorbanks.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$banktype', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmpurchasecount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mpurchase.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmpurchasesecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mpurchase.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$approval', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmpurchasecountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mpurchase.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmpurchasesecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mpurchase.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$approval', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmpurchaseitemscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mpurchaseitems.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$category', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmpurchaseitemssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mpurchaseitems.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$purchasetype', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmpurchaseitemscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mpurchaseitems.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$category', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmpurchaseitemssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mpurchaseitems.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$purchasetype', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmpopaymentscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mpopayments.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmpopaymentssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mpopayments.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$paytype', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmpopaymentscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mpopayments.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmpopaymentssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mpopayments.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$paytype', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  



// Oct 31 2024


exports.getmtestnewmbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestnewm
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmtestnewmbyid= async (req,res) => {
  try{

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mtestnewm.find({"_id" : req.query.id});
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestnewmdocs= async (req,res) => {
  try{
      
      const lcat1233= await mtestnewm
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestnewmlinks= async (req,res) => {
try{
    
    const lcat1233= await mtestnewm
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestnewmbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestnewm.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          coursecode:req.query.coursecode,
testc:req.query.testc,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestnewmbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestnewm.findByIdAndUpdate( req.query.id,{
          
          
          coursecode:req.query.coursecode,
testc:req.query.testc,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestnewmcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestnewm.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestnewmbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestnewm.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmtestsessionsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestsessions
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmtestsessionsbyid= async (req,res) => {
  try{
      
      
    const lcat1233=await mtestsessions.find({"_id" : req.query.id});
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestsessionsdocs= async (req,res) => {
  try{
      
      const lcat1233= await mtestsessions
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestsessionslinks= async (req,res) => {
try{
    
    const lcat1233= await mtestsessions
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestsessionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestsessions.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
session:req.query.session,
starttime:req.query.starttime,
endtime:req.query.endtime,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestsessionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestsessions.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
session:req.query.session,
starttime:req.query.starttime,
endtime:req.query.endtime,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestsessionscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestsessions.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestsessionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestsessions.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmtestseenrolbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestseenrol
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestseenroldocs= async (req,res) => {
  try{
      
      const lcat1233= await mtestseenrol
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestseenrollinks= async (req,res) => {
try{
    
    const lcat1233= await mtestseenrol
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestseenrolbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestseenrol.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
sessionid:req.query.sessionid,
student:req.query.student,
regno:req.query.regno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestseenrolbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestseenrol.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
sessionid:req.query.sessionid,
student:req.query.student,
regno:req.query.regno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestseenrolcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestseenrol.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestseenrolbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestseenrol.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmtestsectionsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestsections
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestsectionsdocs= async (req,res) => {
  try{
      
      const lcat1233= await mtestsections
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestsectionslinks= async (req,res) => {
try{
    
    const lcat1233= await mtestsections
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestsectionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestsections.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
section:req.query.section,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestsectionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestsections.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
section:req.query.section,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestsectionscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestsections.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestsectionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestsections.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmtestqnewbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestqnew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid,
                    'sectionid':req.query.sectionid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmtestqnewrandom= async (req,res) => {
  try{
      const qno=parseInt(req.query.qno);
      const lcat1233= await mtestqnew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid,
                    'sectionid':req.query.sectionid
                  }
                },
                {
                  $sample: { size: qno }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestqnewdocs= async (req,res) => {
  try{
      
      const lcat1233= await mtestqnew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestqnewlinks= async (req,res) => {
try{
    
    const lcat1233= await mtestqnew
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestqnewbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestqnew.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
sectionid:req.query.sectionid,
question:req.query.question,
optiona:req.query.optiona,
optionb:req.query.optionb,
optionc:req.query.optionc,
optiond:req.query.optiond,
correcta:req.query.correcta,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestqnewbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestqnew.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
sectionid:req.query.sectionid,
question:req.query.question,
optiona:req.query.optiona,
optionb:req.query.optionb,
optionc:req.query.optionc,
optiond:req.query.optiond,
correcta:req.query.correcta,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestqnewcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestqnew.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestqnewbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestqnew.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};



// oct 31 2024 graph

exports.getmtestnewmcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestnewm.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestnewmsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestnewm.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestnewmcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestnewm.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestnewmsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestnewm.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmtestsessionscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestsessions.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestsessionssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestsessions.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestsessionscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestsessions.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestsessionssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestsessions.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmtestseenrolcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestseenrol.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestseenrolsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestseenrol.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestseenrolcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestseenrol.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestseenrolsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestseenrol.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmtestsectionscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestsections.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestsectionssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestsections.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestsectionscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestsections.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestsectionssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestsections.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmtestqnewcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestqnew.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestqnewsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestqnew.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestqnewcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestqnew.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestqnewsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestqnew.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  

// oct 26 2024 1


exports.getmtestseenrol1byfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestseenrol1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid,
                    'sessionid':req.query.sessionid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestseenrol1docs= async (req,res) => {
  try{
      
      const lcat1233= await mtestseenrol1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestseenrol1links= async (req,res) => {
try{
    
    const lcat1233= await mtestseenrol1
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestseenrol1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestseenrol1.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
sessionid:req.query.sessionid,
test:req.query.test,
sessionslot:req.query.sessionslot,
student:req.query.student,
regno:req.query.regno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestseenrol1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestseenrol1.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
sessionid:req.query.sessionid,
test:req.query.test,
sessionslot:req.query.sessionslot,
student:req.query.student,
regno:req.query.regno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestseenrol1comments= async (req,res) => {

  try{
     
     
      const lcat1= await mtestseenrol1.findByIdAndUpdate( req.query.id,{
          type: req.query.type,
          level: req.query.level
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestseenrol1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestseenrol1.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmtestseenrol1studbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestseenrol1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'regno':req.query.regno
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};

exports.getmtestseenrol1studtype= async (req,res) => {
  try{
    const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mtestseenrol1.find()
    // .where('colid')
    //         .equals(colid1)
            // .where('type')
            // .equals(req.query.type1)
            .where('regno')
            .equals(req.query.regno);
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmtestseenrol1type= async (req,res) => {
  try{
    const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mtestseenrol1.find()
    .where('colid')
            .equals(colid1)
            .where('type')
            .equals(req.query.type1)
            .where('regno')
            .equals(req.query.regno);
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
    

  }  
};



// oct 26 2024 1 graph

exports.getmtestseenrol1count= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestseenrol1.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestseenrol1second= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestseenrol1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestseenrol1countbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestseenrol1.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestseenrol1secondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestseenrol1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  

// nov 1 2024


exports.getmtestsections1byfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestsections1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestsections1docs= async (req,res) => {
  try{
      
      const lcat1233= await mtestsections1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestsections1links= async (req,res) => {
try{
    
    const lcat1233= await mtestsections1
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestsections1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestsections1.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
section:req.query.section,
description:req.query.description,
noofquestions:req.query.noofquestions,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestsections1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestsections1.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
section:req.query.section,
description:req.query.description,
noofquestions:req.query.noofquestions,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestsections1comments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestsections1.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestsections1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestsections1.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// nov 1 2024 graph

exports.getmtestsections1count= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestsections1.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestsections1second= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestsections1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestsections1countbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestsections1.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestsections1secondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestsections1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  


// nov 4 2024



exports.getmtestscoresnew1byfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestscoresnew1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestscoresnew1docs= async (req,res) => {
  try{
      
      const lcat1233= await mtestscoresnew1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestscoresnew1links= async (req,res) => {
try{
    
    const lcat1233= await mtestscoresnew1
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestscoresnew1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

//       const pub1= await mtestscoresnew1.create({
//           name: req.query.name,
//           colid: req.query.colid,
//           user: req.query.user,
//           year:req.query.year,
// examdate:req.query.examdate,
// testid:req.query.testid,
// test:req.query.test,
// sessionid:req.query.sessionid,
// session:req.query.session,
// sectionid:req.query.sectionid,
// section:req.query.section,
// questionid:req.query.questionid,
// question:req.query.question,
// option:req.query.option,
// student:req.query.student,
// regno:req.query.regno,
// score:req.query.score,
// status1: 'Submitted',
//           comments: 'NA'
//       });

const pat1 = await mtestscoresnew1.findOneAndUpdate(
  {
    testid: req.query.testid,
    sessionid:req.query.sessionid,
    sectionid:req.query.sectionid,
    questionid: req.query.questionid,
    regno: req.query.regno,
    student: req.query.student,
  },
  {
    name: req.query.name,
    colid: req.query.colid,
    user: req.query.user,
    year: req.query.year,
    examdate:new Date(req.query.examdate),
    test: req.query.test,
    session: req.query.session,
    section: req.query.section,
    question: req.query.question,
    option: req.query.option,
    score: req.query.score,
    status1: "Submitted",
    comments: "NA",
  },
  {
    new: true,
    upsert: true,
  }
);

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestscoresnew1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestscoresnew1.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
examdate:req.query.examdate,
testid:req.query.testid,
test:req.query.test,
sessionid:req.query.sessionid,
session:req.query.session,
sectionid:req.query.sectionid,
section:req.query.section,
questionid:req.query.questionid,
question:req.query.question,
option:req.query.option,
student:req.query.student,
regno:req.query.regno,
score:req.query.score,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestscoresnew1comments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestscoresnew1.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestscoresnew1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestscoresnew1.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// nov 11 2024

exports.getmtestscoresummary = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    // const date1 = new Date(req.query.date1);
    // const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mtestscoresnew1.aggregate([
      {
        $match: {
          colid: colid1,
          testid: req.query.testid,
          sessionid: req.query.sessionid
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            section: "$section",
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $sum: "$score" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};


// nov 13 2024

exports.createstudentsapp= async (req,res) => {

  try{
      //const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';

      var someDate = new Date();

    
    
      var numberOfDaysToAdd = 6;
      var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
      var dt2=new Date(result);
      

      const pub1= await User.create({
          addedby: 'System',
          colid: req.query.colid,
          user: 'System',
          name:req.query.name,
email:req.query.email,
phone:req.query.phone,
password:req.query.password,
role:'Student',
programcode:req.query.programcode,
regno:req.query.regno,
admissionyear:'2024-25',
gender:'NA',
semester:'NA',
section:'NA',
department:'NA',
category:'NA',
address:'NA',
quota:'NA',
status:1,
lastlogin: someDate,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


// nov 15 2024

exports.getmtestnewmsearch= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mtestnewm.find({
      "colid" : req.query.colid,
      // "testc": /.*Skill.*/
      "testc":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// nov 20 2024


exports.getmtestsessionsf= async (req,res) => {
  try{

    // const searchstring=req.query.searchstring;
    // const s1='/.*' + searchstring + '.*/'

    const date1=new Date();

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mtestsessions.find({
      "colid" : req.query.colid,
      "starttime" : { $gte : date1 },
      "testid": req.query.testid
      // "testc": /.*Skill.*/
      // "testc":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// Nov 24 2024

exports.createmtestseenrol1u= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

//       const pub1= await mtestseenrol1.create({
//           name: req.query.name,
//           colid: req.query.colid,
//           user: req.query.user,
//           testid:req.query.testid,
// sessionid:req.query.sessionid,
// test:req.query.test,
// sessionslot:req.query.sessionslot,
// student:req.query.student,
// regno:req.query.regno,
// type:req.query.type,
// level:req.query.level,
// status1: 'Submitted',
//           comments: 'NA'
//       });

      const pat1 = await mtestseenrol1.findOneAndUpdate(
        {
          testid: req.query.testid,
          sessionid:req.query.sessionid,
          regno: req.query.regno,
          student: req.query.student,
        },
        {
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
test:req.query.test,
sessionslot:req.query.sessionslot,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
        },
        {
          new: true,
          upsert: true,
        }
      );
      


  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


// nov 25 2024


exports.getmguidesbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mguides
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmguidesbycat1sub= async (req,res) => {
  try{
      
      const lcat1233= await mguides
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'category1':req.query.category1,
                    'subject':req.query.subject
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mguidesdocs= async (req,res) => {
  try{
      
      const lcat1233= await mguides
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mguideslinks= async (req,res) => {
try{
    
    const lcat1233= await mguides
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmguidesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mguides.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          category1:req.query.category1,
category2:req.query.category2,
keywords:req.query.keywords,
subject:req.query.subject,
module:req.query.module,
topic:req.query.topic,
link:req.query.link,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemguidesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mguides.findByIdAndUpdate( req.query.id,{
          
          
          category1:req.query.category1,
category2:req.query.category2,
keywords:req.query.keywords,
subject:req.query.subject,
module:req.query.module,
topic:req.query.topic,
link:req.query.link,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemguidescomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mguides.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemguidesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mguides.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmctalentregbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mctalentreg
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mctalentregdocs= async (req,res) => {
  try{
      
      const lcat1233= await mctalentreg
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mctalentreglinks= async (req,res) => {
try{
    
    const lcat1233= await mctalentreg
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmctalentregbyfac= async (req,res) => {

  try{
      //const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      // try {
      //     const verified = jwt.verify(
      //         token,
      //         process.env.JWT_SECRET,
      //         (err123, verified) => {
      //           if (err123) {
      //             return res.status(401).json({
      //                 status: 'Unauthorized',
      //                 error: err123
      //             });
      //           }
      //           jwtuser=verified.user;
      //           jwtcolid=verified.colid;
      //           return verified;
      //         }
      //       );
      // } catch(err1234) {
      //     //console.log(err1234);
      // }

      const pub1= await mctalentreg.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          student:req.query.student,
phone:req.query.phone,
email:req.query.email,
guardian:req.query.guardian,
gphone:req.query.gphone,
payref:req.query.payref,
payname:req.query.payname,
paydate:req.query.paydate,
source:req.query.source,
type:req.query.type,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemctalentregbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mctalentreg.findByIdAndUpdate( req.query.id,{
          
          
          student:req.query.student,
phone:req.query.phone,
email:req.query.email,
guardian:req.query.guardian,
gphone:req.query.gphone,
payref:req.query.payref,
payname:req.query.payname,
paydate:req.query.paydate,
source:req.query.source,
type:req.query.type,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemctalentregcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mctalentreg.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemctalentregbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mctalentreg.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmtestqnewcsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mtestqnewcs
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mtestqnewcsdocs= async (req,res) => {
  try{
      
      const lcat1233= await mtestqnewcs
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mtestqnewcslinks= async (req,res) => {
try{
    
    const lcat1233= await mtestqnewcs
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmtestqnewcsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mtestqnewcs.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
sectionid:req.query.sectionid,
question:req.query.question,
questionimg:req.query.questionimg,
questionlink:req.query.questionlink,
optiona:req.query.optiona,
optionb:req.query.optionb,
optionc:req.query.optionc,
optiond:req.query.optiond,
correcta:req.query.correcta,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemtestqnewcsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mtestqnewcs.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
sectionid:req.query.sectionid,
question:req.query.question,
questionimg:req.query.questionimg,
questionlink:req.query.questionlink,
optiona:req.query.optiona,
optionb:req.query.optionb,
optionc:req.query.optionc,
optiond:req.query.optiond,
correcta:req.query.correcta,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemtestqnewcscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mtestqnewcs.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemtestqnewcsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mtestqnewcs.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// nov 25 2024 graph all

exports.getmguidescount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mguides.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$category2', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmguidessecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mguides.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$category1', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmguidescountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mguides.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$category2', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmguidessecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mguides.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$category1', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmctalentregcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mctalentreg.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmctalentregsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mctalentreg.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$source', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmctalentregcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mctalentreg.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmctalentregsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mctalentreg.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$source', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




exports.getmtestqnewcscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mtestqnewcs.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getmtestqnewcssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtestqnewcs.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getmtestqnewcscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtestqnewcs.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getmtestqnewcssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtestqnewcs.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  




// search


exports.getmguidessearch= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mguides.find({
      "colid" : req.query.colid,
      // "testc": /.*Skill.*/
      "keywords":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};



exports.getmguidesdcat1= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await mguides.distinct("category1",{
      "colid" : req.query.colid,
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmguidessearchcat2= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mguides.find({
      "colid" : req.query.colid,
      // "testc": /.*Skill.*/
      "category2":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmguidesdsub= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await mguides.distinct("subject",{
      "colid" : req.query.colid,
      "category1" : req.query.category1
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmguidessearchmod= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mguides.find({
      "colid" : req.query.colid,
      "category1" : req.query.category1,
      "subject" : req.query.subject,
      // "testc": /.*Skill.*/
      "keywords":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// nov 27 2024

exports.getmguidesdsubcat2= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await mguides.distinct("subject",{
      "colid" : req.query.colid,
      // "category1" : req.query.category1
      "category2":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmguidessearchmode= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mguides.find({
      "colid" : req.query.colid,
      // "category1" : req.query.category1,
      "category2":{'$regex' : req.query.exam, '$options' : 'i'},
      "subject" : req.query.subject,
      // "testc": /.*Skill.*/
      "keywords":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// mov 30 2024


exports.getonlinepaybyfac= async (req,res) => {
  try{
      
      const lcat1233= await onlinepay
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.onlinepaydocs= async (req,res) => {
  try{
      
      const lcat1233= await onlinepay
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.onlinepaylinks= async (req,res) => {
try{
    
    const lcat1233= await onlinepay
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createonlinepaybyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await onlinepay.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          transactionid:req.query.transactionid,
orderid:req.query.orderid,
bankref:req.query.bankref,
paymode:req.query.paymode,
bank:req.query.bank,
amount:req.query.amount,
username:req.query.username,
regno:req.query.regno,
clientcolid:req.query.clientcolid,
sessionslot:req.query.sessionslot,
testc:req.query.testc,
type:req.query.type,
paydate:req.query.paydate,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updateonlinepaybyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await onlinepay.findByIdAndUpdate( req.query.id,{
          
          
          transactionid:req.query.transactionid,
orderid:req.query.orderid,
bankref:req.query.bankref,
paymode:req.query.paymode,
bank:req.query.bank,
amount:req.query.amount,
username:req.query.username,
regno:req.query.regno,
clientcolid:req.query.clientcolid,
sessionslot:req.query.sessionslot,
testc:req.query.testc,
type:req.query.type,
paydate:req.query.paydate,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updateonlinepaycomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await onlinepay.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deleteonlinepaybyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await onlinepay.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// nov 30 2024 graph

exports.getonlinepaycount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await onlinepay.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$clientcolid', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getonlinepaysecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await onlinepay.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getonlinepaycountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await onlinepay.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$clientcolid', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getonlinepaysecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await onlinepay.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  



// dec 3 2024

exports.createautosession= async (req,res) => {
  try{
      const starttime=new Date('12/14/2024 11:00 AM');
      const endtime=new Date('12/14/2024 01:00 PM');

      const lcat1233= await mtestnewm
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);

                lcat1233.forEach(async function(data){
                  console.log(data._id + ' ' + data.testc);


          //         const pub1= await mtestsessions.create({
          //           name: 'CT exam',
          //           colid: 111362,
          //           user: 'ct@ctexam.in',
          //           testid:data._id ,
          // session:'SFC ' + data.testc + ' ' + starttime,
          // starttime:starttime,
          // endtime:endtime,
          // type:'Enrolled',
          // level:'National',
          // status1: 'Submitted',
          //           comments: 'NA'
          //       });
                  //moucount=data.total_attendance;
                  
                  })
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success'
                
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.createautosession1= async (req,res) => {
  try{
      // const starttime=new Date('12/06/2024 10:00 AM');
      // const endtime=new Date('12/06/2024 11:00 AM');

      var someDate = new Date(req.query.somedate);
      var someDate1=new Date(req.query.somedate);
      // var numberOfDaysToAdd = 6;
      // var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);

      var numhours = parseInt(req.query.numhours);
      var endhours=parseInt(req.query.numhours) + 1;
      var result = someDate.setHours(someDate.getHours() + numhours);
      var result1 = someDate1.setHours(someDate1.getHours() + endhours);

      console.log(result + ' ' + result1);


      const starttime=new Date(someDate);
      const endtime=new Date(someDate1);


      const lcat1233= await mtestnewm
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);

                lcat1233.forEach(async function(data){
                  //console.log(data._id + ' ' + data.testc);


                  const pub1= await mtestsessions.create({
                    name: 'CT exam',
                    colid: parseInt(req.query.colid),
                    user: 'ct@ctexam.in',
                    testid:data._id ,
          session:data.testc + ' ' + starttime,
          starttime:starttime,
          endtime:endtime,
          type:'Enrolled',
          level:'National',
          status1: 'Submitted',
                    comments: 'NA'
                });
                  //moucount=data.total_attendance;
                  
                  })
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success'
                
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


/// nov 5 2024


exports.updateuserrole = async (req, res) => {
  

    const lcat1 = await User.updateMany(
      { colid: 10242 }, {
      role: "Student",
      password: "p@123",
      colid: 111362
    });
    return res.status(200).json({
      status: "Success",
    });
  
};


exports.updatesessionreg = async (req, res) => {
  
  const colid=parseInt(req.query.colid);

  const lcat1 = await mtestseenrol1.updateMany(
    { colid: colid }, {
    type: "Upcoming"
  });
  return res.status(200).json({
    status: "Success",
  });

};

// dec 6 2024

exports.deletestudents = async (req, res) => {
  
  const colid=parseInt(req.query.colid);

  const lcat1 = await User.deleteMany(
    { colid: colid, role: req.query.role });
  return res.status(200).json({
    status: "Success",
  });

};

// dec 11 2024

exports.updatelastlogin = async (req, res) => {
  
  const colid=parseInt(req.query.colid);

  var someDate = new Date();
  var numberOfDaysToAdd = 15;
  var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
  var dt2=new Date(result);

  //console.log(someDate.toString() + ' ' + dt2.toString());



  const lcat1 = await User.updateMany(
    { colid: colid }, {
    lastlogin: someDate
  });
  return res.status(200).json({
    status: "Success",
  });

};

exports.updatelastloginall = async (req, res) => {
  
  //const colid=parseInt(req.query.colid);

  var someDate = new Date();
  var numberOfDaysToAdd = 20;
  var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
  var dt2=new Date(result);

  //console.log(someDate.toString() + ' ' + dt2.toString());



  const lcat1 = await User.updateMany(
    {}, {
    lastlogin: someDate
  });
  return res.status(200).json({
    status: "Success",
  });

};

// dec 13 2024


exports.getmtestscoresummaryall = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    // const date1 = new Date(req.query.date1);
    // const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mtestscoresnew1.aggregate([
      {
        $match: {
          colid: colid1
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            test: "$test",
            session: "$session",
            section: "$section",
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $sum: "$score" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};

// dec 14 2024

exports.updatesubscription = async (req, res) => {
  try {
   
    const lcat1 = await User.updateMany(
      { email: req.query.email }, {
      status1: 'Yes'
    });

    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};


// dec 21 2024


exports.getmindmaplistbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mindmaplist
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mindmaplistdocs= async (req,res) => {
  try{
      
      const lcat1233= await mindmaplist
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mindmaplistlinks= async (req,res) => {
try{
    
    const lcat1233= await mindmaplist
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmindmaplistbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mindmaplist.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          title:req.query.title,
description:req.query.description,
coursecode:req.query.coursecode,
type1:req.query.type1,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemindmaplistbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mindmaplist.findByIdAndUpdate( req.query.id,{
          
          
          title:req.query.title,
description:req.query.description,
coursecode:req.query.coursecode,
type1:req.query.type1,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemindmaplistcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mindmaplist.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemindmaplistbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mindmaplist.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmindmapnodesbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mindmapnodes
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'mapid':req.query.mapid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmindmapnodesbymapid= async (req,res) => {
  try{
      
    const lcat1233=await mindmapnodes.find(
      {
        "colid" : req.query.colid,
        "mapid":req.query.mapid
      }
    );

    const Comment1 = [];

    var i=0;

    lcat1233.forEach(async function(data1){
      //console.log(data.link);
      //moucount=data.total_attendance;
      if(i==0) {
        Comment1.push({
          id: data1.nodeid.toString(),
          data:{'label' : data1.data},
          position:{'x':data1.position,'y':data1.type1},
          type:data1.type
      });

      } else {
        Comment1.push({
          id: data1.nodeid.toString(),
          data:{'label' : data1.data},
          position:{'x':data1.position,'y':data1.type1}
          // type:data1.type
      });
      }
      
      
      })



  //   const payload = lcat1233.map((item, index) => {
  //     return {
  //         id: index +1,
  //         ...item
  //     }
  // });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : Comment1
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mindmapnodesdocs= async (req,res) => {
  try{
      
      const lcat1233= await mindmapnodes
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mindmapnodeslinks= async (req,res) => {
try{
    
    const lcat1233= await mindmapnodes
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmindmapnodesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mindmapnodes.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          mapid:req.query.mapid,
nodeid:req.query.nodeid,
data:req.query.data,
position:req.query.position,
type:req.query.type,
type1:req.query.type1,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemindmapnodesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mindmapnodes.findByIdAndUpdate( req.query.id,{
          
          
          mapid:req.query.mapid,
nodeid:req.query.nodeid,
data:req.query.data,
position:req.query.position,
type:req.query.type,
type1:req.query.type1,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemindmapnodescomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mindmapnodes.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemindmapnodesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mindmapnodes.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmindmapedgesbyfac= async (req,res) => {
  try{
      
      const lcat1233= await mindmapedges
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'mapid':req.query.mapid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmindmapedgesbymapid= async (req,res) => {
  try{
      
    const lcat1233=await mindmapedges.find(
      {
        "colid" : req.query.colid,
        "mapid":req.query.mapid
      }
    );

    const Comment1 = [];

    lcat1233.forEach(async function(data1){
      //console.log(data.link);
      //moucount=data.total_attendance;
      
      Comment1.push({
        id: data1.type1,
        source:data1.source,
        target:data1.target,
        label:data1.label,
        type:data1.type
    });
      })


          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : Comment1
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.mindmapedgesdocs= async (req,res) => {
  try{
      
      const lcat1233= await mindmapedges
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.mindmapedgeslinks= async (req,res) => {
try{
    
    const lcat1233= await mindmapedges
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmindmapedgesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await mindmapedges.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          mapid:req.query.mapid,
source:req.query.source,
target:req.query.target,
label:req.query.label,
type:req.query.type,
type1:req.query.type1,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemindmapedgesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await mindmapedges.findByIdAndUpdate( req.query.id,{
          
          
          mapid:req.query.mapid,
source:req.query.source,
target:req.query.target,
label:req.query.label,
type:req.query.type,
type1:req.query.type1,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemindmapedgescomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await mindmapedges.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemindmapedgesbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await mindmapedges.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmindmaplistcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mindmaplist.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$level', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getmindmaplistsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mindmaplist.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type1', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getmindmaplistcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mindmaplist.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getmindmaplistsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mindmaplist.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type1', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getmindmapnodescount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mindmapnodes.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$level', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getmindmapnodessecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mindmapnodes.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type1', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getmindmapnodescountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mindmapnodes.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getmindmapnodessecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mindmapnodes.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type1', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getmindmapedgescount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await mindmapedges.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$level', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getmindmapedgessecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mindmapedges.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type1', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getmindmapedgescountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mindmapedges.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getmindmapedgessecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mindmapedges.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type1', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  


// dec 22 2024

exports.changenodeposition= async (req,res) => {
  try{
      
    // const lcat1233=await mindmapnodes.find(
    //   {
    //     "colid" : req.query.colid,
    //     "mapid":req.query.mapid,
    //     "nodeid":req.query.nodeid
    //   }
    // );

    const Comment1 = [];

    var i=0;

    var posx=0;
    var posy=0;

    // lcat1233.forEach(async function(data1){
    //   posx=parseInt(data1.position);
    //   posy=parseInt(data1.type1);
    //   //console.log(data.link);
    //   //moucount=data.total_attendance;
      
      
      
    //   })

      posx=posx+parseInt(req.query.deltax);
      posy=posy+parseInt(req.query.deltay);

      const lcat1 = await mindmapnodes.updateMany(
        { colid: req.query.colid,mapid:req.query.mapid,nodeid: req.query.nodeid }, {
        position: posx,
        type1: posy
      });


          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success' 
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// dec 23 2024

exports.changecategory1= async (req,res) => {
  try{
      
   

      const lcat1 = await mguides.updateMany(
        { colid: req.query.colid, category1:req.query.category1 }, {
        category1: req.query.newcategory1
      });


          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success' 
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// dec 31 2024

exports.updateexamreg = async (req, res) => {
  
  const colid=parseInt(req.query.colid);

  // const lcat1 = await mtestseenrol1.updateMany(
  //   { colid: colid }, {
  //   type: "Upcoming"
  // });

  const lcat1= await mtestseenrol1.findByIdAndUpdate( req.query.id,{
          type: "Upcoming"
});


  return res.status(200).json({
    status: "Success",
  });

};


// feb 7 2024


exports.getminewmbyfac= async (req,res) => {
  try{
      
      const lcat1233= await minewm
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.minewmdocs= async (req,res) => {
  try{
      
      const lcat1233= await minewm
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.minewmlinks= async (req,res) => {
try{
    
    const lcat1233= await minewm
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createminewmbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await minewm.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          coursecode:req.query.coursecode,
testc:req.query.testc,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updateminewmbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await minewm.findByIdAndUpdate( req.query.id,{
          
          
          coursecode:req.query.coursecode,
testc:req.query.testc,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updateminewmcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await minewm.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deleteminewmbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await minewm.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmisessionsbyfac= async (req,res) => {
  try{
      
      const lcat1233= await misessions
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.misessionsdocs= async (req,res) => {
  try{
      
      const lcat1233= await misessions
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.misessionslinks= async (req,res) => {
try{
    
    const lcat1233= await misessions
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmisessionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await misessions.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
session:req.query.session,
starttime:req.query.starttime,
endtime:req.query.endtime,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemisessionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await misessions.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
session:req.query.session,
starttime:req.query.starttime,
endtime:req.query.endtime,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemisessionscomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await misessions.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemisessionsbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await misessions.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmiseenrol1byfac= async (req,res) => {
  try{
      
      const lcat1233= await miseenrol1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid,
                    'sessionid':req.query.sessionid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.miseenrol1docs= async (req,res) => {
  try{
      
      const lcat1233= await miseenrol1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.miseenrol1links= async (req,res) => {
try{
    
    const lcat1233= await miseenrol1
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmiseenrol1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await miseenrol1.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
sessionid:req.query.sessionid,
test:req.query.test,
sessionslot:req.query.sessionslot,
student:req.query.student,
regno:req.query.regno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemiseenrol1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await miseenrol1.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
sessionid:req.query.sessionid,
test:req.query.test,
sessionslot:req.query.sessionslot,
student:req.query.student,
regno:req.query.regno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemiseenrol1comments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await miseenrol1.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemiseenrol1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await miseenrol1.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmisections1byfac= async (req,res) => {
  try{
      
      const lcat1233= await misections1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.misections1docs= async (req,res) => {
  try{
      
      const lcat1233= await misections1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.misections1links= async (req,res) => {
try{
    
    const lcat1233= await misections1
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmisections1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await misections1.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
section:req.query.section,
description:req.query.description,
noofquestions:req.query.noofquestions,
imagelink:req.query.imagelink,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemisections1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await misections1.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
section:req.query.section,
description:req.query.description,
noofquestions:req.query.noofquestions,
imagelink:req.query.imagelink,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemisections1comments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await misections1.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemisections1byfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await misections1.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmiqnewbyfac= async (req,res) => {
  try{
      
      const lcat1233= await miqnew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid': req.query.testid,
                    'sectionid':req.query.sectionid
                    // 'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.miqnewdocs= async (req,res) => {
  try{
      
      const lcat1233= await miqnew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.miqnewlinks= async (req,res) => {
try{
    
    const lcat1233= await miqnew
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmiqnewbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await miqnew.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          testid:req.query.testid,
sectionid:req.query.sectionid,
question:req.query.question,
optiona:req.query.optiona,
optionb:req.query.optionb,
optionc:req.query.optionc,
optiond:req.query.optiond,
correcta:req.query.correcta,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemiqnewbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await miqnew.findByIdAndUpdate( req.query.id,{
          
          
          testid:req.query.testid,
sectionid:req.query.sectionid,
question:req.query.question,
optiona:req.query.optiona,
optionb:req.query.optionb,
optionc:req.query.optionc,
optiond:req.query.optiond,
correcta:req.query.correcta,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemiqnewcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await miqnew.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemiqnewbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await miqnew.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmiscoresbyfac= async (req,res) => {
  try{
      
      const lcat1233= await miscores
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.miscoresdocs= async (req,res) => {
  try{
      
      const lcat1233= await miscores
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.miscoreslinks= async (req,res) => {
try{
    
    const lcat1233= await miscores
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createmiscoresbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

//       const pub1= await miscores.create({
//           name: req.query.name,
//           colid: req.query.colid,
//           user: req.query.user,
//           year:req.query.year,
// examdate:req.query.examdate,
// testid:req.query.testid,
// test:req.query.test,
// sessionid:req.query.sessionid,
// session:req.query.session,
// sectionid:req.query.sectionid,
// section:req.query.section,
// questionid:req.query.questionid,
// question:req.query.question,
// option:req.query.option,
// student:req.query.student,
// username:req.query.username,
// regno:req.query.regno,
// score:req.query.score,
// status1: 'Submitted',
//           comments: 'NA'
//       });

const pat1 = await miscores.findOneAndUpdate(
  {
    testid: req.query.testid,
    sessionid:req.query.sessionid,
    sectionid:req.query.sectionid,
    questionid: req.query.questionid,
    regno: req.query.regno,
    student: req.query.student,
  },
  {
    name: req.query.name,
    colid: req.query.colid,
    user: req.query.user,
    username:req.query.user,
    year: req.query.year,
    examdate:new Date(req.query.examdate),
    test: req.query.test,
    session: req.query.session,
    section: req.query.section,
    question: req.query.question,
    option: req.query.option,
    score: req.query.score,
    status1: "Submitted",
    comments: "NA",
  },
  {
    new: true,
    upsert: true,
  }
);

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatemiscoresbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await miscores.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
examdate:req.query.examdate,
testid:req.query.testid,
test:req.query.test,
sessionid:req.query.sessionid,
session:req.query.session,
sectionid:req.query.sectionid,
section:req.query.section,
questionid:req.query.questionid,
question:req.query.question,
option:req.query.option,
student:req.query.student,
username:req.query.username,
regno:req.query.regno,
score:req.query.score,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatemiscorescomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await miscores.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletemiscoresbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await miscores.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// feb 7 2024 graphs

exports.getminewmcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await minewm.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getminewmsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await minewm.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getminewmcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await minewm.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getminewmsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await minewm.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getmisessionscount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await misessions.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getmisessionssecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await misessions.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getmisessionscountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await misessions.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getmisessionssecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await misessions.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getmiqnewcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await miqnew.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getmiqnewsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await miqnew.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getmiqnewcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await miqnew.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getmiqnewsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await miqnew.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getmiseenrol1count= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await miseenrol1.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getmiseenrol1second= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await miseenrol1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getmiseenrol1countbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await miseenrol1.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getmiseenrol1secondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await miseenrol1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getmisections1count= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await misections1.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getmisections1second= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await misections1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getmisections1countbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await misections1.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getmisections1secondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await misections1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  


// feb 7 2024 additional

exports.getminewmsearch= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await minewm.find({
      "colid" : req.query.colid,
      // "testc": /.*Skill.*/
      "testc":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// feb 8 2024

exports.getmiscoresummary = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    // const date1 = new Date(req.query.date1);
    // const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await miscores.aggregate([
      {
        $match: {
          colid: colid1,
          testid: req.query.testid,
          sessionid: req.query.sessionid
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            section: "$section",
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $sum: "$score" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};


// feb 10 2024 analytics


exports.getmpcodesearch= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await User.find({
      "colid" : req.query.colid,
      // "testc": /.*Skill.*/
      "programcode":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// feb 15 2025

exports.getmisessionsf= async (req,res) => {
  try{

    // const searchstring=req.query.searchstring;
    // const s1='/.*' + searchstring + '.*/'

    const date1=new Date();

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await misessions.find({
      "colid" : req.query.colid,
      "starttime" : { $gte : date1 },
      "testid": req.query.testid
      // "testc": /.*Skill.*/
      // "testc":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.createmiseenrol1u= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

//       const pub1= await mtestseenrol1.create({
//           name: req.query.name,
//           colid: req.query.colid,
//           user: req.query.user,
//           testid:req.query.testid,
// sessionid:req.query.sessionid,
// test:req.query.test,
// sessionslot:req.query.sessionslot,
// student:req.query.student,
// regno:req.query.regno,
// type:req.query.type,
// level:req.query.level,
// status1: 'Submitted',
//           comments: 'NA'
//       });

      const pat1 = await miseenrol1.findOneAndUpdate(
        {
          testid: req.query.testid,
          sessionid:req.query.sessionid,
          regno: req.query.regno,
          student: req.query.student,
        },
        {
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
test:req.query.test,
sessionslot:req.query.sessionslot,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
        },
        {
          new: true,
          upsert: true,
        }
      );

      var emaildata='Dear Applicant,<br /><br />Thank you for enrolling in ' + req.query.test + ' for ' + req.query.sessionslot + ' internship.<br />';
      
      var test1=req.query.test;
      if(test1.indexOf('Offline')>-1 || test1.indexOf('stipend')>-1) {
        emaildata = emaildata + 'This internship is selection based. Please send your resume to team@epaathsala.com. If selected, we will call you for an interview.<br />';
        emaildata = emaildata + 'You may however apply for any online work from home internship.<br />';

      } else {
        emaildata = emaildata + 'Your internship will be activated on the scheduled date you have selected. Once activated, click on proceed and open the task files to complete the tasks mentioned in the task file.<br />';
        emaildata=emaildata + 'Once you complete the tasks, send it to team@epaathsala.com.<br />';
      emaildata = emaildata + 'Feel free to connect to your mentor by sending an email to team@epaathsala.com with your name, query and project name.<br />';

      }
      
      emaildata = emaildata + 'Wish you all the best.<br /><br />';
      emaildata = emaildata + 'Team epaathsala.'

      var email='suman@epaathsala.com';
      if(req.query.regno.toString().indexOf('@')>-1 && req.query.regno.toString().indexOf('.')>-1) {
        email = req.query.regno;
      }
      
      sendactEmail(email,emaildata,'Welcome to ' + req.query.test + ' internship');


  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};

// feb 17 2025

exports.getmiseenrol1type= async (req,res) => {
  try{
    const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await miseenrol1.find()
    .where('colid')
            .equals(colid1)
            .where('type')
            .equals(req.query.type1)
            .where('regno')
            .equals(req.query.regno);
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
    

  }  
};


// feb 19 2025

exports.getuserbyinst = async (req, res) => {
  try {
    //const user1=req.query.user;
    //const searchstring=req.query.searchstring;
    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await User.aggregate([
      {
        $match: { 
          colid: colid1
         },
      },
      {
        $group: {
          _id: "$programcode",
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  }  catch (err) {
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// feb 24 2025


exports.getmiseenrol1type= async (req,res) => {
  try{
    const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await miseenrol1.find()
    .where('colid')
            .equals(colid1)
            .where('type')
            .equals(req.query.type1)
            .where('regno')
            .equals(req.query.regno);
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
    

  }  
};


exports.getminewmbyid= async (req,res) => {
  try{

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await minewm.find({"_id" : req.query.id});
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmisessionsbyid= async (req,res) => {
  try{
      
      
    const lcat1233=await misessions.find({"_id" : req.query.id});
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// feb 25 2025

exports.getmiqnewrandom= async (req,res) => {
  try{
      const qno=parseInt(req.query.qno);
      const lcat1233= await miqnew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'testid':req.query.testid,
                    'sectionid':req.query.sectionid
                  }
                },
                {
                  $sample: { size: qno }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// mar 12 2025

exports.createinternsession1= async (req,res) => {
  try{
      // const starttime=new Date('12/06/2024 10:00 AM');
      // const endtime=new Date('12/06/2024 11:00 AM');

      var someDate = new Date(req.query.somedate);
      var someDate1=new Date(req.query.somedate);
      var numberOfDaysToAdd = 30;
      var result = someDate1.setDate(someDate1.getDate() + numberOfDaysToAdd);

      // var numhours = parseInt(req.query.numhours);
      // var endhours=parseInt(req.query.numhours) + 1;
      // var result = someDate.setHours(someDate.getHours() + numhours);
      // var result1 = someDate1.setHours(someDate1.getHours() + endhours);

      console.log(result);


      const starttime=new Date(someDate);
      const endtime=new Date(someDate1);


      const lcat1233= await minewm
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);

                lcat1233.forEach(async function(data){
                  console.log(data._id + ' ' + data.testc);


                  const pub1= await misessions.create({
                    name: 'CT exam',
                    colid: parseInt(req.query.colid),
                    user: 'ct@ctexam.in',
                    testid:data._id ,
          session:data.testc + ' ' + starttime,
          starttime:starttime,
          endtime:endtime,
          type:'Enrolled',
          level:'National',
          status1: 'Submitted',
                    comments: 'NA'
                });
                  //moucount=data.total_attendance;
                  
                  })
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success'
                
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// mar 29 2025

exports.getminewmsearchhei= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await minewm.find({
      "colid" : req.query.colid,
      "type" : "HEI",
      // "testc": /.*Skill.*/
      "testc":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getminewmsearchsch= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await minewm.find({
      "colid" : req.query.colid,
      "type" : "School",
      // "testc": /.*Skill.*/
      "testc":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// apr 10 2025

exports.getinternlevel= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await minewm.distinct("level",{
      "colid" : req.query.colid,
      "type" : req.query.type,
      "level":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getminewmsearchhei1= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await minewm.find({
      "colid" : req.query.colid,
      "type" : req.query.type,
      "level" : req.query.level,
      // "testc": /.*Skill.*/
      "testc":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// apr 28 2024


exports.getuserbyprogramcode= async (req,res) => {
  try{
      
      const lcat1233= await User
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                     'programcode':req.query.programcode
                    // 'programcode': { $in : ['NIST', ' NIST University ','Nist University ', 'NIST UNIVERSITY ','NIST ','Nist university ','NIST UNIVERSITY','National institute of science and technology University,BAM','NIST University ','NIST University'] }
                    //'programcode': { $in : ['Centurion University Of Technology And Management Bhubaneswar','Centurion universit of Technology Management','Centurion university of technology and management of chatrapur','Centurion University of Technology & Management, Bhubaneswar','Centurion University of technology and Management','Centurion university chatrapur','Centurion University of technology and management,Bbsr','Centurion University BBSR','Centurion university of technology','Centurion university technology and management, bhubaneswar','Centurion university chatrapur','Centurion university technology management','Centurion university technology and management paralakhemundi','Centurion University Technology and Management','Centurion university of technology and management, chatarpur','Centurion university of technology and managment','Centurion university of technology and management chatraput','Centurion university technology management bbsr','Centurion university of technology and management Bhubaneswar','Centurion University of technology and management,bbsr','Centurion University of Technology and Management , Chatrapur','Centurion university of technology and management,','Centurion University of Engineering And Technology','Centurian University','CENTURION UNIVERSITY OF TECHNOLOGY AND MANAGEMENT','Centurion university of technology and management, bhubaneswar','CENTURION UNIVERSITY OF TECHNOLOGY AND MANAGEMENT','Centurion university technology of management','Centurion university technology','Centurion university of technology and management, Bhubaneswar','Centurion University of technology and management (cutm)','Centurion University of Technology and Management, Bhubaneswar Campus','Centurion university of technology and management odisha','Centurion university of technology & management, Bhubaneswar','Centurion university of technology and management bbsr odisha','Centurion University of technology','Centurian University','Centurion university technology management','Centurion University of technology and management, Bhubaneswar campus','Centurion University of Technolony and Managment','Centurion University Technology and management','Centurion University of Technology Management','Centurion college of university','Centurion University of Technology','Centurion University technology and management','Centurion university of technology and management, bhubaneswar.','Centurion university of management and technology, Baleswar campus','Centurion university of Technology and Management','Centurian university balasore','Centurion university','Centurion University of technology and management bhubaneswar jatani','Centurion university of Technology and management','Centurion university bbsr','Centurion University, BBSR','centurion university ,Bhubaneswar','Centurion University of Technology and Management Bhubaneswar Odisha','Centurion University of Technology and Management, Jatni,Odisha','Centurion University bhubaneshwar','Centurion university of Technology and Management. Bhubaneswar','Century university','Centurian University of Technology and Management','Centurion university of technology & management','Centurion University bhubaneswar','Centurion University, Bhubaneswar','Centurion University of Technology And Management','Centurion University of Technology and Management','Centurion university of technology','Centurion University of Technology & Management, Bhubaneswar','CENTURION UNIVERSITY','Centurion University of Technology & Management,Bhubaneswar.','Centurion university and management','Centurion university of technology and management, Jatani, bhubaneswar','Centurion university chattarpur','Centurion university Technology and Management','Centurion University of Technology and Management, Bhubaneswar','Centurion university of technology and management,Gopalpur,Balasore','Centurion University Of Technology And Management','Centurion University of Technology And Management','Centurion University of Technology and Management, Bhubaneshwar','Centurion University Technology and Management','Centurion university technology and management bhubaneswar','Centurion university of technology and management,Bhubaneswar','Centurion University of technology and management jatni','Centurion university of technology and management bhubaneswar','Centurion university of technology and management','Centurion university of technology and management, bbsr , odisha','Centurion university of technology, khordha','Centurion University of Technology and Management','Centurion university of technology and management, bbsr','Centurion University of Technology and Management Bhubaneswar','Centurion university of technology and management Bhubaneswar','Centurion University of Technology Management Bhubaneswar','Centurion University of technology and management, Bhubaneswar','Centurion University of Technology and Management in jatni','Centurion university and manegement','Centurion university of technology and Manangment','Centurion university, chatrapur','Centuri university of Technology and Management ( CUTM )','Centurion University of Technology and Managment','Centurion University of technology and management of chatrapur','Centurion university  technology and management','Centurion university','Centurion university of technology and management chatrapur','Centurion university, Chatrapur','Centurion university and technology of management','Centurion university of technology Paralakhamundi','Centurion University  Of Technology And Management','Centurion University of Technology and management','Centurian university of management and technology','CENTURION UNIVERSITY AND MANAGEMENT','Centurion University of Technology and Management Paralakhemudi Odisha','Centurion university, bhubaneswar','Centuriyan university of technology and management','centurion university','Centurion university bhubaneswar','Centurion University , Jatni , Khordha','Centurion University, Bbsr','centurion university of technology and management','Centurion university jatani','CENTURION UNIVERSITY OF TECHNOLOGY AND MANAGEMENT PARALAKHEMUNDI','Centurion University of Technology and Management, Paralakhemundi','Centurion university bbsr','Centurion University of technology and management','Centurian university chattrapir','Centurion university of technology and management (Cutm)','Centurion University Of Technology And Management, Bhubaneswar, Odisha','Centurion University of Technology and Management, bbsr','Centurion university of  technology and management','Centurion University of Technology and Management, BBSR','Centurion University , Bbsr','Centurion university of technology management','Centurion University of Technology and Manage','Centurion University of technology and management bbsr','Centurion University of Technology and Management bhubaneswar','Centurian university of technology and management','Centurion university technology and management','Centurion university tecnology and management','Centurion university of Technology and Management, Bhubaneswar','Centurion University of Technology and Management bbsr','Centurion University technology and Management','Centurion University','Centurion University of Technology & Management','Centurion university of technology and management','CENTURION UNIVERSITY BHUBANESWAR','Centurian University Of Technology And Management','Centurion university of technology and Mengenents','centurion University of technology and management','Centurion univercity','Centurion University Technology And Management','Centurion University of Technology & Management','Centurion university of technology and Management','Centurion University technology and management','Centurion University of Technology of Management','Centurion university of technology and management jatni','Centurion university technology management chatrapur','Centurion university of Technology, Bhubaneswar','CENTURION UNIVERSITY','Centurion university Technology and managment','Centurion university of Engineering and technology','Centurion University technology of management','centurion university of technology','Centurion University of Technology and Management, Bhubaneswar','Centurion university of technology and management system','Centurion University of Technology and Management, Bhubaneswar, Odisha','Centurion university , bbsr','Centurion University,Technology and management','Centurion university of technology and management, Gopalpur, Balasore','Centurion university of technology and management,BBSR, Jatani,Odisha','centurion University of Technology and Management','Centurion University Technology and management Balesore','Centurion university technology and management (cutm)','Centurion University of technology and management, Bhubaneswar l','Centuries university of technology and management palakhemundi campus','Centurion university, bhubaneswar n','Centurion University Of Technology and Management','Centurion University Of Technology And Management','Centurion University Of Technology and Management,Bhubaneswar','Centurion  University  Of Menagement And Technology','Centurian university','Centurion University,Chatrapur','Centurion university bhubaneswar','Centurion university of technology and management pkd','Centurion university of technology and management bbsr','Centurion University Of Technology and Management','Centurion University of management and Technology, Gopalpur, Baleswar','Centurion University of Technology and Management , Bhubaneswar','Centurion university technology and management','Centurion University of technology and management ,bhubaneswar campus','Centurion university Chhatrapur','Centurion University','Centurion Univesity','Centurion university Bhubaneswar','Centurion university of Technology and Management','Centurion University of technology and management','Centurion university.chatrpur','Centurion University Bhubaneswar','Centurion university, BBSR','Centurion University of Technology and management','Centurion university of technology & management, bhubaneswar','Centurion University Of Technology and Management, Bhubaneswar','Centurion university of technology and management of chatarpur','Centurion university  bhubaneswar','Centurion University of Technology and Management, Parlakhemundhi, Odisha','Centurion University of Technology and Management (CUTM)','Centurion University chatrapur','Centurion University of Technology and Management, Parlakhemundi','Centurion university of Technology and management','Centurian university of Technology and Management bhubaneswar','Centurion University Technology management','Centurion university,bbsr','Centurion University of Technology & Management,  Bhubaneswar,  Odisha','Centurion University technology & menegement','Centurion university of Technology and Management Bhubaneswar','Centurion University of technology and management bhubaneswar','Centurion University of technology and management Bhubaneswar Campus','Centurion University of Technology and Mangement','Centurion','Centurian university','Centurion','Centurion university of technology and management paralakhemundi','Centurion University of technology and management, bhubaneswar'] }
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getinternupcoming= async (req,res) => {
  try{
      
      const lcat1233= await miseenrol1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                     'type':'Upcoming'
                    // 'programcode': { $in : ['NIST', ' NIST University ','Nist University ', 'NIST UNIVERSITY ','NIST ','Nist university ','NIST UNIVERSITY','National institute of science and technology University,BAM','NIST University ','NIST University'] }
                    
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// may 2 2024


exports.getbmoubyfac= async (req,res) => {
  try{
      
      const lcat1233= await bmou
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.bmoudocs= async (req,res) => {
  try{
      
      const lcat1233= await bmou
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.bmoulinks= async (req,res) => {
try{
    
    const lcat1233= await bmou
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createbmoubyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      //console.log(req.query.year);

      const pub1= await bmou.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
purpose:req.query.purpose,
bodyname:req.query.bodyname,
bodytype:req.query.bodytype,
address:req.query.address,
signdate:req.query.signdate,
duration:req.query.duration,
activity:req.query.activity,
link:req.query.link,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatebmoubyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await bmou.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
purpose:req.query.purpose,
bodyname:req.query.bodyname,
bodytype:req.query.bodytype,
address:req.query.address,
signdate:req.query.signdate,
duration:req.query.duration,
activity:req.query.activity,
link:req.query.link,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatebmoucomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await bmou.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletebmoubyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await bmou.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// may 2 2024 graph

exports.getbmoucount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await bmou.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  return res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  // res.status(400).json({
  // status:'Failed',
  // message: err
  // });
              
  } 
  };  


  exports.getbmousecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await bmou.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
  //   res.status(400).json({
  //   status:'Failed',
  //   message: err
  //   });
                
    } 
    };  



    exports.getbmoucountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await bmou.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      // res.status(400).json({
      // status:'Failed',
      // message: err
      // });
                  
      } 
      };  
    
    
      exports.getbmousecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await bmou.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
      //   res.status(400).json({
      //   status:'Failed',
      //   message: err
      //   });
                    
        } 
        };  


  // msy 4 2024

  exports.getbmoucount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await bmou.aggregate([
    { 
    $match: {colid: colid1, year: req.query.year }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  

    // may 6 2024


exports.getbtrialbbyfac= async (req,res) => {
  try{
      
      const lcat1233= await btrialb
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.btrialbdocs= async (req,res) => {
  try{
      
      const lcat1233= await btrialb
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.btrialblinks= async (req,res) => {
try{
    
    const lcat1233= await btrialb
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createbtrialbbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await btrialb.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
accounting:req.query.accounting,
amount:req.query.amount,
nature:req.query.nature,
purpose:req.query.purpose,
department:req.query.department,
bank:req.query.bank,
ledgerref:req.query.ledgerref,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatebtrialbbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await btrialb.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
accounting:req.query.accounting,
amount:req.query.amount,
nature:req.query.nature,
purpose:req.query.purpose,
department:req.query.department,
bank:req.query.bank,
ledgerref:req.query.ledgerref,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatebtrialbcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await btrialb.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletebtrialbbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await btrialb.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getbfacyearbyfac= async (req,res) => {
  try{
      
      const lcat1233= await bfacyear
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.bfacyeardocs= async (req,res) => {
  try{
      
      const lcat1233= await bfacyear
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.bfacyearlinks= async (req,res) => {
try{
    
    const lcat1233= await bfacyear
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createbfacyearbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await bfacyear.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
department:req.query.department,
programcode:req.query.programcode,
faculty:req.query.faculty,
designation:req.query.designation,
qualification:req.query.qualification,
pgyear:req.query.pgyear,
phdyear:req.query.phdyear,
doj:req.query.doj,
dol:req.query.dol,
experience:req.query.experience,
pan:req.query.pan,
unique:req.query.unique,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatebfacyearbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await bfacyear.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
department:req.query.department,
programcode:req.query.programcode,
faculty:req.query.faculty,
designation:req.query.designation,
qualification:req.query.qualification,
pgyear:req.query.pgyear,
phdyear:req.query.phdyear,
doj:req.query.doj,
dol:req.query.dol,
experience:req.query.experience,
pan:req.query.pan,
unique:req.query.unique,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatebfacyearcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await bfacyear.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletebfacyearbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await bfacyear.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getstudlistbyfac= async (req,res) => {
  try{
      
      const lcat1233= await studlist
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'user':req.query.user
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.studlistdocs= async (req,res) => {
  try{
      
      const lcat1233= await studlist
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid)
                  }
                }
                ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.studlistlinks= async (req,res) => {
try{
    
    const lcat1233= await studlist
        .aggregate([
            { $addFields: { 'userId': { $toString: '$_id' }}},
            {
                $lookup: {
                  from: 'supportingdocs', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'seminars'
                }
              },
              {
                $lookup: {
                  from: 'accrcomments', 
                  localField: 'userId', 
                  foreignField: 'field1', 
                  as: 'allcomments'
                }
              },
              {
                $match: {
                  'colid': parseInt(req.query.colid),
                  'status1' : {$ne : req.query.status1}
                }
              }
              ]);
        
        //console.log(lcat1233);
        res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });            
} catch(err) {
    res.status(400).json({
        status:'Failed',
        message: err
    });

}  
};



exports.createstudlistbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const pub1= await studlist.create({
          name: req.query.name,
          colid: req.query.colid,
          user: req.query.user,
          year:req.query.year,
department:req.query.department,
program:req.query.program,
programcode:req.query.programcode,
students:req.query.students,
gender:req.query.gender,
category:req.query.category,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });

  //res.status(200).send('Hello world for all the tours through db new router');
  return res.status(200).json({
      status:'Success'
  });

} catch(err) {
  // res.status(400).json({
  //     status:'Failed',
  //     message: err
  // });

}  
};


exports.updatestudlistbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const lcat1= await studlist.findByIdAndUpdate( req.query.id,{
          
          
          year:req.query.year,
department:req.query.department,
program:req.query.program,
programcode:req.query.programcode,
students:req.query.students,
gender:req.query.gender,
category:req.query.category,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
          comments: 'NA'
      });
      return res.status(200).json({
          status:'Success'
      });
    
 
      
            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }   
};


exports.updatestudlistcomments= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }
      const lcat1= await studlist.findByIdAndUpdate( req.query.id,{
          status1: req.query.status1,
          comments: req.query.comments
         
      });
      
      res.status(200).json({
          status:'Success'
          
      });
      
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }   
};

exports.deletestudlistbyfac= async (req,res) => {

  try{
      const token=req.query.token;
      //console.log(token);
      let jwtuser='';
      let jwtcolid='';
      try {
          const verified = jwt.verify(
              token,
              process.env.JWT_SECRET,
              (err123, verified) => {
                if (err123) {
                  return res.status(401).json({
                      status: 'Unauthorized',
                      error: err123
                  });
                }
                jwtuser=verified.user;
                jwtcolid=verified.colid;
                return verified;
              }
            );
      } catch(err1234) {
          //console.log(err1234);
      }

      const user1=req.query.user;
      await studlist.findByIdAndDelete(req.query.id);
      
      return res.status(200).json({
          status:'Success'
      });
             
     
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// may 6 2024 graph

exports.getbtrialbcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await btrialb.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$type', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getbtrialbsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await btrialb.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$level', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getbtrialbcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await btrialb.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$type', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getbtrialbsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await btrialb.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$level', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getbfacyearcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await bfacyear.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getbfacyearsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await bfacyear.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$qualification', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getbfacyearcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await bfacyear.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getbfacyearsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await bfacyear.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$qualification', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  




exports.getstudlistcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await studlist.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getstudlistsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await studlist.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getstudlistcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await studlist.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getstudlistsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await studlist.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  



// may 6 2024 new

exports.getbtrialbcountyear= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await btrialb.aggregate([
  { 
  $match: {colid: colid1, year: req.query.year, purpose: req.query.purpose }
  },
  { 
  $group: {
  _id:'$year', 
  total_attendance: {$sum : '$amount'}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getscholcountyear = async (req, res) => {
    try {
      //const user1=req.query.user;
      const colid1 = parseInt(req.query.colid);
      const lcat1233 = await scholnew.aggregate([
        {
          $match: { colid: colid1, year: req.query.year },
        },
        {
          $group: {
            _id: "$year",
            total_attendance: { $sum: "$amount" },
          },
        },
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
        status: "Success",
        data: {
          classes: lcat1233,
        },
      });
    }  catch (err) {
      //res.status(400).json({
       // status: "Failed",
      //  message: err,
     // });
    }
  };


// May 7 2024

exports.getscholdistinct= async (req,res) => {
  try{

    // const searchstring=req.query.searchstring;
    // const s1='/.*' + searchstring + '.*/'

    const lcat1233=await scholnew.distinct("student",{
      "colid" : req.query.colid, "year" : req.query.year
    });
          
          //console.log(lcat1233.length);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233.length
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


// jun 3 2025


exports.getnn11byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn11
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn11docs= async (req,res) => {
    try{
        
        const lcat1233= await nn11
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn11links= async (req,res) => {
  try{
      
      const lcat1233= await nn11
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn11byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn11.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            program:req.query.program,
programcode:req.query.programcode,
cbcs:req.query.cbcs,
cbcsyear:req.query.cbcsyear,
obe:req.query.obe,
year:req.query.year,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn11byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn11.findByIdAndUpdate( req.query.id,{
            
            
            program:req.query.program,
programcode:req.query.programcode,
cbcs:req.query.cbcs,
cbcsyear:req.query.cbcsyear,
obe:req.query.obe,
year:req.query.year,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn11comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn11.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn11byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn11.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn12byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn12
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn12docs= async (req,res) => {
    try{
        
        const lcat1233= await nn12
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn12links= async (req,res) => {
  try{
      
      const lcat1233= await nn12
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn12byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn12.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
students:req.query.students,
faculty:req.query.faculty,
alumni:req.query.alumni,
parents:req.query.parents,
employer:req.query.employer,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn12byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn12.findByIdAndUpdate( req.query.id,{
            
            
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
students:req.query.students,
faculty:req.query.faculty,
alumni:req.query.alumni,
parents:req.query.parents,
employer:req.query.employer,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn12comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn12.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn12byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn12.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn14byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn14
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn14docs= async (req,res) => {
    try{
        
        const lcat1233= await nn14
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn14links= async (req,res) => {
  try{
      
      const lcat1233= await nn14
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn14byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn14.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
projects:req.query.projects,
internship:req.query.internship,
studproj:req.query.studproj,
studintern:req.query.studintern,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn14byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn14.findByIdAndUpdate( req.query.id,{
            
            
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
projects:req.query.projects,
internship:req.query.internship,
studproj:req.query.studproj,
studintern:req.query.studintern,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn14comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn14.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn14byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn14.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn15byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn15
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn15docs= async (req,res) => {
    try{
        
        const lcat1233= await nn15
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn15links= async (req,res) => {
  try{
      
      const lcat1233= await nn15
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn15byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn15.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
mooc:req.query.mooc,
moocp:req.query.moocp,
moocper:req.query.moocper,
moocno:req.query.moocno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn15byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn15.findByIdAndUpdate( req.query.id,{
            
            
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
mooc:req.query.mooc,
moocp:req.query.moocp,
moocper:req.query.moocper,
moocno:req.query.moocno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn15comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn15.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn15byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn15.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn16byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn16
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn16docs= async (req,res) => {
    try{
        
        const lcat1233= await nn16
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn16links= async (req,res) => {
  try{
      
      const lcat1233= await nn16
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn16byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn16.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
mooc:req.query.mooc,
guestl:req.query.guestl,
onlinec:req.query.onlinec,
offlinec:req.query.offlinec,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn16byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn16.findByIdAndUpdate( req.query.id,{
            
            
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
mooc:req.query.mooc,
guestl:req.query.guestl,
onlinec:req.query.onlinec,
offlinec:req.query.offlinec,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn16comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn16.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn16byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn16.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn17byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn17
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn17docs= async (req,res) => {
    try{
        
        const lcat1233= await nn17
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn17links= async (req,res) => {
  try{
      
      const lcat1233= await nn17
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn17byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn17.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
revision:req.query.revision,
revisionp:req.query.revisionp,
bosdate:req.query.bosdate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn17byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn17.findByIdAndUpdate( req.query.id,{
            
            
            program:req.query.program,
programcode:req.query.programcode,
year:req.query.year,
revision:req.query.revision,
revisionp:req.query.revisionp,
bosdate:req.query.bosdate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn17comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn17.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn17byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn17.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// jun 3 graph

exports.getnn11count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn11.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn11second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn11.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn11countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn11.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn11secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn11.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn12count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn12.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn12second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn12.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn12countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn12.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn12secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn12.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn14count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn14.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn14second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn14.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn14countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn14.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn14secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn14.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn15count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn15.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn15second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn15.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn15countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn15.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn15secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn15.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn16count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn16.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn16second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn16.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn16countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn16.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn16secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn16.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn17count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn17.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn17second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn17.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn17countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn17.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn17secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn17.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  // Jun 4 2025


exports.getnn211abyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn211a
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn211adocs= async (req,res) => {
    try{
        
        const lcat1233= await nn211a
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn211alinks= async (req,res) => {
  try{
      
      const lcat1233= await nn211a
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn211abyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn211a.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            committee:req.query.committee,
comcode:req.query.comcode,
year:req.query.year,
ugc:req.query.ugc,
member:req.query.member,
sme:req.query.sme,
meetingdate:req.query.meetingdate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn211abyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn211a.findByIdAndUpdate( req.query.id,{
            
            
            committee:req.query.committee,
comcode:req.query.comcode,
year:req.query.year,
ugc:req.query.ugc,
member:req.query.member,
sme:req.query.sme,
meetingdate:req.query.meetingdate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn211acomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn211a.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn211abyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn211a.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn211bbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn211b
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn211bdocs= async (req,res) => {
    try{
        
        const lcat1233= await nn211b
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn211blinks= async (req,res) => {
  try{
      
      const lcat1233= await nn211b
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn211bbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn211b.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            committee:req.query.committee,
comcode:req.query.comcode,
year:req.query.year,
university:req.query.university,
faculty:req.query.faculty,
isphd:req.query.isphd,
rdate:req.query.rdate,
designation:req.query.designation,
salary:req.query.salary,
ugc:req.query.ugc,
industryexp:req.query.industryexp,
acadexpyears:req.query.acadexpyears,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn211bbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn211b.findByIdAndUpdate( req.query.id,{
            
            
            committee:req.query.committee,
comcode:req.query.comcode,
year:req.query.year,
university:req.query.university,
faculty:req.query.faculty,
isphd:req.query.isphd,
rdate:req.query.rdate,
designation:req.query.designation,
salary:req.query.salary,
ugc:req.query.ugc,
industryexp:req.query.industryexp,
acadexpyears:req.query.acadexpyears,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn211bcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn211b.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn211bbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn211b.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn22byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn22
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn22docs= async (req,res) => {
    try{
        
        const lcat1233= await nn22
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn22links= async (req,res) => {
  try{
      
      const lcat1233= await nn22
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn22byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn22.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            faculty:req.query.faculty,
designation:req.query.designation,
year:req.query.year,
sdate:req.query.sdate,
salary:req.query.salary,
allowance:req.query.allowance,
ugc:req.query.ugc,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn22byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn22.findByIdAndUpdate( req.query.id,{
            
            
            faculty:req.query.faculty,
designation:req.query.designation,
year:req.query.year,
sdate:req.query.sdate,
salary:req.query.salary,
allowance:req.query.allowance,
ugc:req.query.ugc,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn22comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn22.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn22byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn22.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn23byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn23
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn23docs= async (req,res) => {
    try{
        
        const lcat1233= await nn23
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn23links= async (req,res) => {
  try{
      
      const lcat1233= await nn23
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn23byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn23.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            faculty:req.query.faculty,
designation:req.query.designation,
year:req.query.year,
gender:req.query.gender,
state1:req.query.state1,
state2:req.query.state2,
country:req.query.country,
foreigner:req.query.foreigner,
category1:req.query.category1,
category2:req.query.category2,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn23byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn23.findByIdAndUpdate( req.query.id,{
            
            
            faculty:req.query.faculty,
designation:req.query.designation,
year:req.query.year,
gender:req.query.gender,
state1:req.query.state1,
state2:req.query.state2,
country:req.query.country,
foreigner:req.query.foreigner,
category1:req.query.category1,
category2:req.query.category2,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn23comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn23.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn23byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn23.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn244byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn244
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn244docs= async (req,res) => {
    try{
        
        const lcat1233= await nn244
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn244links= async (req,res) => {
  try{
      
      const lcat1233= await nn244
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn244byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn244.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            faculty:req.query.faculty,
designation:req.query.designation,
year:req.query.year,
mooc:req.query.mooc,
mplatform:req.query.mplatform,
certdate:req.query.certdate,
mrole:req.query.mrole,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn244byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn244.findByIdAndUpdate( req.query.id,{
            
            
            faculty:req.query.faculty,
designation:req.query.designation,
year:req.query.year,
mooc:req.query.mooc,
mplatform:req.query.mplatform,
certdate:req.query.certdate,
mrole:req.query.mrole,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn244comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn244.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn244byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn244.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn25byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn25
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn25docs= async (req,res) => {
    try{
        
        const lcat1233= await nn25
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn25links= async (req,res) => {
  try{
      
      const lcat1233= await nn25
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn25byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn25.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
designation:req.query.designation,
sanctioned:req.query.sanctioned,
employed:req.query.employed,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn25byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn25.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
designation:req.query.designation,
sanctioned:req.query.sanctioned,
employed:req.query.employed,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn25comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn25.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn25byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn25.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn26byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn26
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn26docs= async (req,res) => {
    try{
        
        const lcat1233= await nn26
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn26links= async (req,res) => {
  try{
      
      const lcat1233= await nn26
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn26byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn26.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
faculties:req.query.faculties,
students:req.query.students,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn26byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn26.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
faculties:req.query.faculties,
students:req.query.students,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn26comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn26.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn26byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn26.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn31byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn31
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn31docs= async (req,res) => {
    try{
        
        const lcat1233= await nn31
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn31links= async (req,res) => {
  try{
      
      const lcat1233= await nn31
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn31byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn31.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
facility:req.query.facility,
Faccode:req.query.Faccode,
mlocation:req.query.mlocation,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn31byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn31.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
facility:req.query.facility,
Faccode:req.query.Faccode,
mlocation:req.query.mlocation,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn31comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn31.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn31byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn31.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn32byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn32
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn32docs= async (req,res) => {
    try{
        
        const lcat1233= await nn32
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn32links= async (req,res) => {
  try{
      
      const lcat1233= await nn32
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn32byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn32.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
library:req.query.library,
eresource:req.query.eresource,
erno:req.query.erno,
expenditure:req.query.expenditure,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn32byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn32.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
library:req.query.library,
eresource:req.query.eresource,
erno:req.query.erno,
expenditure:req.query.expenditure,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn32comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn32.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn32byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn32.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// jun 4 2025 graph

exports.getnn211acount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn211a.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn211asecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn211a.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn211acountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn211a.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn211asecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn211a.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn211bcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn211b.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn211bsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn211b.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn211bcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn211b.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn211bsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn211b.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn22count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn22.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn22second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn22.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn22countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn22.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn22secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn22.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn23count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn23.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn23second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn23.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn23countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn23.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn23secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn23.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn244count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn244.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn244second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn244.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn244countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn244.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn244secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn244.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn25count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn25.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn25second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn25.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn25countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn25.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn25secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn25.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn26count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn26.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn26second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn26.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn26countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn26.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn26secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn26.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn31count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn31.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn31second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn31.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn31countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn31.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn31secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn31.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn32count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn32.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn32second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn32.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn32countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn32.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn32secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn32.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  // june 4 1127


exports.getnn33abyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn33a
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn33adocs= async (req,res) => {
    try{
        
        const lcat1233= await nn33a
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn33alinks= async (req,res) => {
  try{
      
      const lcat1233= await nn33a
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn33abyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn33a.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
students:req.query.students,
computers:req.query.computers,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn33abyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn33a.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
students:req.query.students,
computers:req.query.computers,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn33acomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn33a.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn33abyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn33a.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn33bbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn33b
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn33bdocs= async (req,res) => {
    try{
        
        const lcat1233= await nn33b
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn33blinks= async (req,res) => {
  try{
      
      const lcat1233= await nn33b
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn33bbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn33b.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
lab:req.query.lab,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn33bbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn33b.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
lab:req.query.lab,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn33bcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn33b.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn33bbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn33b.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn35byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn35
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn35docs= async (req,res) => {
    try{
        
        const lcat1233= await nn35
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn35links= async (req,res) => {
  try{
      
      const lcat1233= await nn35
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn35byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn35.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
facility:req.query.facility,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn35byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn35.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
facility:req.query.facility,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn35comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn35.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn35byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn35.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn36byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn36
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn36docs= async (req,res) => {
    try{
        
        const lcat1233= await nn36
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn36links= async (req,res) => {
  try{
      
      const lcat1233= await nn36
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn36byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn36.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
facility:req.query.facility,
location:req.query.location,
agency:req.query.agency,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn36byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn36.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
facility:req.query.facility,
location:req.query.location,
agency:req.query.agency,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn36comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn36.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn36byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn36.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn46byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn46
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn46docs= async (req,res) => {
    try{
        
        const lcat1233= await nn46
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn46links= async (req,res) => {
  try{
      
      const lcat1233= await nn46
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn46byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn46.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
extaudit:req.query.extaudit,
intaudit:req.query.intaudit,
budget:req.query.budget,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn46byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn46.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
extaudit:req.query.extaudit,
intaudit:req.query.intaudit,
budget:req.query.budget,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn46comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn46.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn46byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn46.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// june 4 1127 graph

exports.getnn33acount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn33a.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn33asecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn33a.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn33acountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn33a.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn33asecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn33a.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn33bcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn33b.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn33bsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn33b.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn33bcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn33b.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn33bsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn33b.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn35count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn35.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn35second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn35.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn35countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn35.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn35secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn35.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn36count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn36.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn36second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn36.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn36countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn36.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn36secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn36.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn46count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn46.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn46second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn46.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn46countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn46.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn46secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn46.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  // jun 5 2025


exports.getnn51byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn51
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn51docs= async (req,res) => {
    try{
        
        const lcat1233= await nn51
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn51links= async (req,res) => {
  try{
      
      const lcat1233= await nn51
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn51byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn51.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
pedagogy:req.query.pedagogy,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn51byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn51.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
pedagogy:req.query.pedagogy,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn51comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn51.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn51byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn51.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn52byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn52
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn52docs= async (req,res) => {
    try{
        
        const lcat1233= await nn52
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn52links= async (req,res) => {
  try{
      
      const lcat1233= await nn52
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn52byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn52.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
project:req.query.project,
employer:req.query.employer,
startdate:req.query.startdate,
enddate:req.query.enddate,
stipend:req.query.stipend,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn52byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn52.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
project:req.query.project,
employer:req.query.employer,
startdate:req.query.startdate,
enddate:req.query.enddate,
stipend:req.query.stipend,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn52comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn52.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn52byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn52.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn53examdaysbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn53examdays
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn53examdaysdocs= async (req,res) => {
    try{
        
        const lcat1233= await nn53examdays
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn53examdayslinks= async (req,res) => {
  try{
      
      const lcat1233= await nn53examdays
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn53examdaysbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn53examdays.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
examdate:req.query.examdate,
resultdate:req.query.resultdate,
noofdays:req.query.noofdays,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn53examdaysbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn53examdays.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
examdate:req.query.examdate,
resultdate:req.query.resultdate,
noofdays:req.query.noofdays,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn53examdayscomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn53examdays.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn53examdaysbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn53examdays.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn53passpbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn53passp
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn53passpdocs= async (req,res) => {
    try{
        
        const lcat1233= await nn53passp
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn53passplinks= async (req,res) => {
  try{
      
      const lcat1233= await nn53passp
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn53passpbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn53passp.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
appeared:req.query.appeared,
passed:req.query.passed,
passp:req.query.passp,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn53passpbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn53passp.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
appeared:req.query.appeared,
passed:req.query.passed,
passp:req.query.passp,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn53passpcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn53passp.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn53passpbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn53passp.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn53obebyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn53obe
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn53obedocs= async (req,res) => {
    try{
        
        const lcat1233= await nn53obe
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn53obelinks= async (req,res) => {
  try{
      
      const lcat1233= await nn53obe
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn53obebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn53obe.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
co:req.query.co,
po:req.query.po,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn53obebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn53obe.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
co:req.query.co,
po:req.query.po,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn53obecomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn53obe.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn53obebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn53obe.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn54byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn54
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn54docs= async (req,res) => {
    try{
        
        const lcat1233= await nn54
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn54links= async (req,res) => {
  try{
      
      const lcat1233= await nn54
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn54byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn54.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
requests:req.query.requests,
resolved:req.query.resolved,
changed:req.query.changed,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn54byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn54.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
requests:req.query.requests,
resolved:req.query.resolved,
changed:req.query.changed,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn54comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn54.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn54byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn54.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn55byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn55
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn55docs= async (req,res) => {
    try{
        
        const lcat1233= await nn55
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn55links= async (req,res) => {
  try{
      
      const lcat1233= await nn55
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn55byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn55.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
total:req.query.total,
slow:req.query.slow,
advanced:req.query.advanced,
diverse:req.query.diverse,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn55byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn55.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
total:req.query.total,
slow:req.query.slow,
advanced:req.query.advanced,
diverse:req.query.diverse,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn55comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn55.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn55byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn55.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn56byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn56
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn56docs= async (req,res) => {
    try{
        
        const lcat1233= await nn56
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn56links= async (req,res) => {
  try{
      
      const lcat1233= await nn56
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn56byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn56.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
lms:req.query.lms,
students:req.query.students,
faculty:req.query.faculty,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn56byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn56.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
lms:req.query.lms,
students:req.query.students,
faculty:req.query.faculty,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn56comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn56.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn56byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn56.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// jun 5 2025 graph

exports.getnn51count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn51.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn51second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn51.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn51countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn51.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn51secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn51.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn52count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn52.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn52second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn52.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn52countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn52.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn52secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn52.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn53examdayscount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn53examdays.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn53examdayssecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn53examdays.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn53examdayscountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn53examdays.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn53examdayssecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn53examdays.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn53passpcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn53passp.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn53passpsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn53passp.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn53passpcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn53passp.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn53passpsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn53passp.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn53obecount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn53obe.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn53obesecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn53obe.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn53obecountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn53obe.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn53obesecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn53obe.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn54count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn54.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn54second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn54.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn54countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn54.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn54secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn54.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn55count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn55.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn55second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn55.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn55countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn55.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn55secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn55.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn56count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn56.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn56second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn56.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn56countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn56.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn56secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn56.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  // june 5 2025 1


exports.getnallaccrbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nallaccr
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nallaccrdocs= async (req,res) => {
    try{
        
        const lcat1233= await nallaccr
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nallaccrlinks= async (req,res) => {
  try{
      
      const lcat1233= await nallaccr
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnallaccrbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nallaccr.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
acreditation:req.query.acreditation,
criteria:req.query.criteria,
qno:req.query.qno,
question:req.query.question,
keywords:req.query.keywords,
sequence:req.query.sequence,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenallaccrbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nallaccr.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
acreditation:req.query.acreditation,
criteria:req.query.criteria,
qno:req.query.qno,
question:req.query.question,
keywords:req.query.keywords,
sequence:req.query.sequence,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenallaccrcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nallaccr.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenallaccrbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nallaccr.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// june 5 2025 1 graph all

exports.getnallaccrcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nallaccr.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnallaccrsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nallaccr.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnallaccrcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nallaccr.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnallaccrsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nallaccr.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
exports.getnallaccrall= async (req,res) => {
    try{
        
        const lcat1233= await nallaccr
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': 111362,
                      'acreditation': req.query.acreditation
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  // June 6 2025


exports.getnallaccransbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nallaccrans
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nallaccransdocs= async (req,res) => {
    try{
        
        const lcat1233= await nallaccrans
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nallaccranslinks= async (req,res) => {
  try{
      
      const lcat1233= await nallaccrans
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnallaccransbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nallaccrans.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
acreditation:req.query.acreditation,
criteria:req.query.criteria,
qno:req.query.qno,
question:req.query.question,
answer:req.query.answer,
sequence:req.query.sequence,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenallaccransbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nallaccrans.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
acreditation:req.query.acreditation,
criteria:req.query.criteria,
qno:req.query.qno,
question:req.query.question,
answer:req.query.answer,
sequence:req.query.sequence,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenallaccranscomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nallaccrans.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenallaccransbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nallaccrans.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// june 6 2025 graph

exports.getnallaccranscount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nallaccrans.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnallaccranssecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nallaccrans.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnallaccranscountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nallaccrans.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnallaccranssecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nallaccrans.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  


    
exports.getnallaccransbyfac1= async (req,res) => {
    try{
        
        const lcat1233= await nallaccrans
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user,
                      'acreditation':req.query.acreditation,
                      'year':req.query.year
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };

  exports.getnallaccransbyall= async (req,res) => {
    try{
        
        const lcat1233= await nallaccrans
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'acreditation':req.query.acreditation,
                      'year':req.query.year
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  // Jun 8 2025


exports.getnn61byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn61
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn61docs= async (req,res) => {
    try{
        
        const lcat1233= await nn61
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn61links= async (req,res) => {
  try{
      
      const lcat1233= await nn61
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn61byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn61.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
club:req.query.club,
activity:req.query.activity,
actdate:req.query.actdate,
participants:req.query.participants,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn61byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn61.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
club:req.query.club,
activity:req.query.activity,
actdate:req.query.actdate,
participants:req.query.participants,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn61comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn61.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn61byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn61.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn62byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn62
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn62docs= async (req,res) => {
    try{
        
        const lcat1233= await nn62
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn62links= async (req,res) => {
  try{
      
      const lcat1233= await nn62
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn62byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn62.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
hackathon:req.query.hackathon,
activity:req.query.activity,
actdate:req.query.actdate,
participants:req.query.participants,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn62byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn62.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
hackathon:req.query.hackathon,
activity:req.query.activity,
actdate:req.query.actdate,
participants:req.query.participants,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn62comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn62.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn62byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn62.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn6clubsbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nn6clubs
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn6clubsdocs= async (req,res) => {
    try{
        
        const lcat1233= await nn6clubs
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn6clubslinks= async (req,res) => {
  try{
      
      const lcat1233= await nn6clubs
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn6clubsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn6clubs.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
club:req.query.club,
clubtype:req.query.clubtype,
activity:req.query.activity,
actdate:req.query.actdate,
participants:req.query.participants,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn6clubsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn6clubs.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
club:req.query.club,
clubtype:req.query.clubtype,
activity:req.query.activity,
actdate:req.query.actdate,
participants:req.query.participants,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn6clubscomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn6clubs.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn6clubsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn6clubs.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.getnn61count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn61.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn61second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn61.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn61countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn61.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn61secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn61.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn62count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn62.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn62second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn62.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn62countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn62.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn62secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn62.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn6clubscount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn6clubs.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn6clubssecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn6clubs.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn6clubscountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn6clubs.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn6clubssecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn6clubs.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  // June 9 2025


exports.getnn76byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn76
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn76docs= async (req,res) => {
    try{
        
        const lcat1233= await nn76
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn76links= async (req,res) => {
  try{
      
      const lcat1233= await nn76
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn76byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn76.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
quarter:req.query.quarter,
participants:req.query.participants,
activity:req.query.activity,
actdate:req.query.actdate,
agenda:req.query.agenda,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn76byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn76.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
quarter:req.query.quarter,
participants:req.query.participants,
activity:req.query.activity,
actdate:req.query.actdate,
agenda:req.query.agenda,
location:req.query.location,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn76comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn76.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn76byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn76.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn781byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn781
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn781docs= async (req,res) => {
    try{
        
        const lcat1233= await nn781
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn781links= async (req,res) => {
  try{
      
      const lcat1233= await nn781
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn781byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn781.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
party:req.query.party,
agenda:req.query.agenda,
activity:req.query.activity,
moudate:req.query.moudate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn781byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn781.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
party:req.query.party,
agenda:req.query.agenda,
activity:req.query.activity,
moudate:req.query.moudate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn781comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn781.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn781byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn781.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn82byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn82
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn82docs= async (req,res) => {
    try{
        
        const lcat1233= await nn82
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn82links= async (req,res) => {
  try{
      
      const lcat1233= await nn82
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn82byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn82.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
newprogram:req.query.newprogram,
institution:req.query.institution,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn82byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn82.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
newprogram:req.query.newprogram,
institution:req.query.institution,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn82comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn82.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn82byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn82.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn83byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn83
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn83docs= async (req,res) => {
    try{
        
        const lcat1233= await nn83
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn83links= async (req,res) => {
  try{
      
      const lcat1233= await nn83
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn83byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn83.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
company:req.query.company,
sector:req.query.sector,
contact:req.query.contact,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn83byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn83.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
company:req.query.company,
sector:req.query.sector,
contact:req.query.contact,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn83comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn83.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn83byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn83.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn84byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn84
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn84docs= async (req,res) => {
    try{
        
        const lcat1233= await nn84
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn84links= async (req,res) => {
  try{
      
      const lcat1233= await nn84
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn84byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn84.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
exam:req.query.exam,
sector:req.query.sector,
result:req.query.result,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn84byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn84.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
exam:req.query.exam,
sector:req.query.sector,
result:req.query.result,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn84comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn84.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn84byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn84.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn86byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn86
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn86docs= async (req,res) => {
    try{
        
        const lcat1233= await nn86
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn86links= async (req,res) => {
  try{
      
      const lcat1233= await nn86
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn86byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn86.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
sanctioned:req.query.sanctioned,
admitted:req.query.admitted,
applied:req.query.applied,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn86byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn86.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
sanctioned:req.query.sanctioned,
admitted:req.query.admitted,
applied:req.query.applied,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn86comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn86.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn86byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn86.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn87byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn87
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn87docs= async (req,res) => {
    try{
        
        const lcat1233= await nn87
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn87links= async (req,res) => {
  try{
      
      const lcat1233= await nn87
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn87byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn87.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
appeared:req.query.appeared,
passed:req.query.passed,
repeat:req.query.repeat,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn87byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn87.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
appeared:req.query.appeared,
passed:req.query.passed,
repeat:req.query.repeat,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn87comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn87.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn87byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn87.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn96byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn96
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn96docs= async (req,res) => {
    try{
        
        const lcat1233= await nn96
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn96links= async (req,res) => {
  try{
      
      const lcat1233= await nn96
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn96byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn96.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
participant:req.query.participant,
activity:req.query.activity,
actdate:req.query.actdate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn96byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn96.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
participant:req.query.participant,
activity:req.query.activity,
actdate:req.query.actdate,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn96comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn96.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn96byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn96.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn97byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn97
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn97docs= async (req,res) => {
    try{
        
        const lcat1233= await nn97
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn97links= async (req,res) => {
  try{
      
      const lcat1233= await nn97
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn97byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn97.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
participant:req.query.participant,
activity:req.query.activity,
actdate:req.query.actdate,
agency:req.query.agency,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn97byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn97.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
participant:req.query.participant,
activity:req.query.activity,
actdate:req.query.actdate,
agency:req.query.agency,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn97comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn97.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn97byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn97.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnn98byfac= async (req,res) => {
    try{
        
        const lcat1233= await nn98
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nn98docs= async (req,res) => {
    try{
        
        const lcat1233= await nn98
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nn98links= async (req,res) => {
  try{
      
      const lcat1233= await nn98
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnn98byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nn98.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
participant:req.query.participant,
startup:req.query.startup,
actdate:req.query.actdate,
sector:req.query.sector,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenn98byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nn98.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
program:req.query.program,
programcode:req.query.programcode,
participant:req.query.participant,
startup:req.query.startup,
actdate:req.query.actdate,
sector:req.query.sector,
doclink:req.query.doclink,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenn98comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nn98.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenn98byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nn98.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// June 9 2025 graph

exports.getnn76count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn76.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn76second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn76.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn76countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn76.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn76secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn76.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn781count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn781.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn781second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn781.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn781countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn781.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn781secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn781.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn82count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn82.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn82second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn82.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn82countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn82.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn82secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn82.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn83count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn83.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn83second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn83.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn83countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn83.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn83secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn83.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn84count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn84.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn84second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn84.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn84countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn84.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn84secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn84.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn86count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn86.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn86second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn86.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn86countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn86.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn86secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn86.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn87count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn87.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn87second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn87.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn87countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn87.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn87secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn87.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn96count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn96.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn96second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn96.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn96countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn96.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn96secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn96.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn97count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn97.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn97second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn97.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn97countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn97.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn97secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn97.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnn98count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await nn98.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getnn98second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await nn98.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getnn98countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn98.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getnn98secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await nn98.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  exports.getattmarksnew= async (req,res) => {
  try{
    const colid1=parseInt(req.query.colid);
    const limit1=parseInt(req.query.limit1);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mfaccoursesatt.find({ percentage: { $gt: limit1 } })
    .where('colid')
            .equals(colid1)
            .where('coursecode')
            .equals(req.query.coursecode)
            .where('year')
            .equals(req.query.year)
            .where('co')
            .equals(req.query.co);

    const lcat1234=await mfaccoursesatt.find()
    .where('colid')
            .equals(colid1)
            .where('coursecode')
            .equals(req.query.coursecode)
            .where('year')
            .equals(req.query.year)
            .where('co')
            .equals(req.query.co);

    const l1=lcat1233.length;
    const l2=lcat1234.length;
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              l1:l1,
              l2:l2,
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};



exports.getattyearbyfac= async (req,res) => {
    try{
        
        const lcat1233= await attyear
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.attyeardocs= async (req,res) => {
    try{
        
        const lcat1233= await attyear
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.attyearlinks= async (req,res) => {
  try{
      
      const lcat1233= await attyear
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createattyearbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

//         const pub1= await attyear.create({
//             name: req.query.name,
//             colid: req.query.colid,
//             user: req.query.user,
//             year:req.query.year,
// coursecode:req.query.coursecode,
// co:req.query.co,
// attained:req.query.attained,
// total:req.query.total,
// pattained:req.query.pattained,
// level1:req.query.level1,
// level2:req.query.level2,
// level3:req.query.level3,
// target:req.query.target,
// fleveln:req.query.fleveln,
// flevel:req.query.flevel,
// doclink:req.query.doclink,
// status1: 'Submitted',
//             comments: 'NA'
//         });

        const pat1 = await attyear.findOneAndUpdate(
      {
        coursecode:req.query.coursecode,
        year:req.query.year,
        co:req.query.co,
      },
      {
          name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            


attained:req.query.attained,
total:req.query.total,
pattained:req.query.pattained,
level1:req.query.level1,
level2:req.query.level2,
level3:req.query.level3,
target:req.query.target,
fleveln:req.query.fleveln,
flevel:req.query.flevel,
doclink:req.query.doclink,
status1: 'Submitted',
            comments: 'NA'
      },
      {
        new: true,
        upsert: true,
      }
    );

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateattyearbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await attyear.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
coursecode:req.query.coursecode,
co:req.query.co,
attained:req.query.attained,
total:req.query.total,
pattained:req.query.pattained,
level1:req.query.level1,
level2:req.query.level2,
level3:req.query.level3,
target:req.query.target,
fleveln:req.query.fleveln,
flevel:req.query.flevel,
doclink:req.query.doclink,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateattyearcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await attyear.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteattyearbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await attyear.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.getattyearcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await attyear.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$co', 
    total_attendance: {$avg : '$fleveln'}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getattyearsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await attyear.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$avg : '$fleveln'}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getattyearcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await attyear.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$co', 
        total_attendance: {$avg : '$fleveln'}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getattyearsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await attyear.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$year', 
          total_attendance: {$avg : '$fleveln'}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  // June 91


exports.getngroupbyfac= async (req,res) => {
    try{
        
        const lcat1233= await ngroup
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'fuser':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.ngroupdocs= async (req,res) => {
    try{
        
        const lcat1233= await ngroup
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.ngrouplinks= async (req,res) => {
  try{
      
      const lcat1233= await ngroup
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createngroupbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await ngroup.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            group1:req.query.group1,
fuser:req.query.fuser,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatengroupbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await ngroup.findByIdAndUpdate( req.query.id,{
            
            
            group1:req.query.group1,
fuser:req.query.fuser,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatengroupcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await ngroup.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletengroupbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await ngroup.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getngrouppagesbyfac= async (req,res) => {
    try{
        
        const lcat1233= await ngrouppages
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'group1':req.query.group1
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.ngrouppagesdocs= async (req,res) => {
    try{
        
        const lcat1233= await ngrouppages
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.ngrouppageslinks= async (req,res) => {
  try{
      
      const lcat1233= await ngrouppages
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createngrouppagesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await ngrouppages.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            group1:req.query.group1,
pagelink:req.query.pagelink,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatengrouppagesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await ngrouppages.findByIdAndUpdate( req.query.id,{
            
            
            group1:req.query.group1,
pagelink:req.query.pagelink,
description:req.query.description,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatengrouppagescomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await ngrouppages.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletengrouppagesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await ngrouppages.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getngroupaccrbyfac= async (req,res) => {
    try{
        
        const lcat1233= await ngroupaccr
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'group1':req.query.group1
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.ngroupaccrdocs= async (req,res) => {
    try{
        
        const lcat1233= await ngroupaccr
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.ngroupaccrlinks= async (req,res) => {
  try{
      
      const lcat1233= await ngroupaccr
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createngroupaccrbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await ngroupaccr.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            group1:req.query.group1,
accreditation:req.query.accreditation,
qno:req.query.qno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatengroupaccrbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await ngroupaccr.findByIdAndUpdate( req.query.id,{
            
            
            group1:req.query.group1,
accreditation:req.query.accreditation,
qno:req.query.qno,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatengroupaccrcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await ngroupaccr.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletengroupaccrbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await ngroupaccr.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.getngroupcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await ngroup.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$group1', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getngroupsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await ngroup.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$group1', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getngroupcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await ngroup.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$group1', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getngroupsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await ngroup.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$group1', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getngrouppagescount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await ngrouppages.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getngrouppagessecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await ngrouppages.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getngrouppagescountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await ngrouppages.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getngrouppagessecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await ngrouppages.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getngroupaccrcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await ngroupaccr.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getngroupaccrsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await ngroupaccr.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getngroupaccrcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await ngroupaccr.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getngroupaccrsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await ngroupaccr.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getnallaccrallgroup= async (req,res) => {
    try{
        
        const lcat1233= await nallaccr
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': 111362,
                      'acreditation': req.query.acreditation,
                      'qno': req.query.qno
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
  // Jun 13 2025


exports.getmiseenrol1byreg= async (req,res) => {
  try{
    //const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await miseenrol1.find()
    // .where('colid')
    //         .equals(colid1)
            .where('regno')
            .equals(req.query.regno);
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
    

  }  
};


exports.getmtestseenrol1byreg= async (req,res) => {
  try{
    //const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await mtestseenrol1.find()
    // .where('colid')
    //         .equals(colid1)
            .where('regno')
            .equals(req.query.regno);
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
    

  }  
};

  
  // jun 14 2025

  exports.updateexamtype = async (req, res) => {
  
  const colid=parseInt(req.query.colid);

  // const lcat1 = await mtestseenrol1.updateMany(
  //   { colid: colid }, {
  //   type: "Upcoming"
  // });

  const lcat1= await mtestseenrol1.findByIdAndUpdate( req.query.id,{
          type: req.query.type
});


  return res.status(200).json({
    status: "Success",
  });

};

exports.updateinterntype = async (req, res) => {
  
  const colid=parseInt(req.query.colid);

  // const lcat1 = await mtestseenrol1.updateMany(
  //   { colid: colid }, {
  //   type: "Upcoming"
  // });

  const lcat1= await miseenrol1.findByIdAndUpdate( req.query.id,{
          type: req.query.type
});


  return res.status(200).json({
    status: "Success",
  });

};
  

exports.useractivate = async (req, res) => {
  
  const colid=parseInt(req.query.colid);

  // const lcat1 = await mtestseenrol1.updateMany(
  //   { colid: colid }, {
  //   type: "Upcoming"
  // });

  var someDate = new Date();
  var numberOfDaysToAdd = 180;
  var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
  var dt2=new Date(result);
  

    const lcat1 = await User.updateMany(
      { email: req.query.email }, {
      status1: "Yes",
      lastlogin: someDate
    });


  return res.status(200).json({
    status: "Success",
  });

};
  
  
  
  // Jun 21 2025


  
exports.gettimeslotsn1byfac= async (req,res) => {
    try{
        
        const lcat1233= await timeslotsn1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.timeslotsn1docs= async (req,res) => {
    try{
        
        const lcat1233= await timeslotsn1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.timeslotsn1links= async (req,res) => {
  try{
      
      const lcat1233= await timeslotsn1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createtimeslotsn1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await timeslotsn1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            wday:req.query.wday,
period:req.query.period,
starttime:req.query.starttime,
endtime:req.query.endtime,
program:req.query.program,
semester:req.query.semester,
section:req.query.section,
faculty:req.query.faculty,
facultyid:req.query.facultyid,
course:req.query.course,
slotstatus:req.query.slotstatus,
room:req.query.room,
capacity:req.query.capacity,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatetimeslotsn1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await timeslotsn1.findByIdAndUpdate( req.query.id,{
            
            
            wday:req.query.wday,
period:req.query.period,
starttime:req.query.starttime,
endtime:req.query.endtime,
program:req.query.program,
semester:req.query.semester,
section:req.query.section,
faculty:req.query.faculty,
facultyid:req.query.facultyid,
course:req.query.course,
slotstatus:req.query.slotstatus,
room:req.query.room,
capacity:req.query.capacity,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatetimeslotsn1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await timeslotsn1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletetimeslotsn1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await timeslotsn1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getworkloadn1byfac= async (req,res) => {
    try{
        
        const lcat1233= await workloadn1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };

  exports.getworkloadn1faculty= async (req,res) => {
    try{
        
        const lcat1233= await workloadn1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'facultyid':req.query.facultyid,
                      'type':req.query.type
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.workloadn1docs= async (req,res) => {
    try{
        
        const lcat1233= await workloadn1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.workloadn1links= async (req,res) => {
  try{
      
      const lcat1233= await workloadn1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createworkloadn1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await workloadn1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            program:req.query.program,
            programcode:req.query.programcode,
semester:req.query.semester,
section:req.query.section,
faculty:req.query.faculty,
facultyid:req.query.facultyid,
course:req.query.course,
coursecode:req.query.coursecode,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateworkloadn1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await workloadn1.findByIdAndUpdate( req.query.id,{
            
            
            program:req.query.program,
            programcode:req.query.programcode,
semester:req.query.semester,
section:req.query.section,
faculty:req.query.faculty,
facultyid:req.query.facultyid,
course:req.query.course,
coursecode:req.query.coursecode,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateworkloadn1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await workloadn1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteworkloadn1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await workloadn1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.gettimeslotsn1count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await timeslotsn1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$group1', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.gettimeslotsn1second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await timeslotsn1.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$group1', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.gettimeslotsn1countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await timeslotsn1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$group1', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.gettimeslotsn1secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await timeslotsn1.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$group1', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getworkloadn1count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await workloadn1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$type', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getworkloadn1second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await workloadn1.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$level', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getworkloadn1countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await workloadn1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$type', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getworkloadn1secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await workloadn1.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$level', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  

  // Jun 25 2025



exports.getfacwcalbyfac= async (req,res) => {
    try{
        
        const lcat1233= await facwcal
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.facwcaldocs= async (req,res) => {
    try{
        
        const lcat1233= await facwcal
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.facwcallinks= async (req,res) => {
  try{
      
      const lcat1233= await facwcal
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createfacwcalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await facwcal.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            facultyid:req.query.facultyid,
faculty:req.query.faculty,
wday:req.query.wday,
period:req.query.period,
wdayp:req.query.wdayp,
program:req.query.program,
course:req.query.course,
semester:req.query.semester,
section:req.query.section,
year:req.query.year,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatefacwcalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await facwcal.findByIdAndUpdate( req.query.id,{
            
            
            facultyid:req.query.facultyid,
faculty:req.query.faculty,
wday:req.query.wday,
period:req.query.period,
wdayp:req.query.wdayp,
program:req.query.program,
course:req.query.course,
semester:req.query.semester,
section:req.query.section,
year:req.query.year,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatefacwcalcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await facwcal.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletefacwcalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await facwcal.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getfacwcalcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await facwcal.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$group1', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getfacwcalsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await facwcal.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$group1', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getfacwcalcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await facwcal.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$group1', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getfacwcalsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await facwcal.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$group1', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  



  // Jun 22 2025

  exports.populatetimetable= async (req,res) => {
  try{
    const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await workloadn1.find().limit(1)
    .where('colid')
            .equals(colid1)
            .where('type')
            .equals('Available');

     const c= await lcat1233.forEach(async function (data) {

// start

console.log('Starting ' + data.faculty);

//const a = await allotslots(data,colid1);



      const lcat1234=await timeslotsn1.find().limit(1)
    .where('colid')
            .equals(colid1)
            .where('slotstatus')
            .equals('Free');

            console.log('Found slot  ' + data.faculty);


            const b=await lcat1234.forEach(async function (data1) {
              console.log(data.faculty + ' - ' + data1._id);
              const lcat1= await timeslotsn1.findByIdAndUpdate( data1._id,{
            
            
           
program:data.program,
semester:data.semester,
section:data.section,
faculty:data.faculty,
facultyid:data.facultyid,
course:data.course,
slotstatus:'Taken'
        });

         const lcat123= await workloadn1.findByIdAndUpdate( data.id,{
type:'Alloted'
        });

            });

            // end

            console.log('Completing ' + data.faculty);



      //console.log(data.link);
      //cbcscount=data.total_attendance;
      
    
    });
            
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
    

  }  
};

const allotslots=async(data,colid1)=> {
    const lcat1234=await timeslotsn1.find().limit(1)
    .where('colid')
            .equals(colid1)
            .where('slotstatus')
            .equals('Free');


            const a= await lcat1234.forEach(async function (data1) {
              console.log(data.faculty + ' - ' + data1._id);
              const lcat1= await timeslotsn1.findByIdAndUpdate( data1._id,{         
                program:data.program,
                semester:data.semester,
                section:data.section,
                faculty:data.faculty,
                facultyid:data.facultyid,
                course:data.course,
                slotstatus:'Taken'
              });

         const lcat123= await workloadn1.findByIdAndUpdate( data.id,{
type:'Alloted'
        });

        console.log('Updated ' + data.faculty);

        });
}

exports.updateworkload= async (req,res) => {
  try{
    const colid1=parseInt(req.query.colid);
    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1 = await workloadn1.updateMany(
      { colid: req.query.colid }, {
      type:'Available'
    });
 
            
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success'  
          });            
  } catch(err) {
    

  }  
};


// Jul 6 2025

exports.getexamprograms= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await examtimetable.distinct("program",{
      "colid" : req.query.colid, "year" : req.query.year, "examcode" : req.query.examcode
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getallocprograms= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await studalloc1.distinct("program",{
      "colid" : req.query.colid, "year" : req.query.year, "examode" : req.query.examode
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getexamdcode= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await examtimetable.distinct("examcode",{
      "colid" : req.query.colid, "year" : req.query.year
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getexamalloc= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await studalloc1.distinct("examode",{
      "colid" : req.query.colid, "year" : req.query.year
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};
  
  
exports.getexambyyrprogsem= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await examtimetable.find({
      "colid" : req.query.colid, "year" : req.query.year, "program" : req.query.program, "examcode": req.query.examcode, "type" : req.query.type
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};
  
  
exports.getexamsemester= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await examtimetable.distinct("type",{
      "colid" : req.query.colid, "year" : req.query.year, "examcode" : req.query.examcode, "program" : req.query.program
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getallocsemester= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await studalloc1.distinct("semester",{
      "colid" : req.query.colid, "year" : req.query.year, "examode" : req.query.examode, "program" : req.query.program
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};
  
// jul 6 1


exports.getexamadmitbyfac= async (req,res) => {
    try{
        
        const lcat1233= await examadmit
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.examadmitdocs= async (req,res) => {
    try{
        
        const lcat1233= await examadmit
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.examadmitlinks= async (req,res) => {
  try{
      
      const lcat1233= await examadmit
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createexamadmitbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await examadmit.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
exam:req.query.exam,
examcode:req.query.examcode,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
coursecode:req.query.coursecode,
semester:req.query.semester,
student:req.query.student,
regno:req.query.regno,
enabled:req.query.enabled,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateexamadmitbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await examadmit.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
exam:req.query.exam,
examcode:req.query.examcode,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
coursecode:req.query.coursecode,
semester:req.query.semester,
student:req.query.student,
regno:req.query.regno,
enabled:req.query.enabled,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateexamadmitcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await examadmit.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteexamadmitbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await examadmit.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getfeesbyfac= async (req,res) => {
    try{
        
        const lcat1233= await fees
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.feesdocs= async (req,res) => {
    try{
        
        const lcat1233= await fees
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.feeslinks= async (req,res) => {
  try{
      
      const lcat1233= await fees
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createfeesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await fees.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            academicyear:req.query.academicyear,
programcode:req.query.programcode,
feegroup:req.query.feegroup,
semester:req.query.semester,
feeeitem:req.query.feeeitem,
feecategory:req.query.feecategory,
classdate:req.query.classdate,
amount:req.query.amount,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatefeesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await fees.findByIdAndUpdate( req.query.id,{
            
            
            academicyear:req.query.academicyear,
programcode:req.query.programcode,
feegroup:req.query.feegroup,
semester:req.query.semester,
feeeitem:req.query.feeeitem,
feecategory:req.query.feecategory,
classdate:req.query.classdate,
amount:req.query.amount,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatefeescomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await fees.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletefeesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await fees.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getledgerstudbyfac= async (req,res) => {
    try{
        
        const lcat1233= await ledgerstud
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.ledgerstuddocs= async (req,res) => {
    try{
        
        const lcat1233= await ledgerstud
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.ledgerstudlinks= async (req,res) => {
  try{
      
      const lcat1233= await ledgerstud
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createledgerstudbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await ledgerstud.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            academicyear:req.query.academicyear,
student:req.query.student,
regno:req.query.regno,
feegroup:req.query.feegroup,
semester:req.query.semester,
feeitem:req.query.feeeitem,
feecategory:req.query.feecategory,
classdate:req.query.classdate,
amount:req.query.amount,
paymode:req.query.paymode,
paydetails:req.query.paydetails,
installment:req.query.installment,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateledgerstudbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await ledgerstud.findByIdAndUpdate( req.query.id,{
            
            
            academicyear:req.query.academicyear,
student:req.query.student,
regno:req.query.regno,
feegroup:req.query.feegroup,
semester:req.query.semester,
feeitem:req.query.feeeitem,
feecategory:req.query.feecategory,
classdate:req.query.classdate,
amount:req.query.amount,
paymode:req.query.paymode,
paydetails:req.query.paydetails,
installment:req.query.installment,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateledgerstudcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await ledgerstud.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteledgerstudbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await ledgerstud.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// Jul 6 stud


exports.getexamadmitstudbyfac= async (req,res) => {
  try{
      
      const lcat1233= await examadmit
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'regno':req.query.regno
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};


exports.getledgerstudstudbyfac= async (req,res) => {
  try{
      
      const lcat1233= await ledgerstud
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'regno':req.query.regno
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};

// jul 9 2025

exports.createnewfaculty = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";

    var someDate = new Date();

    
    
    var numberOfDaysToAdd = 3;
    var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
    var dt2=new Date(result);

    const pub1 = await User.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.email,
      email: req.query.email,
      phone: req.query.phone,
      password: req.query.password,
      role: "Faculty",
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: "NA",
      department: req.query.department,
      category: "NA",
      status: 1,
      lastlogin: someDate,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
  //   console.log(err);
  //   res.status(400).json({
  //    status: "Failed",
  //    message: err,
  //  });
  }
};

exports.getallfaculties= async (req,res) => {
  try{

    const colid1=parseInt(req.query.colid);

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await User.find({"colid" : colid1, "role" : "Faculty"});
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.updatefaculty= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

       // console.log(req.query.email + ',' + req.query.id + ',' + req.query.phone + ',' + req.query.department + ',' + req.query.password + ',' + req.query.name);

//         const lcat1 = await User.updateMany(
//       { email: req.query.email }, {
//         name: req.query.name,
//         email: req.query.email,
//       phone:req.query.phone,
// password:req.query.password,
// department:req.query.department,
// role: "Faculty",
//       regno: "NA",
//       programcode: "NA",
//       admissionyear: "NA",
//       semester: "NA",
//       section: "NA",
//       gender: "NA",
//       department: req.query.department,
//       category: "NA",
//       status: 1,
//     });
    

        const lcat1= await User.findByIdAndUpdate( req.query.id,{      
            name:req.query.name,
email:req.query.email,
phone:req.query.phone,
password:req.query.password,
department:req.query.department,
role: "Faculty",
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: "NA",
      category: "NA",
      status: 1,
status1: 'Submitted',
            comments: 'NA'
        });
         //console.log(lcat1);
        return res.status(200).json({
            status:'Success'
        });

       
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.deletefaculty= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await User.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

//Jul 13 2025

exports.getexamadmitbyyrprogsem= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await examadmit.find({
      "colid" : req.query.colid, "year" : req.query.year, "program" : req.query.program, "examcode": req.query.examcode, "semester" : req.query.semester
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.approveadmitall = async (req, res) => {
  

    const lcat1 = await examadmit.updateMany(
      { colid: req.query.colid,  "year" : req.query.year, "program" : req.query.program, "examcode": req.query.examcode, "semester" : req.query.semester  }, {
      enabled: "Yes"
    });
    return res.status(200).json({
      status: "Success",
    });
  
};

exports.approveadmitregno = async (req, res) => {
  

    const lcat1 = await examadmit.updateMany(
      { colid: req.query.colid,  "year" : req.query.year, "program" : req.query.program, "examcode": req.query.examcode, "semester" : req.query.semester, "regno": req.query.regno  }, {
      enabled: "Yes"
    });
    return res.status(200).json({
      status: "Success",
    });
  
};

exports.approveadmitregnoc = async (req, res) => {
  

    const lcat1 = await examadmit.updateMany(
      { colid: req.query.colid,  "year" : req.query.year, "program" : req.query.program, "examcode": req.query.examcode, "semester" : req.query.semester, "regno": req.query.regno, "coursecode": req.query.coursecode  }, {
      enabled: "Yes"
    });
    return res.status(200).json({
      status: "Success",
    });
  
};

// Jul 14 2025

exports.getadmitprogs= async (req,res) => {
  try{

    // const searchstring=req.query.searchstring;
    // const s1='/.*' + searchstring + '.*/'

    const lcat1233=await examadmit.find({
      "colid" : req.query.colid, "year" : req.query.year, "program" : req.query.program, "examcode": req.query.examcode, "semester" : req.query.semester, "regno": req.query.regno, "enabled": "Yes"
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getphotolink= async (req,res) => {
    try{

        const email=req.query.email;
        //const password=req.query.password;
        User.findOne({ email: email  }, (err, role) => {
            if (err) {
                res.status(201).json({
                    status:'Error'
                });
            }
            if(role) {
               
                const token=jwt.sign({ user: email, colid: String([role.colid]) }, process.env.JWT_SECRET, {
                    expiresIn: process.env.JWT_EXPIRES_IN
                });
                return res.status(200).json({
                    status:'Success',
                    user: String([role.email]),
                    password: String([role.password]),
                    role: String([role.role]),
                    name: String([role.name]),
                    colid: String([role.colid]),
                    regno: String([role.regno]),
                    lastlogin: String([role.lastlogin]),
                    status1: String([role.status1]),
                    section: String([role.section]),
                    semester: String([role.semester]),
                    department: String([role.department]),
                    photo: String([role.photo]),
                    token: token
                });
            } else {
                res.status(201).json({
                    status:'Invalid',
                });
            }
          });
    } catch(err) {
        // res.status(201).json({
        //     status:'Error ' + err,
        // });

    }  
};

// Jul 18 2025

exports.getsalarymedian= async (req,res) => {
    try{
        //const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
       
        
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mplacement.aggregate([
            { 
                $match: {colid: colid1 }
            },
            { 
                $group: {
                    // _id:['$regno','$name'],
                    // _id:['$regno','$name'], 
                    _id: {
                        year: '$year',
                        program: '$program'
                    },
                    // salary_median: {
                    //   $median: {
                    //     input: "$salary",
                    //     method: 'approximate'
                    //   }
                    // }
                    total_attendance: {$avg: '$salary' }
                }
            }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });               
    } catch(err) {
      //  res.status(400).json({
      //       status:'Failed',
      //       message: err
      //   }); 

    }  
};

// Jul 18 2025


exports.getfsr= async (req,res) => {
    try{
        //const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
       
        
        const colid1=parseInt(req.query.colid);
        const lcat1233= await nn26.aggregate([
            { 
                $match: {colid: colid1 }
            },
            { 
                $group: {
                    // _id:['$regno','$name'],
                    // _id:['$regno','$name'], 
                    _id: {
                        year: '$year',
                        level: '$level'
                    },
                    faculties: {$avg: '$faculties' },
                    students: {$avg: '$students' }
                }
            }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
            status:'Success',
            data: {
                classes : lcat1233
            }   
        });               
    } catch(err) {
      //  res.status(400).json({
      //       status:'Failed',
      //       message: err
      //   }); 

    }  
};

  
  // Jul 19 2025

  exports.getmiscorescom= async (req,res) => {
  try{

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const colid1=parseInt(req.query.colid);
    // const lcat1233=await miscores.find({"colid" : colid1});
    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    // const lcat1233=await mtestnewm.find({
    //   "colid" : req.query.colid,
    //   // "testc": /.*Skill.*/
    //   "testc":{'$regex' : searchstring, '$options' : 'i'}
    // });

     const lcat1233= await miscores.aggregate([
            { 
                $match: {colid: colid1, "regno" : {'$regex' : searchstring, '$options' : 'i'} }
            },
            { 
                $group: {
                    // _id:['$regno','$name'],
                    // _id:['$regno','$name'], 
                    _id: {
                        regno: '$regno',
                        test: '$test'
                    },
                    total_attendance: {$sum: '$score' }
                }
            }
        ]);
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};
  
// jul 20 2025


exports.getexammarksallbyfac= async (req,res) => {
    try{
        
        const lcat1233= await exammarksall
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.exammarksalldocs= async (req,res) => {
    try{
        
        const lcat1233= await exammarksall
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.exammarksalllinks= async (req,res) => {
  try{
      
      const lcat1233= await exammarksall
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createexammarksallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await exammarksall.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            exam:req.query.exam,
examcode:req.query.examcode,
academicyear:req.query.academicyear,
student:req.query.student,
regno:req.query.regno,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
coursecode:req.query.coursecode,
iafull:req.query.iafull,
iamarks:req.query.iamarks,
eafull:req.query.eafull,
eamarks:req.query.eamarks,
totalfull:req.query.totalfull,
totalmarks:req.query.totalmarks,
totalp:req.query.totalp,
egrade:req.query.egrade,
semester:req.query.semester,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateexammarksallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await exammarksall.findByIdAndUpdate( req.query.id,{
            
            
            exam:req.query.exam,
examcode:req.query.examcode,
academicyear:req.query.academicyear,
student:req.query.student,
regno:req.query.regno,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
coursecode:req.query.coursecode,
iafull:req.query.iafull,
iamarks:req.query.iamarks,
eafull:req.query.eafull,
eamarks:req.query.eamarks,
totalfull:req.query.totalfull,
totalmarks:req.query.totalmarks,
totalp:req.query.totalp,
egrade:req.query.egrade,
semester:req.query.semester,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateexammarksallcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await exammarksall.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteexammarksallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await exammarksall.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// graph

exports.getexammarksallcount= async (req,res) => {
  try{
  //const user1=req.query.user;
  const colid1=parseInt(req.query.colid);
  const lcat1233= await exammarksall.aggregate([
  { 
  $match: {colid: colid1 }
  },
  { 
  $group: {
  _id:'$academicyear', 
  total_attendance: {$sum : 1}
  }
  }
  ]);
  //console.log(lcat1233);
  res.status(200).json({
  status:'Success',
  data: {
  classes : lcat1233
  }
  }); 
  } catch(err) {
  res.status(400).json({
  status:'Failed',
  message: err
  });
              
  } 
  };  


  exports.getexammarksallsecond= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await exammarksall.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$programcode', 
    total_attendance: {$avg : '$totalp'}
    }
    }
    ]);
    //console.log(lcat1233);
    res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    res.status(400).json({
    status:'Failed',
    message: err
    });
                
    } 
    };  



    exports.getexammarksallcountbyfac= async (req,res) => {
      try{
      const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await exammarksall.aggregate([
      { 
      $match: {colid: colid1, user: user1 }
      },
      { 
      $group: {
      _id:'$academicyear', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
      res.status(400).json({
      status:'Failed',
      message: err
      });
                  
      } 
      };  
    
    
      exports.getexammarksallsecondbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await exammarksall.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$programcode', 
        total_attendance: {$avg : '$totalp'}
        }
        }
        ]);
        //console.log(lcat1233);
        res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        res.status(400).json({
        status:'Failed',
        message: err
        });
                    
        } 
        };  


//

exports.getmexamdcode= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await exammarksall.distinct("examcode",{
      "colid" : req.query.colid, "academicyear" : req.query.year
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmexamprograms= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await exammarksall.distinct("program",{
      "colid" : req.query.colid, "academicyear" : req.query.year, "examcode" : req.query.examcode
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.getmexamsemester= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await exammarksall.distinct("semester",{
      "colid" : req.query.colid, "academicyear" : req.query.year, "examcode" : req.query.examcode, "program" : req.query.program
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.getmexambyyrprogsem= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    const lcat1233=await exammarksall.find({
      "colid" : req.query.colid, "academicyear" : req.query.year, "program" : req.query.program, "examcode": req.query.examcode, "semester" : req.query.semester, "regno" : req.query.regno
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// Aug 3 2025


exports.createnewcompany = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";

    var someDate = new Date();

    
    
    var numberOfDaysToAdd = 3;
    var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
    var dt2=new Date(result);

    const pub1 = await User.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.email,
      email: req.query.email,
      phone: req.query.phone,
      password: req.query.password,
      role: "Company",
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: "NA",
      department: req.query.department,
      category: "NA",
      status: 1,
      lastlogin: someDate,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //console.log(err);
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

exports.getallcompanies= async (req,res) => {
  try{

    const colid1=parseInt(req.query.colid);

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await User.find({"colid" : colid1, "role" : "Company"});
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.updatecompany= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

    

        const lcat1= await User.findByIdAndUpdate( req.query.id,{      
            name:req.query.name,
email:req.query.email,
phone:req.query.phone,
password:req.query.password,
department:req.query.department,
role: "Company",
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: "NA",
      category: "NA",
      status: 1,
status1: 'Submitted',
            comments: 'NA'
        });
         //console.log(lcat1);
        return res.status(200).json({
            status:'Success'
        });

       
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.deletecompany= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await User.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getjobdsbyfac= async (req,res) => {
    try{
        
        // const lcat1233= await jobds
        //     .aggregate([
        //         { $addFields: { 'userId': { $toString: '$_id' }}},
        //         {
        //             $lookup: {
        //               from: 'supportingdocs', 
        //               localField: 'userId', 
        //               foreignField: 'field1', 
        //               as: 'seminars'
        //             }
        //           },
        //           {
        //             $lookup: {
        //               from: 'accrcomments', 
        //               localField: 'userId', 
        //               foreignField: 'field1', 
        //               as: 'allcomments'
        //             }
        //           },
        //           {
        //             $match: {
        //               'colid': parseInt(req.query.colid),
        //               'user':req.query.user
        //             }
        //           }
        //           ]);

            const lcat1234=await jobds.find({'colid': parseInt(req.query.colid)}).sort({lastapplieddate: -1});
            
            //console.log(lcat1234);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1234
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.jobdsdocs= async (req,res) => {
    try{
        
        const lcat1233= await jobds
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.jobdslinks= async (req,res) => {
  try{
      
      const lcat1233= await jobds
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createjobdsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await jobds.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
sector:req.query.sector,
companyname:req.query.companyname,
companyemail:req.query.companyemail,
title:req.query.title,
description:req.query.description,
skills:req.query.skills,
salary:req.query.salary,
lastapplieddate:req.query.lastapplieddate,
joiningdate:req.query.joiningdate,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatejobdsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await jobds.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
sector:req.query.sector,
companyname:req.query.companyname,
companyemail:req.query.companyemail,
title:req.query.title,
description:req.query.description,
skills:req.query.skills,
salary:req.query.salary,
lastapplieddate:req.query.lastapplieddate,
joiningdate:req.query.joiningdate,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatejobdscomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await jobds.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletejobdsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await jobds.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getjobapplicationdsbyfac= async (req,res) => {
    try{
        
        // const lcat1233= await jobapplicationds
        //     .aggregate([
        //         { $addFields: { 'userId': { $toString: '$_id' }}},
        //         {
        //             $lookup: {
        //               from: 'supportingdocs', 
        //               localField: 'userId', 
        //               foreignField: 'field1', 
        //               as: 'seminars'
        //             }
        //           },
        //           {
        //             $lookup: {
        //               from: 'accrcomments', 
        //               localField: 'userId', 
        //               foreignField: 'field1', 
        //               as: 'allcomments'
        //             }
        //           },
        //           {
        //             $match: {
        //               'colid': parseInt(req.query.colid),
        //               'user':req.query.user,
        //               'jobid': ObjectId(req.query.jobid)
        //             }
        //           }
        //           ]);

            const lcat1234=await jobapplicationds.find({'colid': parseInt(req.query.colid), 'jobid': req.query.jobid}).sort({createdAt: -1});
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1234
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.jobapplicationdsdocs= async (req,res) => {
    try{
        
        const lcat1233= await jobapplicationds
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.jobapplicationdslinks= async (req,res) => {
  try{
      
      const lcat1233= await jobapplicationds
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createjobapplicationdsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await jobapplicationds.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
jobid:req.query.jobid,
jobtitle:req.query.jobtitle,
companyname:req.query.companyname,
companyemail:req.query.companyemail,
studentname:req.query.studentname,
studentemail:req.query.studentemail,
studentregno:req.query.studentregno,
studentcv:req.query.studentcv,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatejobapplicationdsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await jobapplicationds.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
jobid:req.query.jobid,
jobtitle:req.query.jobtitle,
companyname:req.query.companyname,
companyemail:req.query.companyemail,
studentname:req.query.studentname,
studentemail:req.query.studentemail,
studentregno:req.query.studentregno,
studentcv:req.query.studentcv,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatejobapplicationdscomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await jobapplicationds.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletejobapplicationdsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await jobapplicationds.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.getjobdscount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await jobds.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$sector', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getjobdssecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await jobds.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$year', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getjobdscountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await jobds.aggregate([
        { 
        $match: {colid: colid1 }
        },
        { 
        $group: {
        _id:'$sector', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getjobdssecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await jobds.aggregate([
          { 
          $match: {colid: colid1 }
          },
          { 
          $group: {
          _id:'$year', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getjobapplicationdscount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await jobapplicationds.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getjobapplicationdssecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await jobapplicationds.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$status', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getjobapplicationdscountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await jobapplicationds.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getjobapplicationdssecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await jobapplicationds.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$status', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
// Aug 4 2025


exports.getsectorsummary = async (req, res) => {
  try {
   
   
    // const date1 = new Date(req.query.date1);
    // const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await jobapplicationds.aggregate([
      {
        $match: {
          colid: colid1
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            year: "$year",
            sector: "$sector",
            status: "$status"
          },
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};
  


exports.getplacestatus = async (req, res) => {
  try {
   
   
    // const date1 = new Date(req.query.date1);
    // const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await jobapplicationds.aggregate([
      {
        $match: {
          colid: colid1
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            year: "$year",
            programcode: "$programcode",
            status: "$status"
          },
          total_attendance: { $sum: 1 },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};


exports.jobapplicationbystatusyr= async (req,res) => {
    try{
        
      

            const lcat1234=await jobapplicationds.find({'colid': parseInt(req.query.colid), 'year': req.query.year, "status": req.query.status}).sort({salary: -1});
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1234
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  // Aug 9

  exports.getallfaculties1= async (req,res) => {
  try{

    const colid1=parseInt(req.query.colid);

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await User.find({"colid" : colid1, "role" : req.query.role});
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.updatefaculty1= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

       // console.log(req.query.email + ',' + req.query.id + ',' + req.query.phone + ',' + req.query.department + ',' + req.query.password + ',' + req.query.name);

//         const lcat1 = await User.updateMany(
//       { email: req.query.email }, {
//         name: req.query.name,
//         email: req.query.email,
//       phone:req.query.phone,
// password:req.query.password,
// department:req.query.department,
// role: "Faculty",
//       regno: "NA",
//       programcode: "NA",
//       admissionyear: "NA",
//       semester: "NA",
//       section: "NA",
//       gender: "NA",
//       department: req.query.department,
//       category: "NA",
//       status: 1,
//     });
    

        const lcat1= await User.findByIdAndUpdate( req.query.id,{      
            name:req.query.name,
email:req.query.email,
phone:req.query.phone,
password:req.query.password,
department:req.query.department,
role: req.query.role,
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: req.query.gender,
      category: req.query.category,
      status: 1,
status1: 'Submitted',
            comments: 'NA'
        });
         //console.log(lcat1);
        return res.status(200).json({
            status:'Success'
        });

       
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};

exports.createnewfaculty1 = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";

    var someDate = new Date();

    
    
    var numberOfDaysToAdd = 3;
    var result = someDate.setDate(someDate.getDate() + numberOfDaysToAdd);
    var dt2=new Date(result);

    const pub1 = await User.create({
      name: req.query.name,
      colid: req.query.colid,
      user: req.query.email,
      email: req.query.email,
      phone: req.query.phone,
      password: req.query.password,
      role: req.query.role,
      regno: "NA",
      programcode: "NA",
      admissionyear: "NA",
      semester: "NA",
      section: "NA",
      gender: req.query.gender,
      department: req.query.department,
      category: req.query.category,
      status: 1,
      lastlogin: someDate,
      status1: "Submitted",
      comments: "NA",
    });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
      status: "Success",
    });
  }  catch (err) {
    //console.log(err);
    //res.status(400).json({
     // status: "Failed",
    //  message: err,
   // });
  }
};

// aug 10


exports.getlessonplannewbyfac= async (req,res) => {
    try{
        
        const lcat1233= await lessonplannew
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.lessonplannewdocs= async (req,res) => {
    try{
        
        const lcat1233= await lessonplannew
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.lessonplannewlinks= async (req,res) => {
  try{
      
      const lcat1233= await lessonplannew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createlessonplannewbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await lessonplannew.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            academicyear:req.query.academicyear,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
coursecode:req.query.coursecode,
semester:req.query.semester,
section:req.query.section,
module:req.query.module,
lessonno:req.query.lessonno,
lesson:req.query.lesson,
lessonplan:req.query.lessonplan,
noofperiod:req.query.noofperiod,
fromdate:req.query.fromdate,
todate:req.query.todate,
actualdate:req.query.actualdate,
topics:req.query.topics,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatelessonplannewbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await lessonplannew.findByIdAndUpdate( req.query.id,{
            
            
            academicyear:req.query.academicyear,
program:req.query.program,
programcode:req.query.programcode,
course:req.query.course,
coursecode:req.query.coursecode,
semester:req.query.semester,
section:req.query.section,
module:req.query.module,
lessonno:req.query.lessonno,
lesson:req.query.lesson,
lessonplan:req.query.lessonplan,
noofperiod:req.query.noofperiod,
fromdate:req.query.fromdate,
todate:req.query.todate,
actualdate:req.query.actualdate,
topics:req.query.topics,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatelessonplannewcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await lessonplannew.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletelessonplannewbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await lessonplannew.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// Aug 11


exports.getserbplanbyfac= async (req,res) => {
    try{
        
        const lcat1233= await serbplan
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.serbplandocs= async (req,res) => {
    try{
        
        const lcat1233= await serbplan
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.serbplanlinks= async (req,res) => {
  try{
      
      const lcat1233= await serbplan
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createserbplanbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await serbplan.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            item:req.query.item,
s1:req.query.s1,
s2:req.query.s2,
s3:req.query.s3,
s4:req.query.s4,
s5:req.query.s5,
s6:req.query.s6,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateserbplanbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await serbplan.findByIdAndUpdate( req.query.id,{
            
            
            item:req.query.item,
s1:req.query.s1,
s2:req.query.s2,
s3:req.query.s3,
s4:req.query.s4,
s5:req.query.s5,
s6:req.query.s6,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateserbplancomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await serbplan.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteserbplanbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await serbplan.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// Aug 22 2025


exports.getmacadcalbyfac= async (req,res) => {
    try{
        
        const lcat1233= await macadcal
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.macadcaldocs= async (req,res) => {
    try{
        
        const lcat1233= await macadcal
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.macadcallinks= async (req,res) => {
  try{
      
      const lcat1233= await macadcal
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmacadcalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await macadcal.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            academicyear:req.query.academicyear,
program:req.query.program,
programcode:req.query.programcode,
ativity:req.query.ativity,
description:req.query.description,
activitydate:req.query.activitydate,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemacadcalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await macadcal.findByIdAndUpdate( req.query.id,{
            
            
            academicyear:req.query.academicyear,
program:req.query.program,
programcode:req.query.programcode,
ativity:req.query.ativity,
description:req.query.description,
activitydate:req.query.activitydate,
type:req.query.type,
level:req.query.level,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemacadcalcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await macadcal.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemacadcalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await macadcal.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getmfeescolbyfac= async (req,res) => {
    try{
        
        const lcat1233= await mfeescol
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mfeescoldocs= async (req,res) => {
    try{
        
        const lcat1233= await mfeescol
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mfeescollinks= async (req,res) => {
  try{
      
      const lcat1233= await mfeescol
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmfeescolbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mfeescol.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
feegroup:req.query.feegroup,
feeitem:req.query.feeitem,
semester:req.query.semester,
feecategory:req.query.feecategory,
paydate:req.query.paydate,
amount:req.query.amount,
paymode:req.query.paymode,
payref:req.query.payref,
paystatus:req.query.paystatus,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemfeescolbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mfeescol.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
programcode:req.query.programcode,
student:req.query.student,
regno:req.query.regno,
feegroup:req.query.feegroup,
feeitem:req.query.feeitem,
semester:req.query.semester,
feecategory:req.query.feecategory,
paydate:req.query.paydate,
amount:req.query.amount,
paymode:req.query.paymode,
payref:req.query.payref,
paystatus:req.query.paystatus,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemfeescolcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mfeescol.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemfeescolbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mfeescol.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


// Aug 24


exports.mfeescolbydate= async (req,res) => {

    try{
     
        const lcat1233=await mfeescol.find({
           "colid" : req.query.colid,
           "paydate" : { $gte: new Date(req.query.fromdate), $lte: new Date(req.query.todate) }
        });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          }); 
 
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};



exports.mfeescolbydateagr= async (req,res) => {

    try{

      const lcat1233=await mfeescol.aggregate([
        { 
                $match: {colid: parseInt(req.query.colid), 
                   paydate : { $gte: new Date(req.query.fromdate), $lte: new Date(req.query.todate) }
                 }
            },
  {
    $group: {
      _id: { 
         $dateToString: { format: "%Y-%m-%d", date: "$paydate" }
        //paydate: '$paydate'
      },
      totalAmount: { $sum: "$amount" },
      count: { $sum: 1 } // optional: number of records per date
    }
  },
  {
    $sort: { _id: 1 } // sort by date ascending
  }
]);
     
        // const lcat12333=await mfeescol.find({
        //    "colid" : req.query.colid,
        //    "paydate" : { $gte: new Date(req.query.fromdate), $lte: new Date(req.query.todate) }
        // });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          }); 
 
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.logindetails= async (req,res) => {
    try{

        const email=req.query.email;
        //const password=req.query.password;
        User.findOne({ email: email  }, (err, role) => {
            if (err) {
                res.status(201).json({
                    status:'Error'
                });
            }
            if(role) {
               
                const token=jwt.sign({ user: email, colid: String([role.colid]) }, process.env.JWT_SECRET, {
                    expiresIn: process.env.JWT_EXPIRES_IN
                });
                return res.status(200).json({
                    status:'Success',
                    user: String([role.email]),
                    password: String([role.password]),
                    role: String([role.role]),
                    name: String([role.name]),
                    colid: String([role.colid]),
                    regno: String([role.regno]),
                    lastlogin: String([role.lastlogin]),
                    status1: String([role.status1]),
                    section: String([role.section]),
                    semester: String([role.semester]),
                    department: String([role.department]),
                    programcode: String([role.programcode]),
                    admissionyear: String([role.admissionyear]),
                    category: String([role.category]),
                    token: token
                });
            } else {
                res.status(201).json({
                    status:'Invalid',
                });
            }
          });
    } catch(err) {
        // res.status(201).json({
        //     status:'Error ' + err,
        // });

    }  
};


exports.getfeesbycatyrp= async (req,res) => {
  try{
      
      
    const lcat1233=await fees.find({
      "colid" : parseInt(req.query.colid),
      "programcode" : req.query.programcode,
      "feecategory" : req.query.feecategory,
      "academicyear" : req.query.year,
    });
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

// 8 sep 2025


exports.getmjournal1byfac= async (req,res) => {
    try{
        
        const lcat1233= await mjournal1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mjournal1docs= async (req,res) => {
    try{
        
        const lcat1233= await mjournal1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mjournal1links= async (req,res) => {
  try{
      
      const lcat1233= await mjournal1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmjournal1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mjournal1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
transaction:req.query.transaction,
transactionref:req.query.transactionref,
subledger:req.query.subledger,
cogs:req.query.cogs,
activitydate:req.query.activitydate,
amount:req.query.amount,
type:req.query.type,
student:req.query.student,
regno:req.query.regno,
empid:req.query.empid,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemjournal1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mjournal1.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
transaction:req.query.transaction,
transactionref:req.query.transactionref,
subledger:req.query.subledger,
cogs:req.query.cogs,
activitydate:req.query.activitydate,
amount:req.query.amount,
type:req.query.type,
student:req.query.student,
regno:req.query.regno,
empid:req.query.empid,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemjournal1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mjournal1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemjournal1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mjournal1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getmtrialbalance1byfac= async (req,res) => {
    try{
        
        const lcat1233= await mtrialbalance1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mtrialbalance1docs= async (req,res) => {
    try{
        
        const lcat1233= await mtrialbalance1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mtrialbalance1links= async (req,res) => {
  try{
      
      const lcat1233= await mtrialbalance1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmtrialbalance1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mtrialbalance1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemtrialbalance1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mtrialbalance1.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemtrialbalance1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mtrialbalance1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemtrialbalance1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mtrialbalance1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.getmjournal1count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mjournal1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getmjournal1second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mjournal1.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getmjournal1countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mjournal1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getmjournal1secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await mjournal1.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$acctype', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getmtrialbalance1count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtrialbalance1.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getmtrialbalance1second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtrialbalance1.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getmtrialbalance1countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtrialbalance1.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getmtrialbalance1secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await mtrialbalance1.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$acctype', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  // 9 sep 2025

  exports.populatetrialb = async (req, res) => {
  try {
   
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);

    const user1 = req.query.user;
    const name1 = req.query.name;

    //console.log(name1 + '  ' + user1);

    //const year1 = parseInt(req.query.year);
   

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await mjournal2.aggregate([
      {
        $match: {
          colid: colid1,
          year: req.query.year,
          activitydate: {
            $gte: date1,
            $lte: date2,
          },
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            accgroup: "$accgroup",
            account: "$account",
            acctype: "$acctype",
            cogs: "$cogs"
          },
          totalamount: { $sum: "$amount" },
          debit: { $sum: "$debit" },
          credit: { $sum: "$credit" },
        },
      },
    ]);

    //console.log(lcat1233);

    const result = await mtrialbalance2.deleteMany({ colid: colid1, year: req.query.year });

    //console.log(result);

    lcat1233.forEach(async function(data){
      const debit1=parseInt(data.debit) || 0;
      const credit1=parseInt(data.credit) || 0;
      var balance1=0;
      var debit2=0;
      var credit2=0;
      if(debit1 > credit1) {
        balance1=debit1 - credit1;
        debit2=balance1;
      } else {
        balance1=credit1 - debit1;
        credit2=balance1;
      }

       const pub1= await mtrialbalance2.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:data._id.accgroup,
            account:data._id.account,
            acctype:data._id.acctype,
            cogs:data._id.cogs,
            amount:balance1,
            debit:debit2,
            credit:credit2,
            status1: 'Submitted',
            comments: 'NA'
        });
      
    //console.log(data.link);
    //moucount=data.total_attendance;
   
    })



   
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};


// 10 sep 2025


exports.getmjournal2byfac= async (req,res) => {
    try{
        
        const lcat1233= await mjournal2
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mjournal2docs= async (req,res) => {
    try{
        
        const lcat1233= await mjournal2
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mjournal2links= async (req,res) => {
  try{
      
      const lcat1233= await mjournal2
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmjournal2byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mjournal2.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
transaction:req.query.transaction,
transactionref:req.query.transactionref,
subledger:req.query.subledger,
cogs:req.query.cogs,
activitydate:req.query.activitydate,
amount:req.query.amount,
credit:req.query.credit,
debit:req.query.debit,
type:req.query.type,
student:req.query.student,
regno:req.query.regno,
empid:req.query.empid,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemjournal2byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mjournal2.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
transaction:req.query.transaction,
transactionref:req.query.transactionref,
subledger:req.query.subledger,
cogs:req.query.cogs,
activitydate:req.query.activitydate,
amount:req.query.amount,
credit:req.query.credit,
debit:req.query.debit,
type:req.query.type,
student:req.query.student,
regno:req.query.regno,
empid:req.query.empid,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemjournal2comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mjournal2.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemjournal2byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mjournal2.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getmtrialbalance2byfac= async (req,res) => {
    try{
        
        const lcat1233= await mtrialbalance2
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mtrialbalance2docs= async (req,res) => {
    try{
        
        const lcat1233= await mtrialbalance2
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mtrialbalance2links= async (req,res) => {
  try{
      
      const lcat1233= await mtrialbalance2
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmtrialbalance2byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mtrialbalance2.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemtrialbalance2byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mtrialbalance2.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemtrialbalance2comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mtrialbalance2.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemtrialbalance2byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mtrialbalance2.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.getmtrialbalance2count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtrialbalance2.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getmtrialbalance2second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtrialbalance2.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getmtrialbalance2countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtrialbalance2.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getmtrialbalance2secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await mtrialbalance2.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$acctype', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getmjournal2count= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mjournal2.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getmjournal2second= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mjournal2.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getmjournal2countbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mjournal2.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getmjournal2secondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await mjournal2.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$acctype', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
exports.getmtradingaccountbyfac= async (req,res) => {
    try{
        
        const lcat1233= await mtradingaccount
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mtradingaccountdocs= async (req,res) => {
    try{
        
        const lcat1233= await mtradingaccount
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mtradingaccountlinks= async (req,res) => {
  try{
      
      const lcat1233= await mtradingaccount
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmtradingaccountbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mtradingaccount.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemtradingaccountbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mtradingaccount.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemtradingaccountcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mtradingaccount.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemtradingaccountbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mtradingaccount.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getmplaccountbyfac= async (req,res) => {
    try{
        
        const lcat1233= await mplaccount
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mplaccountdocs= async (req,res) => {
    try{
        
        const lcat1233= await mplaccount
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mplaccountlinks= async (req,res) => {
  try{
      
      const lcat1233= await mplaccount
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmplaccountbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mplaccount.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemplaccountbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mplaccount.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemplaccountcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mplaccount.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemplaccountbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mplaccount.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getmbalancesheetbyfac= async (req,res) => {
    try{
        
        const lcat1233= await mbalancesheet
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.mbalancesheetdocs= async (req,res) => {
    try{
        
        const lcat1233= await mbalancesheet
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.mbalancesheetlinks= async (req,res) => {
  try{
      
      const lcat1233= await mbalancesheet
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.creatembalancesheetbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await mbalancesheet.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatembalancesheetbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await mbalancesheet.findByIdAndUpdate( req.query.id,{
            
            
            year:req.query.year,
accgroup:req.query.accgroup,
account:req.query.account,
acctype:req.query.acctype,
cogs:req.query.cogs,
amount:req.query.amount,
debit:req.query.debit,
credit:req.query.credit,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatembalancesheetcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await mbalancesheet.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletembalancesheetbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await mbalancesheet.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

exports.getmtradingaccountcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mtradingaccount.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getmtradingaccountsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mtradingaccount.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getmtradingaccountcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mtradingaccount.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getmtradingaccountsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await mtradingaccount.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$acctype', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getmplaccountcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mplaccount.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getmplaccountsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mplaccount.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getmplaccountcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mplaccount.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getmplaccountsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await mplaccount.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$acctype', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  exports.getmbalancesheetcount= async (req,res) => {
    try{
    //const user1=req.query.user;
    const colid1=parseInt(req.query.colid);
    const lcat1233= await mbalancesheet.aggregate([
    { 
    $match: {colid: colid1 }
    },
    { 
    $group: {
    _id:'$year', 
    total_attendance: {$sum : 1}
    }
    }
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
    status:'Success',
    data: {
    classes : lcat1233
    }
    }); 
    } catch(err) {
    // res.status(400).json({
    // status:'Failed',
    // message: err
    // });
                
    } 
    };  
  
  
    exports.getmbalancesheetsecond= async (req,res) => {
      try{
      //const user1=req.query.user;
      const colid1=parseInt(req.query.colid);
      const lcat1233= await mbalancesheet.aggregate([
      { 
      $match: {colid: colid1 }
      },
      { 
      $group: {
      _id:'$acctype', 
      total_attendance: {$sum : 1}
      }
      }
      ]);
      //console.log(lcat1233);
      return res.status(200).json({
      status:'Success',
      data: {
      classes : lcat1233
      }
      }); 
      } catch(err) {
    //   res.status(400).json({
    //   status:'Failed',
    //   message: err
    //   });
                  
      } 
      };  
  
  
  
      exports.getmbalancesheetcountbyfac= async (req,res) => {
        try{
        const user1=req.query.user;
        const colid1=parseInt(req.query.colid);
        const lcat1233= await mbalancesheet.aggregate([
        { 
        $match: {colid: colid1, user: user1 }
        },
        { 
        $group: {
        _id:'$year', 
        total_attendance: {$sum : 1}
        }
        }
        ]);
        //console.log(lcat1233);
        return res.status(200).json({
        status:'Success',
        data: {
        classes : lcat1233
        }
        }); 
        } catch(err) {
        // res.status(400).json({
        // status:'Failed',
        // message: err
        // });
                    
        } 
        };  
      
      
        exports.getmbalancesheetsecondbyfac= async (req,res) => {
          try{
          const user1=req.query.user;
          const colid1=parseInt(req.query.colid);
          const lcat1233= await mbalancesheet.aggregate([
          { 
          $match: {colid: colid1, user: user1 }
          },
          { 
          $group: {
          _id:'$acctype', 
          total_attendance: {$sum : 1}
          }
          }
          ]);
          //console.log(lcat1233);
          return res.status(200).json({
          status:'Success',
          data: {
          classes : lcat1233
          }
          }); 
          } catch(err) {
        //   res.status(400).json({
        //   status:'Failed',
        //   message: err
        //   });
                      
          } 
          };  
  
  
  
  
  // 12 sep 2025


  exports.populatetradingaccount = async (req, res) => {
  try {
   
    // const date1 = new Date(req.query.date1);
    // const date2 = new Date(req.query.date2);

    const user1 = req.query.user;
    const name1 = req.query.name;

    //console.log(name1 + '  ' + user1);

    //const year1 = parseInt(req.query.year);
   

    const colid1 = parseInt(req.query.colid);

    const lcat1233 = await mtrialbalance2.find(
      { colid: colid1, year: req.query.year, cogs: 'Yes' }
    );

   

    //console.log(lcat1233);

    const result = await mtradingaccount.deleteMany({ colid: colid1, year: req.query.year });
    const result1 = await mplaccount.deleteMany({ colid: colid1, year: req.query.year });
    const result2 = await mbalancesheet.deleteMany({ colid: colid1, year: req.query.year });

    //console.log(result);

    let totaldebit=0;

    lcat1233.forEach(async function(data){
      const debit1=parseInt(data.debit) || 0;
      totaldebit=totaldebit+debit1;
      

       const pub1= await mtradingaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:data.accgroup,
            account:data.account,
            acctype:data.acctype,
            cogs:data.cogs,
            amount:data.amount,
            debit:debit1,
            credit:data.credit,
            status1: 'Submitted',
            comments: 'NA'
        });
      
    //console.log(data.link);
    //moucount=data.total_attendance;
   
    })

    const lcat1234 = await mtrialbalance2.find(
      { colid: colid1, year: req.query.year, acctype: 'Income' }
    );

    let totalcredit=0;

    lcat1234.forEach(async function(data){
      const credit1=parseInt(data.credit) || 0;
      totalcredit=totalcredit+credit1;
      

       const pub1= await mtradingaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:data.accgroup,
            account:data.account,
            acctype:data.acctype,
            cogs:data.cogs,
            amount:data.amount,
            debit:data.debit,
            credit:credit1,
            status1: 'Submitted',
            comments: 'NA'
        });
      
    //console.log(data.link);
    //moucount=data.total_attendance;
   
    })

    //console.log(totalcredit + '   ' + totaldebit);

    let balance=0;
    if(totaldebit>totalcredit) {
      balance=totaldebit-totalcredit;
      const pub1= await mtradingaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Gross Profit (Loss)',
            account:'Gross Profit (Loss)',
            acctype:'Gross Profit',
            cogs:'No',
            amount:balance,
            debit:0,
            credit:balance,
            status1: 'Submitted',
            comments: 'NA'
        });
        const pub2= await mplaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Gross Profit (Loss)',
            account:'Gross Profit (Loss)',
            acctype:'Gross Profit',
            cogs:'No',
            amount:balance,
            debit:balance,
            credit:0,
            status1: 'Submitted',
            comments: 'NA'
        });

    } else {
      balance=totalcredit-totaldebit;
      const pub1= await mtradingaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Gross Profit',
            account:'Gross Profit',
            acctype:'Gross Profit',
            cogs:'No',
            amount:balance,
            debit:balance,
            credit:0,
            status1: 'Submitted',
            comments: 'NA'
        });
        const pub2= await mplaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Gross Profit',
            account:'Gross Profit',
            acctype:'Gross Profit',
            cogs:'No',
            amount:balance,
            debit:0,
            credit:balance,
            status1: 'Submitted',
            comments: 'NA'
        });

    }

    
      const lcat1235 = await mtrialbalance2.find(
      { colid: colid1, year: req.query.year, acctype: 'Expenditure',cogs: 'No' }
    );

    let totaliexpense=0;

    lcat1235.forEach(async function(data){
      const debit2=parseInt(data.debit) || 0;
      totaliexpense=totaliexpense+debit2;
      

       const pub1= await mplaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:data.accgroup,
            account:data.account,
            acctype:data.acctype,
            cogs:data.cogs,
            amount:data.amount,
            debit:data.debit,
            credit:data.credit,
            status1: 'Submitted',
            comments: 'NA'
        });
      
    //console.log(data.link);
    //moucount=data.total_attendance;
   
    })

    //console.log(balance + '   ' + totaliexpense);

    let netprofit=0;
    if(balance>totaliexpense) {
      netprofit=balance-totaliexpense;
      const pub1= await mplaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Net Profit',
            account:'Net Profit',
            acctype:'Net Profit',
            cogs:'No',
            amount:netprofit,
            debit:netprofit,
            credit:0,
            status1: 'Submitted',
            comments: 'NA'
        }); 
        const pub12= await mbalancesheet.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Net Profit',
            account:'Net Profit',
            acctype:'Net Profit',
            cogs:'No',
            amount:netprofit,
            debit:0,
            credit:netprofit,
            status1: 'Submitted',
            comments: 'NA'
        });
      } else {
        netprofit=totaliexpense-balance;
        const pub1= await mplaccount.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Net Loss',
            account:'Net Loss',
            acctype:'Net Loss',
            cogs:'No',
            amount:netprofit,
            debit:0,
            credit:netprofit,
            status1: 'Submitted',
            comments: 'NA'
        });
        const pub12= await mbalancesheet.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:'Net Loss',
            account:'Net Loss',
            acctype:'Net Loss',
            cogs:'No',
            amount:netprofit,
            debit:netprofit,
            credit:0,
            status1: 'Submitted',
            comments: 'NA'
        });
        
      }

     const lcat1236 = await mtrialbalance2.find(
      { colid: colid1, year: req.query.year, acctype: 'Asset' }
    );

   let totalasset=0;

    lcat1236.forEach(async function(data){
      const debit2=parseInt(data.debit) || 0;
      totalasset=totalasset+debit2;
      

       const pub1= await mbalancesheet.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:data.accgroup,
            account:data.account,
            acctype:data.acctype,
            cogs:data.cogs,
            amount:data.amount,
            debit:data.debit,
            credit:data.credit,
            status1: 'Submitted',
            comments: 'NA'
        });
      
    //console.log(data.link);
    //moucount=data.total_attendance;
   
    })


    const lcat124 = await mtrialbalance2.find(
      { colid: colid1, year: req.query.year, acctype: 'Liability' }
    );

    let totalliabilities=0;

   

    lcat124.forEach(async function(data){
      const credit2=parseInt(data.credit) || 0;
      totalliabilities=totalliabilities+credit2;
      

       const pub1= await mbalancesheet.create({
            name: name1,
            colid: req.query.colid,
            user: user1,
            year:req.query.year,
            accgroup:data.accgroup,
            account:data.account,
            acctype:data.acctype,
            cogs:data.cogs,
            amount:data.amount,
            debit:data.debit,
            credit:data.credit,
            status1: 'Submitted',
            comments: 'NA'
        });
      
    //console.log(data.link);
    //moucount=data.total_attendance;
   
    })

    //console.log(totalasset + '   ' + totalliabilities);

    



   
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};
  
// Oct 13 2025

exports.getattbystud = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: {
          colid: colid1,
          regno: req.query.regno,
          classdate: {
            $gte: date1,
            $lte: date2,
          },
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            coursecode: "$coursecode",
            semester: "$semester",
            programcode: "$programcode",
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $avg: "$att" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};
  


exports.getattbystudsem = async (req, res) => {
  try {
    //const token=req.query.token;
    //console.log(token);
    let jwtuser = "";
    let jwtcolid = "";
    const date1 = new Date(req.query.date1);
    const date2 = new Date(req.query.date2);
    //date2.setDate(date1.getDate() + 1);
    //date1.setDate(date1.getDate() - 180);

    const colid1 = parseInt(req.query.colid);
    const lcat1233 = await attendancenew.aggregate([
      {
        $match: {
          colid: colid1,
          regno: req.query.regno,
          semester: req.query.semester,
          classdate: {
            $gte: date1,
            $lte: date2,
          },
        },
      },
      {
        $group: {
          // _id:['$regno','$name'],
          // _id:['$regno','$name'],
          _id: {
            coursecode: "$coursecode",
            semester: "$semester",
            programcode: "$programcode",
            student: "$student",
            regno: "$regno",
          },
          total_attendance: { $avg: "$att" },
        },
      },
    ]);
    //console.log(lcat1233);
    return res.status(200).json({
      status: "Success",
      data: {
        classes: lcat1233,
      },
    });
  } catch (err) {
    //   res.status(400).json({
    //    status:'Failed',
    //     message: err
    //  });
  }
};
  
// oct 29 2025


exports.getstudalloc1byfac= async (req,res) => {
    try{
        
        const lcat1233= await studalloc1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };


  exports.getstudalloc1byfac1= async (req,res) => {
    try{
        
        const lcat1233= await studalloc1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'year':req.query.year,
                      'semester':req.query.semester,
                      'program':req.query.program,
                      'examode':req.query.examode
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };




exports.getstudalloc1bypse= async (req,res) => {
    try{

      const lcat1233= await studalloc1.find({ 
        colid: parseInt(req.query.colid),
        semester: req.query.semester,
        program: req.query.program,
        year: req.query.year,
        examode: req.query.examode
      });
    
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.studalloc1docs= async (req,res) => {
    try{
        
        const lcat1233= await studalloc1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.studalloc1links= async (req,res) => {
  try{
      
      const lcat1233= await studalloc1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createstudalloc1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await studalloc1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            student:req.query.student,
regno:req.query.regno,
examode:req.query.examode,
program:req.query.program,
semester:req.query.semester,
course:req.query.course,
courseCode:req.query.coursecode,
link:req.query.link,
status:req.query.status,
year:req.query.year,
component:req.query.component,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatestudalloc1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await studalloc1.findByIdAndUpdate( req.query.id,{
            
            
            student:req.query.student,
regno:req.query.regno,
examode:req.query.examode,
program:req.query.program,
semester:req.query.semester,
course:req.query.course,
courseCode:req.query.coursecode,
component: req.query.component,
link:req.query.link,
status:req.query.status,
year:req.query.year,
component:req.query.component,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatestudalloc1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await studalloc1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletestudalloc1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await studalloc1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// oct 30 2025


exports.getPatientbyfac= async (req,res) => {
    try{
        
        const lcat1233= await Patient
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.Patientdocs= async (req,res) => {
    try{
        
        const lcat1233= await Patient
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.Patientlinks= async (req,res) => {
  try{
      
      const lcat1233= await Patient
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createPatientbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await Patient.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            mrNumber:req.query.mrNumber,
patient:req.query.patient,
age:req.query.age,
gender:req.query.gender,
phone:req.query.phone,
email:req.query.email,
address:req.query.address,
bloodGroup:req.query.bloodGroup,
username:req.query.username,
password:req.query.password,
dob:req.query.dob,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatePatientbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await Patient.findByIdAndUpdate( req.query.id,{
            
            
            mrNumber:req.query.mrNumber,
patient:req.query.patient,
age:req.query.age,
gender:req.query.gender,
phone:req.query.phone,
email:req.query.email,
address:req.query.address,
bloodGroup:req.query.bloodGroup,
username:req.query.username,
password:req.query.password,
dob:req.query.dob,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatePatientcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await Patient.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletePatientbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await Patient.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.geticubyfac= async (req,res) => {
    try{
        
        const lcat1233= await icu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.icudocs= async (req,res) => {
    try{
        
        const lcat1233= await icu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.iculinks= async (req,res) => {
  try{
      
      const lcat1233= await icu
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await icu.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await icu.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateicucomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await icu.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await icu.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getmicubyfac= async (req,res) => {
    try{
        
        const lcat1233= await micu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.micudocs= async (req,res) => {
    try{
        
        const lcat1233= await micu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.miculinks= async (req,res) => {
  try{
      
      const lcat1233= await micu
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await micu.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await micu.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemicucomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await micu.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await micu.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnicubyfac= async (req,res) => {
    try{
        
        const lcat1233= await nicu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nicudocs= async (req,res) => {
    try{
        
        const lcat1233= await nicu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.niculinks= async (req,res) => {
  try{
      
      const lcat1233= await nicu
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nicu.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nicu.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenicucomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nicu.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenicubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nicu.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.gethdubyfac= async (req,res) => {
    try{
        
        const lcat1233= await hdu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.hdudocs= async (req,res) => {
    try{
        
        const lcat1233= await hdu
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.hdulinks= async (req,res) => {
  try{
      
      const lcat1233= await hdu
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createhdubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await hdu.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatehdubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await hdu.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatehducomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await hdu.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletehdubyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await hdu.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwardbyfac= async (req,res) => {
    try{
        
        const lcat1233= await ward
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.warddocs= async (req,res) => {
    try{
        
        const lcat1233= await ward
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wardlinks= async (req,res) => {
  try{
      
      const lcat1233= await ward
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwardbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await ward.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewardbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await ward.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewardcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await ward.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewardbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await ward.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getemergencybyfac= async (req,res) => {
    try{
        
        const lcat1233= await emergency
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.emergencydocs= async (req,res) => {
    try{
        
        const lcat1233= await emergency
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.emergencylinks= async (req,res) => {
  try{
      
      const lcat1233= await emergency
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createemergencybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await emergency.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateemergencybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await emergency.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateemergencycomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await emergency.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteemergencybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await emergency.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnemergencybyfac= async (req,res) => {
    try{
        
        const lcat1233= await nemergency
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nemergencydocs= async (req,res) => {
    try{
        
        const lcat1233= await nemergency
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nemergencylinks= async (req,res) => {
  try{
      
      const lcat1233= await nemergency
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnemergencybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nemergency.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenemergencybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nemergency.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
code:req.query.code,
location:req.query.location,
capacity:req.query.capacity,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenemergencycomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nemergency.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenemergencybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nemergency.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpadmissionbyfac= async (req,res) => {
    try{
        
        const lcat1233= await padmission
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.padmissiondocs= async (req,res) => {
    try{
        
        const lcat1233= await padmission
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.padmissionlinks= async (req,res) => {
  try{
      
      const lcat1233= await padmission
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpadmissionbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await padmission.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admdate:req.query.admdate,
admtime:req.query.admtime,
admstatus:req.query.admstatus,
doctor:req.query.doctor,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepadmissionbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await padmission.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admdate:req.query.admdate,
admtime:req.query.admtime,
admstatus:req.query.admstatus,
doctor:req.query.doctor,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepadmissioncomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await padmission.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepadmissionbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await padmission.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.geticubedbyfac= async (req,res) => {
    try{
        
        const lcat1233= await icubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.icubeddocs= async (req,res) => {
    try{
        
        const lcat1233= await icubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.icubedlinks= async (req,res) => {
  try{
      
      const lcat1233= await icubed
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await icubed.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await icubed.findByIdAndUpdate( req.query.id,{
            
            
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateicubedcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await icubed.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await icubed.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getmicubedbyfac= async (req,res) => {
    try{
        
        const lcat1233= await micubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.micubeddocs= async (req,res) => {
    try{
        
        const lcat1233= await micubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.micubedlinks= async (req,res) => {
  try{
      
      const lcat1233= await micubed
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createmicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await micubed.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatemicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await micubed.findByIdAndUpdate( req.query.id,{
            
            
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatemicubedcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await micubed.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletemicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await micubed.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnicubedbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nicubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nicubeddocs= async (req,res) => {
    try{
        
        const lcat1233= await nicubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nicubedlinks= async (req,res) => {
  try{
      
      const lcat1233= await nicubed
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nicubed.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nicubed.findByIdAndUpdate( req.query.id,{
            
            
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenicubedcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nicubed.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenicubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nicubed.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.gethdubedbyfac= async (req,res) => {
    try{
        
        const lcat1233= await hdubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.hdubeddocs= async (req,res) => {
    try{
        
        const lcat1233= await hdubed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.hdubedlinks= async (req,res) => {
  try{
      
      const lcat1233= await hdubed
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createhdubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await hdubed.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatehdubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await hdubed.findByIdAndUpdate( req.query.id,{
            
            
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatehdubedcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await hdubed.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletehdubedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await hdubed.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwardbedbyfac= async (req,res) => {
    try{
        
        const lcat1233= await wardbed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wardbeddocs= async (req,res) => {
    try{
        
        const lcat1233= await wardbed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wardbedlinks= async (req,res) => {
  try{
      
      const lcat1233= await wardbed
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwardbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wardbed.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewardbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wardbed.findByIdAndUpdate( req.query.id,{
            
            
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewardbedcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wardbed.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewardbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wardbed.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.geterbedbyfac= async (req,res) => {
    try{
        
        const lcat1233= await erbed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.erbeddocs= async (req,res) => {
    try{
        
        const lcat1233= await erbed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.erbedlinks= async (req,res) => {
  try{
      
      const lcat1233= await erbed
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createerbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await erbed.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateerbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await erbed.findByIdAndUpdate( req.query.id,{
            
            
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateerbedcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await erbed.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteerbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await erbed.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getnerbedbyfac= async (req,res) => {
    try{
        
        const lcat1233= await nerbed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.nerbeddocs= async (req,res) => {
    try{
        
        const lcat1233= await nerbed
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.nerbedlinks= async (req,res) => {
  try{
      
      const lcat1233= await nerbed
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createnerbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await nerbed.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatenerbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await nerbed.findByIdAndUpdate( req.query.id,{
            
            
            hcode:req.query.hcode,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
amount:req.query.amount,
patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
type:req.query.type,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatenerbedcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await nerbed.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletenerbedbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await nerbed.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpadmhistorybyfac= async (req,res) => {
    try{
        
        const lcat1233= await padmhistory
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.padmhistorydocs= async (req,res) => {
    try{
        
        const lcat1233= await padmhistory
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.padmhistorylinks= async (req,res) => {
  try{
      
      const lcat1233= await padmhistory
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpadmhistorybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await padmhistory.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
activity:req.query.activity,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
activitydate:req.query.activitydate,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepadmhistorybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await padmhistory.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
activity:req.query.activity,
bedno:req.query.bedno,
bedtype:req.query.bedtype,
activitydate:req.query.activitydate,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepadmhistorycomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await padmhistory.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepadmhistorybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await padmhistory.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpbillingbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pbilling
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pbillingdocs= async (req,res) => {
    try{
        
        const lcat1233= await pbilling
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pbillinglinks= async (req,res) => {
  try{
      
      const lcat1233= await pbilling
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpbillingbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pbilling.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
billdate:req.query.billdate,
description:req.query.description,
amount:req.query.amount,
payref:req.query.payref,
paystatus:req.query.paystatus,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepbillingbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pbilling.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
billdate:req.query.billdate,
description:req.query.description,
amount:req.query.amount,
payref:req.query.payref,
paystatus:req.query.paystatus,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepbillingcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pbilling.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepbillingbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pbilling.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// oct 30 2025 1


exports.getpillnessbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pillness
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pillnessdocs= async (req,res) => {
    try{
        
        const lcat1233= await pillness
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pillnesslinks= async (req,res) => {
  try{
      
      const lcat1233= await pillness
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpillnessbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pillness.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
illness:req.query.illness,
duration:req.query.duration,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepillnessbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pillness.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
illness:req.query.illness,
duration:req.query.duration,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepillnesscomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pillness.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepillnessbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pillness.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpsurgerybyfac= async (req,res) => {
    try{
        
        const lcat1233= await psurgery
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.psurgerydocs= async (req,res) => {
    try{
        
        const lcat1233= await psurgery
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.psurgerylinks= async (req,res) => {
  try{
      
      const lcat1233= await psurgery
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpsurgerybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await psurgery.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
surgery:req.query.surgery,
doctor:req.query.doctor,
doctorid:req.query.doctorid,
sdate:req.query.sdate,
sstatus:req.query.sstatus,
doccmments:req.query.doccmments,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepsurgerybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await psurgery.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
surgery:req.query.surgery,
doctor:req.query.doctor,
doctorid:req.query.doctorid,
sdate:req.query.sdate,
sstatus:req.query.sstatus,
doccmments:req.query.doccmments,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepsurgerycomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await psurgery.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepsurgerybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await psurgery.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpfamilybyfac= async (req,res) => {
    try{
        
        const lcat1233= await pfamily
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pfamilydocs= async (req,res) => {
    try{
        
        const lcat1233= await pfamily
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pfamilylinks= async (req,res) => {
  try{
      
      const lcat1233= await pfamily
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpfamilybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pfamily.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
family:req.query.family,
illness:req.query.illness,
duration:req.query.duration,
relation:req.query.relation,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepfamilybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pfamily.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
family:req.query.family,
illness:req.query.illness,
duration:req.query.duration,
relation:req.query.relation,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepfamilycomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pfamily.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepfamilybyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pfamily.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpallergiesbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pallergies
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pallergiesdocs= async (req,res) => {
    try{
        
        const lcat1233= await pallergies
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pallergieslinks= async (req,res) => {
  try{
      
      const lcat1233= await pallergies
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpallergiesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pallergies.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
allergy:req.query.allergy,
duration:req.query.duration,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepallergiesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pallergies.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
allergy:req.query.allergy,
duration:req.query.duration,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepallergiescomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pallergies.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepallergiesbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pallergies.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// oct 30 2025 12:45 PM


exports.getpconsentbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pconsent
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pconsentdocs= async (req,res) => {
    try{
        
        const lcat1233= await pconsent
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pconsentlinks= async (req,res) => {
  try{
      
      const lcat1233= await pconsent
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpconsentbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pconsent.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
title:req.query.title,
description:req.query.description,
consentby:req.query.consentby,
relation:req.query.relation,
cdate:req.query.cdate,
link:req.query.link,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepconsentbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pconsent.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
title:req.query.title,
description:req.query.description,
consentby:req.query.consentby,
relation:req.query.relation,
cdate:req.query.cdate,
link:req.query.link,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepconsentcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pconsent.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepconsentbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pconsent.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getptreatmentbyfac= async (req,res) => {
    try{
        
        const lcat1233= await ptreatment
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.ptreatmentdocs= async (req,res) => {
    try{
        
        const lcat1233= await ptreatment
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.ptreatmentlinks= async (req,res) => {
  try{
      
      const lcat1233= await ptreatment
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createptreatmentbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await ptreatment.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
treatment:req.query.treatment,
duration:req.query.duration,
followup:req.query.followup,
startdate:req.query.startdate,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateptreatmentbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await ptreatment.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
treatment:req.query.treatment,
duration:req.query.duration,
followup:req.query.followup,
startdate:req.query.startdate,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateptreatmentcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await ptreatment.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteptreatmentbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await ptreatment.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getplabbyfac= async (req,res) => {
    try{
        
        const lcat1233= await plab
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.plabdocs= async (req,res) => {
    try{
        
        const lcat1233= await plab
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.plablinks= async (req,res) => {
  try{
      
      const lcat1233= await plab
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createplabbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await plab.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
lab:req.query.lab,
test:req.query.test,
finding:req.query.finding,
result:req.query.result,
testdate:req.query.testdate,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updateplabbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await plab.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
lab:req.query.lab,
test:req.query.test,
finding:req.query.finding,
result:req.query.result,
testdate:req.query.testdate,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updateplabcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await plab.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deleteplabbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await plab.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpimagingbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pimaging
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pimagingdocs= async (req,res) => {
    try{
        
        const lcat1233= await pimaging
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pimaginglinks= async (req,res) => {
  try{
      
      const lcat1233= await pimaging
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpimagingbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pimaging.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
lab:req.query.lab,
test:req.query.test,
result:req.query.result,
finding:req.query.finding,
testdate:req.query.testdate,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepimagingbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pimaging.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
lab:req.query.lab,
test:req.query.test,
result:req.query.result,
finding:req.query.finding,
testdate:req.query.testdate,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepimagingcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pimaging.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepimagingbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pimaging.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpdischargebyfac= async (req,res) => {
    try{
        
        const lcat1233= await pdischarge
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pdischargedocs= async (req,res) => {
    try{
        
        const lcat1233= await pdischarge
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pdischargelinks= async (req,res) => {
  try{
      
      const lcat1233= await pdischarge
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpdischargebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pdischarge.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
discharge:req.query.discharge,
dischargedate:req.query.dischargedate,
followup:req.query.followup,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepdischargebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pdischarge.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
discharge:req.query.discharge,
dischargedate:req.query.dischargedate,
followup:req.query.followup,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepdischargecomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pdischarge.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepdischargebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pdischarge.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// oct 30 2025 3


exports.getwcollectionbyfac= async (req,res) => {
    try{
        
        const lcat1233= await wcollection
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wcollectiondocs= async (req,res) => {
    try{
        
        const lcat1233= await wcollection
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wcollectionlinks= async (req,res) => {
  try{
      
      const lcat1233= await wcollection
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwcollectionbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wcollection.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            location:req.query.location,
type:req.query.type,
ctime:req.query.ctime,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewcollectionbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wcollection.findByIdAndUpdate( req.query.id,{
            
            
            location:req.query.location,
type:req.query.type,
ctime:req.query.ctime,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewcollectioncomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wcollection.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewcollectionbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wcollection.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwcolschedulebyfac= async (req,res) => {
    try{
        
        const lcat1233= await wcolschedule
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wcolscheduledocs= async (req,res) => {
    try{
        
        const lcat1233= await wcolschedule
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wcolschedulelinks= async (req,res) => {
  try{
      
      const lcat1233= await wcolschedule
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwcolschedulebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wcolschedule.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            location:req.query.location,
ctime:req.query.ctime,
vendor:req.query.vendor,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewcolschedulebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wcolschedule.findByIdAndUpdate( req.query.id,{
            
            
            location:req.query.location,
ctime:req.query.ctime,
vendor:req.query.vendor,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewcolschedulecomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wcolschedule.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewcolschedulebyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wcolschedule.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwdisposalbyfac= async (req,res) => {
    try{
        
        const lcat1233= await wdisposal
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wdisposaldocs= async (req,res) => {
    try{
        
        const lcat1233= await wdisposal
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wdisposallinks= async (req,res) => {
  try{
      
      const lcat1233= await wdisposal
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwdisposalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wdisposal.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            location:req.query.location,
type:req.query.type,
agency:req.query.agency,
disposaldate:req.query.disposaldate,
disposaltime:req.query.disposaltime,
vendor:req.query.vendor,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewdisposalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wdisposal.findByIdAndUpdate( req.query.id,{
            
            
            location:req.query.location,
type:req.query.type,
agency:req.query.agency,
disposaldate:req.query.disposaldate,
disposaltime:req.query.disposaltime,
vendor:req.query.vendor,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewdisposalcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wdisposal.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewdisposalbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wdisposal.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwspillbyfac= async (req,res) => {
    try{
        
        const lcat1233= await wspill
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wspilldocs= async (req,res) => {
    try{
        
        const lcat1233= await wspill
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wspilllinks= async (req,res) => {
  try{
      
      const lcat1233= await wspill
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwspillbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wspill.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            loation:req.query.loation,
type:req.query.type,
spilldetails:req.query.spilldetails,
spilldate:req.query.spilldate,
spilltime:req.query.spilltime,
actiontaken:req.query.actiontaken,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewspillbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wspill.findByIdAndUpdate( req.query.id,{
            
            
            loation:req.query.loation,
type:req.query.type,
spilldetails:req.query.spilldetails,
spilldate:req.query.spilldate,
spilltime:req.query.spilltime,
actiontaken:req.query.actiontaken,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewspillcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wspill.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewspillbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wspill.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// oct 30 2025 31


exports.getwbinbyfac= async (req,res) => {
    try{
        
        const lcat1233= await wbin
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wbindocs= async (req,res) => {
    try{
        
        const lcat1233= await wbin
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wbinlinks= async (req,res) => {
  try{
      
      const lcat1233= await wbin
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwbinbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wbin.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            location:req.query.location,
floor:req.query.floor,
bin:req.query.bin,
bintype:req.query.bintype,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewbinbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wbin.findByIdAndUpdate( req.query.id,{
            
            
            location:req.query.location,
floor:req.query.floor,
bin:req.query.bin,
bintype:req.query.bintype,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewbincomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wbin.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewbinbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wbin.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwcolschedule1byfac= async (req,res) => {
    try{
        
        const lcat1233= await wcolschedule1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wcolschedule1docs= async (req,res) => {
    try{
        
        const lcat1233= await wcolschedule1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wcolschedule1links= async (req,res) => {
  try{
      
      const lcat1233= await wcolschedule1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwcolschedule1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wcolschedule1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            location:req.query.location,
binid:req.query.binid,
type:req.query.type,
cday:req.query.cday,
ctime:req.query.ctime,
vendor:req.query.vendor,
amount:req.query.amount,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewcolschedule1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wcolschedule1.findByIdAndUpdate( req.query.id,{
            
            
            location:req.query.location,
binid:req.query.binid,
type:req.query.type,
cday:req.query.cday,
ctime:req.query.ctime,
vendor:req.query.vendor,
amount:req.query.amount,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewcolschedule1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wcolschedule1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewcolschedule1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wcolschedule1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwdisposal1byfac= async (req,res) => {
    try{
        
        const lcat1233= await wdisposal1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wdisposal1docs= async (req,res) => {
    try{
        
        const lcat1233= await wdisposal1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wdisposal1links= async (req,res) => {
  try{
      
      const lcat1233= await wdisposal1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwdisposal1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wdisposal1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            location:req.query.location,
type:req.query.type,
agency:req.query.agency,
binid:req.query.binid,
collectiondate:req.query.collectiondate,
disposaldate:req.query.disposaldate,
disposaltime:req.query.disposaltime,
vendor:req.query.vendor,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewdisposal1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wdisposal1.findByIdAndUpdate( req.query.id,{
            
            
            location:req.query.location,
type:req.query.type,
agency:req.query.agency,
binid:req.query.binid,
collectiondate:req.query.collectiondate,
disposaldate:req.query.disposaldate,
disposaltime:req.query.disposaltime,
vendor:req.query.vendor,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewdisposal1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wdisposal1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewdisposal1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wdisposal1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getwspill1byfac= async (req,res) => {
    try{
        
        const lcat1233= await wspill1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.wspill1docs= async (req,res) => {
    try{
        
        const lcat1233= await wspill1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.wspill1links= async (req,res) => {
  try{
      
      const lcat1233= await wspill1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createwspill1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await wspill1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            location:req.query.location,
type:req.query.type,
binid:req.query.binid,
spilldetails:req.query.spilldetails,
spilldate:req.query.spilldate,
spilltime:req.query.spilltime,
actiontaken:req.query.actiontaken,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatewspill1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await wspill1.findByIdAndUpdate( req.query.id,{
            
            
            location:req.query.location,
type:req.query.type,
binid:req.query.binid,
spilldetails:req.query.spilldetails,
spilldate:req.query.spilldate,
spilltime:req.query.spilltime,
actiontaken:req.query.actiontaken,
status:req.query.status,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatewspill1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await wspill1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletewspill1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await wspill1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};

// oct 31 2025 10:15 AM


exports.getpcounselnewbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pcounselnew
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pcounselnewdocs= async (req,res) => {
    try{
        
        const lcat1233= await pcounselnew
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pcounselnewlinks= async (req,res) => {
  try{
      
      const lcat1233= await pcounselnew
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpcounselnewbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pcounselnew.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
phone:req.query.phone,
contact:req.query.contact,
illness:req.query.illness,
treatment:req.query.treatment,
surgery:req.query.surgery,
amount:req.query.amount,
mdate:req.query.mdate,
followupdate:req.query.followupdate,
doctorref:req.query.doctorref,
doctor:req.query.doctor,
assignedto:req.query.assignedto,
leadstatus:req.query.leadstatus,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepcounselnewbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pcounselnew.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
phone:req.query.phone,
contact:req.query.contact,
illness:req.query.illness,
treatment:req.query.treatment,
surgery:req.query.surgery,
amount:req.query.amount,
mdate:req.query.mdate,
followupdate:req.query.followupdate,
doctorref:req.query.doctorref,
doctor:req.query.doctor,
assignedto:req.query.assignedto,
leadstatus:req.query.leadstatus,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepcounselnewcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pcounselnew.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepcounselnewbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pcounselnew.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpcounselcbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pcounselc
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pcounselcdocs= async (req,res) => {
    try{
        
        const lcat1233= await pcounselc
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pcounselclinks= async (req,res) => {
  try{
      
      const lcat1233= await pcounselc
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpcounselcbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pcounselc.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
pdate:req.query.pdate,
discussion:req.query.discussion,
ptime:req.query.ptime,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepcounselcbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pcounselc.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
admid:req.query.admid,
pdate:req.query.pdate,
discussion:req.query.discussion,
ptime:req.query.ptime,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepcounselccomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pcounselc.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepcounselcbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pcounselc.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpmealplanbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pmealplan
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pmealplandocs= async (req,res) => {
    try{
        
        const lcat1233= await pmealplan
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pmealplanlinks= async (req,res) => {
  try{
      
      const lcat1233= await pmealplan
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpmealplanbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pmealplan.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            itemgroup:req.query.itemgroup,
item:req.query.item,
type:req.query.type,
category:req.query.category,
amount:req.query.amount,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepmealplanbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pmealplan.findByIdAndUpdate( req.query.id,{
            
            
            itemgroup:req.query.itemgroup,
item:req.query.item,
type:req.query.type,
category:req.query.category,
amount:req.query.amount,
doccomments:req.query.doccomments,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepmealplancomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pmealplan.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepmealplanbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pmealplan.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.getpfoodbyfac= async (req,res) => {
    try{
        
        const lcat1233= await pfood
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.pfooddocs= async (req,res) => {
    try{
        
        const lcat1233= await pfood
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.pfoodlinks= async (req,res) => {
  try{
      
      const lcat1233= await pfood
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createpfoodbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await pfood.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            patient:req.query.patient,
puser:req.query.puser,
type:req.query.type,
foodtype:req.query.foodtype,
amount:req.query.amount,
fooddate:req.query.fooddate,
foodstatus:req.query.foodstatus,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatepfoodbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await pfood.findByIdAndUpdate( req.query.id,{
            
            
            patient:req.query.patient,
puser:req.query.puser,
type:req.query.type,
foodtype:req.query.foodtype,
amount:req.query.amount,
fooddate:req.query.fooddate,
foodstatus:req.query.foodstatus,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatepfoodcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await pfood.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletepfoodbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await pfood.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


// oct 31 2025 8 pm

exports.studalloc1examiner= async (req,res) => {
    try{
        
        // const lcat1233= await studalloc1
        //     .aggregate([
        //         { $addFields: { 'userId': { $toString: '$_id' }}},
        //         {
        //             $lookup: {
        //               from: 'supportingdocs', 
        //               localField: 'userId', 
        //               foreignField: 'field1', 
        //               as: 'seminars'
        //             }
        //           },
        //           {
        //             $lookup: {
        //               from: 'accrcomments', 
        //               localField: 'userId', 
        //               foreignField: 'field1', 
        //               as: 'allcomments'
        //             }
        //           },
        //           {
        //             $match: {
        //               'colid': parseInt(req.query.colid),
        //               'facultyid':req.query.user
        //             }
        //           }
        //           ]);

       // console.log(req.query.colid + '---' + req.query.user);

            const lcat1233= await studalloc1.find({colid:parseInt(req.query.colid),facultyid:req.query.user, marks: null
      //         $or: [
      //   { marks: null },                 // marks is explicitly null
      //   { marks: { $exists: false } },   // marks field is missing
      //   { marks: { $type: "nan" } }      // marks is NaN (rare, but possible)
      // ]
            });
            // const lcat1233= await studalloc1.find({colid:parseInt(req.query.colid)});
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };

  exports.updatestudalloc1exam= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await studalloc1.findByIdAndUpdate( req.query.id,{
component:req.query.component,
marks:req.query.marks,
status: 'Completed',
checkeddate: new Date()
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};

// nov 7 2025


exports.studalloc1studlist= async (req,res) => {
    try{

            const lcat1233= await studalloc1.find({
              colid:parseInt(req.query.colid),
              coursecode:req.query.coursecode,
              examode: req.query.examode,
              component: req.query.component,
              semester: req.query.semester,
              year: req.query.year
            });
            // const lcat1233= await studalloc1.find({colid:parseInt(req.query.colid)});
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };


exports.createstudalloc1studlist= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await studalloc1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            student:req.query.student,
regno:req.query.regno,
examode:req.query.examode,
program:req.query.program,
semester:req.query.semester,
course:req.query.course,
coursecode:req.query.coursecode,
status:req.query.status,
year:req.query.year,
component:req.query.component,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};

// nov 11


exports.getcrmh1byfac= async (req,res) => {
    try{
        
        const lcat1233= await crmh1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.crmh1docs= async (req,res) => {
    try{
        
        const lcat1233= await crmh1
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.crmh1links= async (req,res) => {
  try{
      
      const lcat1233= await crmh1
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createcrmh1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await crmh1.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            lead:req.query.lead,
company:req.query.company,
designation:req.query.designation,
phone:req.query.phone,
email:req.query.email,
address:req.query.address,
city:req.query.city,
state:req.query.state,
country:req.query.country,
pin:req.query.pin,
source:req.query.source,
sourceemp:req.query.sourceemp,
assignedto:req.query.assignedto,
assigneddate:req.query.assigneddate,
followupdate:req.query.followupdate,
fcomments:req.query.fcomments,
leadstatus:req.query.leadstatus,
year:req.query.year,
product:req.query.product,
amount:req.query.amount,
leadtype:req.query.leadtype,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatecrmh1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await crmh1.findByIdAndUpdate( req.query.id,{
            
            
            lead:req.query.lead,
company:req.query.company,
designation:req.query.designation,
phone:req.query.phone,
email:req.query.email,
address:req.query.address,
city:req.query.city,
state:req.query.state,
country:req.query.country,
pin:req.query.pin,
source:req.query.source,
sourceemp:req.query.sourceemp,
assignedto:req.query.assignedto,
assigneddate:req.query.assigneddate,
followupdate:req.query.followupdate,
fcomments:req.query.fcomments,
leadstatus:req.query.leadstatus,
year:req.query.year,
product:req.query.product,
amount:req.query.amount,
leadtype:req.query.leadtype,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatecrmh1comments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await crmh1.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletecrmh1byfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await crmh1.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


// Nov 18 2025


exports.gettallbyfac= async (req,res) => {
    try{
        
        const lcat1233= await tall
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.talldocs= async (req,res) => {
    try{
        
        const lcat1233= await tall
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.talllinks= async (req,res) => {
  try{
      
      const lcat1233= await tall
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createtallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await tall.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            title:req.query.title,
description:req.query.description,
tbl:req.query.tbl,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatetallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await tall.findByIdAndUpdate( req.query.id,{
            
            
            title:req.query.title,
description:req.query.description,
tbl:req.query.tbl,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatetallcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await tall.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletetallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await tall.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.gettfieldsbyfac= async (req,res) => {
    try{
        
        const lcat1233= await tfields
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.tfieldsdocs= async (req,res) => {
    try{
        
        const lcat1233= await tfields
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.tfieldslinks= async (req,res) => {
  try{
      
      const lcat1233= await tfields
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createtfieldsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await tfields.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            tbl:req.query.tbl,
tfield:req.query.tfield,
type:req.query.type,
example:req.query.example,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatetfieldsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await tfields.findByIdAndUpdate( req.query.id,{
            
            
            tbl:req.query.tbl,
tfield:req.query.tfield,
type:req.query.type,
example:req.query.example,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatetfieldscomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await tfields.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletetfieldsbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await tfields.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.gettblsearch= async (req,res) => {
  try{

    const searchstring=req.query.searchstring;
    const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await tall.find({
      // "colid" : req.query.colid,
      // "testc": /.*Skill.*/
      "title":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

exports.gettblfieldsearch= async (req,res) => {
  try{

    // const searchstring=req.query.searchstring;
    // const s1='/.*' + searchstring + '.*/'

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await tfields.find({
      // "colid" : req.query.colid,
      // "testc": /.*Skill.*/
      "tbl":req.query.tbl
      // "tbl":{'$regex' : searchstring, '$options' : 'i'}
    });
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};


exports.gettbcolumnsallbyfac= async (req,res) => {
    try{
        
        const lcat1233= await tbcolumnsall
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid),
                      'user':req.query.user
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  
exports.tbcolumnsalldocs= async (req,res) => {
    try{
        
        const lcat1233= await tbcolumnsall
            .aggregate([
                { $addFields: { 'userId': { $toString: '$_id' }}},
                {
                    $lookup: {
                      from: 'supportingdocs', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'seminars'
                    }
                  },
                  {
                    $lookup: {
                      from: 'accrcomments', 
                      localField: 'userId', 
                      foreignField: 'field1', 
                      as: 'allcomments'
                    }
                  },
                  {
                    $match: {
                      'colid': parseInt(req.query.colid)
                    }
                  }
                  ]);
            
            //console.log(lcat1233);
            return res.status(200).json({
                status:'Success',
                data: {
                    classes : lcat1233
                }   
            });            
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });
  
    }  
  };
  
  exports.tbcolumnsalllinks= async (req,res) => {
  try{
      
      const lcat1233= await tbcolumnsall
          .aggregate([
              { $addFields: { 'userId': { $toString: '$_id' }}},
              {
                  $lookup: {
                    from: 'supportingdocs', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'seminars'
                  }
                },
                {
                  $lookup: {
                    from: 'accrcomments', 
                    localField: 'userId', 
                    foreignField: 'field1', 
                    as: 'allcomments'
                  }
                },
                {
                  $match: {
                    'colid': parseInt(req.query.colid),
                    'status1' : {$ne : req.query.status1}
                  }
                }
                ]);
          
          //console.log(lcat1233);
          res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      res.status(400).json({
          status:'Failed',
          message: err
      });

  }  
};



exports.createtbcolumnsallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const pub1= await tbcolumnsall.create({
            name: req.query.name,
            colid: req.query.colid,
            user: req.query.user,
            tbl:req.query.tbl,
fields:req.query.fields,
status1: 'Submitted',
            comments: 'NA'
        });

    //res.status(200).send('Hello world for all the tours through db new router');
    return res.status(200).json({
        status:'Success'
    });
  
} catch(err) {
    // res.status(400).json({
    //     status:'Failed',
    //     message: err
    // });

}  
};


exports.updatetbcolumnsallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const lcat1= await tbcolumnsall.findByIdAndUpdate( req.query.id,{
            
            
            tbl:req.query.tbl,
fields:req.query.fields,
status1: 'Submitted',
            comments: 'NA'
        });
        return res.status(200).json({
            status:'Success'
        });
      
   
        
              
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }   
};


exports.updatetbcolumnsallcomments= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }
        const lcat1= await tbcolumnsall.findByIdAndUpdate( req.query.id,{
            status1: req.query.status1,
            comments: req.query.comments
           
        });
        
        res.status(200).json({
            status:'Success'
            
        });
        
    } catch(err) {
        res.status(400).json({
            status:'Failed',
            message: err
        });

    }   
};

exports.deletetbcolumnsallbyfac= async (req,res) => {

    try{
        const token=req.query.token;
        //console.log(token);
        let jwtuser='';
        let jwtcolid='';
        try {
            const verified = jwt.verify(
                token,
                process.env.JWT_SECRET,
                (err123, verified) => {
                  if (err123) {
                    return res.status(401).json({
                        status: 'Unauthorized',
                        error: err123
                    });
                  }
                  jwtuser=verified.user;
                  jwtcolid=verified.colid;
                  return verified;
                }
              );
        } catch(err1234) {
            //console.log(err1234);
        }

        const user1=req.query.user;
        await tbcolumnsall.findByIdAndDelete(req.query.id);
        
        return res.status(200).json({
            status:'Success'
        });
               
       
    } catch(err) {
        // res.status(400).json({
        //     status:'Failed',
        //     message: err
        // });

    }  
};


exports.gettbcolumns= async (req,res) => {
  try{

    // const lcat1233=await mtestnewm.find({"_id" : ObjectId(req.query.id)});
    const lcat1233=await tbcolumnsall.find({"tbl" : req.query.tbl});
          
          //console.log(lcat1233);
          return res.status(200).json({
              status:'Success',
              data: {
                  classes : lcat1233
              }   
          });            
  } catch(err) {
      // res.status(400).json({
      //     status:'Failed',
      //     message: err
      // });

  }  
};

